{
    "checksum": "a6aa568b75a6fb22e293089b0fe75b9d8e406f78f50933300bce4a49da75d6e3",
    "data": {
    "id": "9438764e-877c-46f0-913f-80d6042041cf",
    "createdAt": 1754366453932,
    "updatedAt": 1754366860914,
    "title": "Testing on_status_clicked Method",
    "messages": [
        {
            "id": "ad64d6b7-d75f-4369-9d21-bc923bb78bd2",
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": " Generate tests for on_status_clicked method"
                }
            ],
            "context": {
                "currentFile": {
                    "path": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py",
                    "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py",
                    "content": "\"\"\"\nSapphire Exchange - Main Application Window\n\nThis module contains the main PyQt5-based UI for the Sapphire Exchange desktop application.\n\"\"\"\nimport sys\nimport asyncio\nimport qrcode\nimport time\nfrom datetime import datetime, timedelta, timezone\nfrom PyQt5.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, \n                             QLabel, QPushButton, QStackedWidget, QLineEdit, QTextEdit, \n                             QMessageBox, QScrollArea, QFrame, QFileDialog, QInputDialog, \n                             QDialog, QDialogButtonBox, QFormLayout, QGroupBox, QTextBrowser,\n                             QListWidget, QListWidgetItem, QTabWidget, QButtonGroup)\nfrom PyQt5 import QtGui\nfrom PyQt5.QtCore import Qt, QThread, pyqtSignal, QSize, QTimer, pyqtSlot, QPropertyAnimation, QEasingCurve\nfrom PyQt5.QtGui import (QFont, QPixmap, QIcon, QTextCursor, QTextCharFormat, QColor, \n                         QFontMetrics, QDoubleValidator)\n\nfrom decentralized_client import EnhancedDecentralizedClient\nfrom models import Item, Auction, User, Bid\nfrom dogecoin_utils import DogeWalletManager\nfrom security_manager import SecurityManager, SessionManager\nfrom performance_manager import PerformanceManager\nfrom price_service import PriceConversionService, get_price_service\nfrom wallet_widget import MultiCurrencyWalletWidget\nfrom auction_widget import AuctionListWidget, AuctionDetailsWidget, CreateAuctionDialog\n\nclass AsyncWorker(QThread):\n    \"\"\"Worker thread for running async functions.\"\"\"\n    finished = pyqtSignal(object)\n    error = pyqtSignal(str)\n    \n    def __init__(self, coro):\n        super().__init__()\n        self.coro = coro\n        self._is_running = True\n        self.loop = None\n    \n    def run(self):\n        try:\n            self.loop = asyncio.new_event_loop()\n            asyncio.set_event_loop(self.loop)\n            if asyncio.iscoroutine(self.coro):\n                result = self.loop.run_until_complete(self.coro)\n            else:\n                result = self.coro  # In case it's not a coroutine\n            self.finished.emit(result)\n        except Exception as e:\n            self.error.emit(str(e))\n        finally:\n            self._is_running = False\n            if self.loop:\n                self.loop.close()\n    \n    def stop(self):\n        print(\"[AsyncWorker] stop() called. isRunning:\", self.isRunning(), \"_is_running:\", self._is_running)\n        self._is_running = False\n        if self.loop and self.loop.is_running():\n            print(\"[AsyncWorker] Stopping event loop...\")\n            self.loop.call_soon_threadsafe(self.loop.stop)\n        if self.isRunning():\n            print(\"[AsyncWorker] Quitting thread...\")\n            self.quit()\n            self.wait()\n        print(\"[AsyncWorker] stop() complete.\")\n    \n    def __del__(self):\n        print(\"[AsyncWorker] __del__ called.\")\n        try:\n            self.stop()\n        except RuntimeError:\n            print(\"[AsyncWorker] RuntimeError in __del__ (object deleted)\")\n            pass\n\nclass ItemWidget(QWidget):\n    \"\"\"Widget for displaying an item in the marketplace.\"\"\"\n    # Signal emitted when the bid button is clicked\n    bid_clicked = pyqtSignal(dict)  # Signal to emit the item data\n    \n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.init_ui()\n        \n    def init_ui(self):\n        layout = QVBoxLayout()\n        \n        # Item image (placeholder for now)\n        self.image_label = QLabel()\n        self.image_label.setFixedSize(200, 200)\n        self.image_label.setStyleSheet(\"background-color: #f0f0f0; border: 1px solid #ddd;\")\n        \n        # Item details\n        self.name_label = QLabel(self.item_data.get('name', 'Unnamed Item'))\n        self.name_label.setFont(QFont('Arial', 12, QFont.Bold))\n        \n        self.price_label = QLabel(f\"Price: {self.item_data.get('starting_price', 0)} DOGE\")\n        self.seller_label = QLabel(f\"Seller: {self.item_data.get('owner', 'Unknown')}\")\n        \n        # Bid button\n        self.bid_button = QPushButton(\"Place Bid\")\n        self.bid_button.clicked.connect(self.on_bid_clicked)\n        \n        # Add widgets to layout\n        layout.addWidget(self.image_label)\n        layout.addWidget(self.name_label)\n        layout.addWidget(self.price_label)\n        layout.addWidget(self.seller_label)\n        layout.addWidget(self.bid_button)\n        \n        self.setLayout(layout)\n    \n    def on_bid_clicked(self):\n        # Emit the signal with the item data\n        self.bid_clicked.emit(self.item_data)\n\nclass BidDialog(QDialog):\n    \"\"\"Custom dialog for placing bids with bid history.\"\"\"\n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.bid_amount = 0\n        self.init_ui()\n    \n    def init_ui(self):\n        self.setWindowTitle(f\"Bid on {self.item_data.get('name', 'Item')}\")\n        self.setMinimumWidth(400)\n        \n        layout = QVBoxLayout()\n        \n        # Current price and minimum bid\n        current_bid = float(self.item_data.get('current_bid', self.item_data.get('starting_price', 0)))\n        min_bid = max(current_bid * 1.1, current_bid + 0.1)  # 10% minimum increase or 0.1 NANO\n        \n        # Bid form\n        form_layout = QFormLayout()\n        \n        # Current price\n        self.current_price_label = QLabel(f\"<b>Current Price:</b> {current_bid:.6f} DOGE\")\n        form_layout.addRow(self.current_price_label)\n        \n        # Minimum bid\n        self.min_bid_label = QLabel(f\"<b>Minimum Bid:</b> {min_bid:.6f} DOGE\")\n        form_layout.addRow(self.min_bid_label)\n        \n        # Bid amount input\n        self.bid_input = QLineEdit()\n        self.bid_input.setPlaceholderText(f\"Minimum: {min_bid:.6f}\")\n        self.bid_input.setValidator(QDoubleValidator(min_bid, 1_000_000, 6))\n        self.bid_input.textChanged.connect(self.validate_bid)\n        form_layout.addRow(\"Your Bid (DOGE):\", self.bid_input)\n        \n        # Bid history group\n        history_group = QGroupBox(\"Bid History\")\n        history_layout = QVBoxLayout()\n        \n        self.history_browser = QTextBrowser()\n        self.history_browser.setOpenExternalLinks(False)\n        self.history_browser.setReadOnly(True)\n        self.history_browser.setStyleSheet(\"\"\"\n            QTextBrowser {\n                background-color: #f8f9fa;\n                border: 1px solid #dee2e6;\n                border-radius: 4px;\n                padding: 8px;\n                font-family: 'Courier New', monospace;\n                font-size: 12px;\n            }\n        \"\"\")\n        \n        # Add sample bid history (replace with actual data)\n        self.update_bid_history()\n        \n        # Toggle button for history\n        self.toggle_history_btn = QPushButton(\"Show History\")\n        self.toggle_history_btn.setCheckable(True)\n        self.toggle_history_btn.setChecked(False)\n        self.toggle_history_btn.clicked.connect(self.toggle_history)\n        \n        # Initially hide the history\n        self.history_browser.setVisible(False)\n        \n        history_layout.addWidget(self.toggle_history_btn)\n        history_layout.addWidget(self.history_browser)\n        history_group.setLayout(history_layout)\n        \n        # Dialog buttons\n        button_box = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)\n        button_box.accepted.connect(self.accept)\n        button_box.rejected.connect(self.reject)\n        self.ok_button = button_box.button(QDialogButtonBox.Ok)\n        self.ok_button.setEnabled(False)\n        \n        # Add widgets to main layout\n        layout.addLayout(form_layout)\n        layout.addWidget(history_group)\n        layout.addWidget(button_box)\n        \n        self.setLayout(layout)\n        \n        # Store min bid for validation\n        self.min_bid = min_bid\n    \n    def update_bid_history(self):\n        \"\"\"Update the bid history display.\"\"\"\n        # Get bids from item data (default to empty list if not present)\n        bids = self.item_data.get('bids', [])\n        \n        if not bids:\n            self.history_browser.setPlainText(\"No bids yet.\")\n            return\n        \n        # Format the history\n        history_text = []\n        for bid in sorted(bids, key=lambda x: x.get('timestamp', ''), reverse=True):\n            amount = bid.get('amount', 0)\n            bidder = bid.get('bidder', 'Unknown')\n            timestamp = bid.get('timestamp', '')\n            \n            # Format timestamp if available\n            if timestamp:\n                try:\n                    dt = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))\n                    timestamp = dt.strftime('%Y-%m-%d %H:%M:%S')\n                except (ValueError, AttributeError):\n                    pass\n            \n            history_text.append(f\"{timestamp} - {amount:.6f} DOGE by {bidder}\")\n        \n        self.history_browser.setPlainText(\"\\n\".join(history_text))\n    \n    def toggle_history(self):\n        \"\"\"Toggle the visibility of the bid history.\"\"\"\n        is_visible = not self.history_browser.isVisible()\n        self.history_browser.setVisible(is_visible)\n        self.toggle_history_btn.setText(\"Hide History\" if is_visible else \"Show History\")\n        \n        # Resize dialog to fit content\n        self.adjustSize()\n    \n    def validate_bid(self, text):\n        \"\"\"Validate the bid amount.\"\"\"\n        try:\n            bid = float(text) if text else 0\n            is_valid = bid >= self.min_bid\n            self.ok_button.setEnabled(is_valid)\n            \n            # Update text color based on validation\n            if text:\n                if bid < self.min_bid:\n                    self.bid_input.setStyleSheet(\"color: #dc3545;\")\n                else:\n                    self.bid_input.setStyleSheet(\"color: #28a745;\")\n            else:\n                self.bid_input.setStyleSheet(\"\")\n                \n            if is_valid:\n                self.bid_amount = bid\n                \n        except ValueError:\n            self.ok_button.setEnabled(False)\n            self.bid_input.setStyleSheet(\"color: #dc3545;\")\n    \n    def accept(self):\n        \"\"\"Handle accept button click.\"\"\"\n        try:\n            self.bid_amount = float(self.bid_input.text())\n            if self.bid_amount >= self.min_bid:\n                super().accept()\n            else:\n                QMessageBox.warning(self, \"Invalid Bid\", f\"Bid must be at least {self.min_bid:.6f} DOGE\")\n        except ValueError:\n            QMessageBox.warning(self, \"Invalid Input\", \"Please enter a valid bid amount.\")\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main application window.\"\"\"\n    # Signal to show the seed message box on the main thread\n    show_seed_message_box = pyqtSignal()\n    \n    def __init__(self):\n        print(\"Initializing MainWindow...\")\n        super().__init__()\n        print(\"  Setting up attributes...\")\n        self.mock_mode = True  # Ensure mock_mode is set\n        self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n        self.current_user = None\n        self.items = []\n        self._pending_seed = None\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Initialize mock servers\n        from mock_server import MockArweaveDB, MockNanoRPC, MockDogecoinRPC\n        self.mock_server = MockArweaveDB()\n        self.nano_rpc = MockNanoRPC()\n        self.doge_rpc = MockDogecoinRPC()\n        \n        print(\"  Initializing UI...\")\n        self.init_ui_components()\n        \n        # Connect the signal to the slot\n        print(\"  Connecting signals...\")\n        self.show_seed_message_box.connect(self._show_seed_message_box)\n        print(\"  MainWindow initialization complete\")\n        \n        # Initial connection check\n        QTimer.singleShot(1000, self.check_connections)\n        \n        # Start real-time event simulation for demo purposes\n        self.start_event_simulation()\n        \n        # Add initial welcome message with data quality indicator after UI is fully initialized\n        QTimer.singleShot(100, lambda: self.add_message(\"Sapphire Exchange initialized\", \"info\", \"‚úÖ\"))\n\n    def start_event_simulation(self):\n        \"\"\"Start simulating real-time events for demonstration of data quality indicators.\"\"\"\n        self.event_timer = QTimer()\n        self.event_timer.timeout.connect(self.simulate_event)\n        self.event_timer.start(15000)  # Simulate an event every 15 seconds\n        self.event_counter = 0\n    \n    def simulate_event(self):\n        \"\"\"Simulate various types of events with different data quality indicators.\"\"\"\n        import random\n        \n        events = [\n            (\"New bid received on Item #1234\", \"info\", \"pending\"),\n            (\"Arweave transaction confirmed\", \"success\", \"verified\"),\n            (\"DOGE wallet balance updated\", \"info\", \"verified\"),\n            (\"Bid verification in progress\", \"warning\", \"pending\"),\n            (\"RSA signature validation failed\", \"error\", \"failed\"),\n            (\"Nano block confirmation received\", \"success\", \"verified\"),\n            (\"Auction #5678 ended\", \"info\", \"verified\"),\n            (\"New item listed: Vintage Watch\", \"info\", \"pending\"),\n            (\"Payment processing timeout\", \"warning\", \"failed\"),\n            (\"Metadata integrity check passed\", \"success\", \"verified\")\n        ]\n        \n        if self.event_counter < len(events):\n            message, level, quality = events[self.event_counter]\n            self.add_message(message, level, quality)\n            self.event_counter += 1\n        else:\n            # Stop simulation after all demo events\n            self.event_timer.stop()\n    \n    def _show_seed_message_box(self):\n        \"\"\"Show the seed message box on the main thread with copy functionality.\"\"\"\n        try:\n            if not hasattr(self, '_pending_seed') or not self._pending_seed:\n                return\n                \n            seed = self._pending_seed\n            \n            # Set the seed phrase in the input box as well\n            self._set_seed_phrase(seed)\n            \n            # Create a custom message box\n            msg_box = QMessageBox(self)\n            msg_box.setWindowTitle(\"New Wallet Generated\")\n            msg_box.setIcon(QMessageBox.Information)\n            msg_box.setText(\n                \"A new wallet has been generated for you.\\n\\n\"\n                \"IMPORTANT: Please save this seed phrase in a secure location.\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n            \n            # Add the seed phrase in a read-only text field\n            seed_text = QTextEdit()\n            seed_text.setPlainText(seed)\n            seed_text.setReadOnly(True)\n            seed_text.setMinimumWidth(400)\n            seed_text.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed))\n            \n            # Add widgets to layout\n            layout = msg_box.layout()\n            layout.addWidget(QLabel(\"\\nYour seed phrase:\"), 1, 0, 1, 2)\n            layout.addWidget(seed_text, 2, 0, 1, 2)\n            layout.addWidget(QLabel(\" \"), 3, 0)  # Spacer\n            layout.addWidget(copy_btn, 4, 1)\n            \n            # Show the message box\n            msg_box.exec_()\n            \n        except Exception as e:\n            print(f\"Error showing seed message box: {e}\")\n            # Fall back to simple message box if there's an error\n            QMessageBox.information(\n                self, \n                \"New Wallet Generated\", \n                f\"A new wallet has been generated for you.\\n\\n\"\n                f\"IMPORTANT: Please save this seed phrase in a secure location:\\n\\n{seed}\\n\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n        finally:\n            # Clear the pending seed after showing the message\n            if hasattr(self, '_pending_seed'):\n                self._pending_seed = None\n    \n    def init_ui_components(self):\n        \"\"\"Initialize all UI components.\"\"\"\n        self.setWindowTitle(\"Sapphire Exchange\")\n        self.setMinimumSize(1000, 700)\n        \n        # Main layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        \n        # Main layout with status bar at bottom\n        main_layout = QVBoxLayout(main_widget)\n        main_layout.setContentsMargins(0, 0, 0, 0)\n        main_layout.setSpacing(0)\n        \n        # Initialize message history\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Content area with sidebar and main content\n        content_widget = QWidget()\n        content_layout = QHBoxLayout(content_widget)\n        content_layout.setContentsMargins(0, 0, 0, 0)\n        content_layout.setSpacing(0)\n        \n        # Sidebar\n        self.sidebar = self.create_sidebar()\n        content_layout.addWidget(self.sidebar, stretch=1)\n        \n        # Stacked widget for pages\n        self.stacked_widget = QStackedWidget()\n        \n        # Create and add login page\n        self.login_page = self.create_login_page()\n        self.stacked_widget.addWidget(self.login_page)\n        \n        # Create and add other pages\n        self.marketplace_page = self.create_marketplace_page()\n        self.stacked_widget.addWidget(self.marketplace_page)\n        \n        self.item_creation_page = self.create_item_creation_page()\n        self.stacked_widget.addWidget(self.item_creation_page)\n        \n        self.my_items_page = self.create_my_items_page()\n        self.stacked_widget.addWidget(self.my_items_page)\n        \n        # Set login page as initial page\n        self.stacked_widget.setCurrentIndex(0)\n        \n        content_layout.addWidget(self.stacked_widget, stretch=4)\n\n        # Status bar at bottom\n        self.status_bar = QFrame()\n        self.status_bar.setFrameShape(QFrame.StyledPanel)\n        self.status_bar.setStyleSheet(\"\"\"\n            QFrame {\n                background-color: #2c3e50;\n                border-top: 1px solid #34495e;\n                padding: 4px 8px;\n                color: #ecf0f1;\n            }\n            QLabel {\n                color: #ecf0f1;\n                font-size: 12px;\n                margin: 0 5px;\n            }\n            QPushButton {\n                background: transparent;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                padding: 2px 8px;\n                color: #ecf0f1;\n                font-size: 11px;\n            }\n        \"\"\")\n        \n        # Status indicators\n        self.connection_indicators = {}\n        \n        # Status layout\n        status_layout = QHBoxLayout(self.status_bar)\n        status_layout.setContentsMargins(8, 4, 8, 4)\n        status_layout.setSpacing(10)\n        \n        # Status text and timestamp\n        self.status_text = QLabel(\"Connecting...\")\n        self.status_text.setStyleSheet(\"color: #ecf0f1; font-size: 11px;\")\n        \n        # Last updated timestamp\n        self.last_updated = QLabel()\n        self.last_updated.setStyleSheet(\"color: #95a5a6; font-size: 11px;\")\n        \n        # Main status dot\n        self.main_status_indicator = QLabel(\"‚óè\")\n        self.main_status_indicator.setObjectName(\"main_status_indicator\")\n        self.main_status_indicator.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        self.main_status_indicator.mousePressEvent = self.on_status_clicked\n        \n        # Create status indicators for each service\n        services = [\n            ('arweave', '#3498db'),\n            ('nano', '#2ecc71'),\n            ('doge', '#f39c12')\n        ]\n        \n        # Add status widgets to layout\n        status_layout.addWidget(self.main_status_indicator)\n        status_layout.addWidget(self.status_text)\n        status_layout.addSpacing(10)\n        \n        # Container for connection indicators that can be toggled\n        self.indicators_container = QWidget()\n        indicators_layout = QHBoxLayout(self.indicators_container)\n        indicators_layout.setContentsMargins(0, 0, 0, 0)\n        indicators_layout.setSpacing(10)\n        \n        # Add connection indicators\n        for service, color in services:\n            indicator = self.create_status_indicator(service.capitalize(), color)\n            self.connection_indicators[service] = indicator\n            indicators_layout.addWidget(indicator)\n        \n        # Add indicators container to main layout\n        status_layout.addWidget(self.indicators_container)\n        \n        # Add last updated timestamp\n        status_layout.addStretch()\n        status_layout.addWidget(self.last_updated)\n        \n        # Initially show the indicators\n        self.indicators_visible = True\n        \n        # Activity feed as a bottom overlay (popup style)\n        self.activity_widget = self.create_activity_feed()\n        self.activity_widget.setVisible(False)\n        self.activity_widget.setFixedHeight(220)\n        self.activity_widget.setStyleSheet('''\n            QWidget#activityOverlay {\n                background: rgba(248,249,250,0.97);\n                border-top: 2px solid #4a627a;\n                border-radius: 0 0 12px 12px;\n                box-shadow: 0px -4px 16px rgba(44,62,80,0.11);\n            }\n        ''' + self.activity_widget.styleSheet())\n        self.activity_widget.setObjectName('activityOverlay')\n        self.activity_widget.setParent(self.centralWidget())\n        self.activity_widget.raise_()\n        self._position_activity_overlay()\n\n        # Ensure overlay is repositioned on resize\n        self.centralWidget().installEventFilter(self)\n\n        # Toggle Activity Feed button\n        self.toggle_log_btn = QPushButton(\"‚ñ≤ Activity Log\")\n        self.toggle_log_btn.setFixedHeight(20)\n        self.toggle_log_btn.setStyleSheet(\"\"\"\n            QPushButton {\n                font-size: 11px;\n                padding: 0 8px;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                color: #ecf0f1;\n                background: transparent;\n            }\n            QPushButton:hover {\n                background: #3d5366;\n            }\n        \"\"\")\n        self.toggle_log_btn.clicked.connect(self.toggle_activity_log_overlay)\n        status_layout.addWidget(self.toggle_log_btn)\n        \n        # Add status bar to main layout\n        main_layout.addWidget(content_widget, stretch=1)\n        main_layout.addWidget(self.status_bar)\n            \n    def _position_activity_overlay(self):\n        if hasattr(self, 'activity_widget') and self.activity_widget:\n            parent = self.centralWidget()\n            if parent:\n                h = self.activity_widget.height()\n                parent_h = parent.height()\n                parent_w = parent.width()\n                sb_h = self.status_bar.height() if hasattr(self, 'status_bar') else 0\n                self.activity_widget.setFixedWidth(parent_w)\n                self.activity_widget.move(0, parent_h - h - sb_h)\n    \n    def eventFilter(self, obj, event):\n        if obj == self.centralWidget() and event.type() == event.Resize:\n            self._position_activity_overlay()\n        return super().eventFilter(obj, event)\n\n    def toggle_activity_log_overlay(self):\n        if not hasattr(self, 'activity_widget'):\n            return\n        is_visible = self.activity_widget.isVisible()\n        self.activity_widget.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Log\" if is_visible else \"‚ñ≤ Activity Log\")\n        if not is_visible:\n            self._position_activity_overlay()\n        self.adjustSize()\n    \n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n\n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click.\"\"\"\n        # Toggle message log visibility when clicking on any status indicator\n        self.toggle_message_log()\n            \n    def add_message(self, message, level=\"info\", data_quality=\"unknown\"):\n        \"\"\"Add a message to the log with data quality indicator.\n        \n        Args:\n            message (str): The message to add\n            level (str): Message level ('info', 'warning', 'error', 'success')\n            data_quality (str): Data quality status ('verified', 'pending', 'failed', 'unknown')\n        \"\"\"\n        try:\n            # Add timestamp\n            timestamp = datetime.now().strftime(\"%H:%M:%S\")\n            self.message_history.append((timestamp, message, level, data_quality))\n            \n            # Keep only the last max_messages\n            if len(self.message_history) > self.max_messages:\n                self.message_history = self.message_history[-self.max_messages:]\n                \n            # Update the message log if it exists\n            if hasattr(self, 'message_log') and self.message_log is not None:\n                self.update_message_log()\n                \n            # Show error messages in status bar if available\n            if level == \"error\" and hasattr(self, 'status_text') and self.status_text is not None:\n                error_msg = f\"Error: {message[:50]}...\" if len(message) > 50 else f\"Error: {message}\"\n                self.status_text.setText(error_msg)\n                # Clear the error message after 5 seconds\n                QTimer.singleShot(5000, lambda: self.status_text.setText(\"\"))\n                \n            # Print to console for debugging\n            print(f\"[{timestamp}] [{level.upper()}] {message}\")\n            \n            # Ensure the message log is updated in the UI\n            QApplication.processEvents()\n            \n        except Exception as e:\n            print(f\"Error in add_message: {str(e)}\")\n            \n    def update_message_log(self):\n        \"\"\"Update the message log with all messages and data quality indicators.\"\"\"\n        try:\n            if not hasattr(self, 'message_log') or self.message_log is None:\n                return\n                \n            log_text = \"\"\n            for entry in self.message_history:\n                # Handle both old format (3 items) and new format (4 items)\n                if len(entry) == 3:\n                    timestamp, msg, level = entry\n                    data_quality = \"unknown\"\n                else:\n                    timestamp, msg, level, data_quality = entry\n                \n                # Data quality indicator circle\n                if data_quality == \"verified\":\n                    quality_circle = \"<span style='color: #2ecc71;'>‚óè</span>\"  # Green\n                    quality_tooltip = \"Valid Nano & Arweave confirmations\"\n                elif data_quality == \"pending\":\n                    quality_circle = \"<span style='color: #f39c12;'>‚óè</span>\"  # Orange\n                    quality_tooltip = \"Pending or recent bid / not yet verified\"\n                elif data_quality == \"failed\":\n                    quality_circle = \"<span style='color: #e74c3c;'>‚óè</span>\"  # Red\n                    quality_tooltip = \"RSA verification failed / corrupted metadata\"\n                else:\n                    quality_circle = \"<span style='color: #666;'>‚óè</span>\"  # Gray\n                    quality_tooltip = \"Unknown verification status\"\n                \n                # Message color based on level\n                if level == \"error\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#e74c3c'>{timestamp} - {msg}</font><br>\"\n                elif level == \"warning\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#f39c12'>{timestamp} - {msg}</font><br>\"\n                elif level == \"success\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#2ecc71'>{timestamp} - {msg}</font><br>\"\n                else:\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> {timestamp} - {msg}<br>\"\n            \n            self.message_log.setHtml(log_text)\n            \n        except Exception as e:\n            print(f\"Error in update_message_log: {str(e)}\")\n            \n    def toggle_connection_details(self, event=None):\n        \"\"\"Toggle the visibility of connection details.\"\"\"\n        if not hasattr(self, 'connection_details') or self.connection_details is None:\n            return\n            \n        is_visible = self.connection_details.isVisible()\n        self.connection_details.setVisible(not is_visible)\n        self.update_main_status_indicator()\n\n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            service (str): Service name ('arweave', 'nano', 'doge')\n            is_connected (bool): Whether the service is connected\n            error_msg (str, optional): Error message if connection failed\n            status_detail (str, optional): Detailed status information\n        \"\"\"\n        if service not in self.connection_indicators:\n            return\n\n        widget = self.connection_indicators[service]\n        dot = widget.findChild(QLabel, service + \"_dot\")\n\n        if not dot:\n            return\n\n        # Update tooltip with detailed status information\n        if service == 'arweave':\n            if is_connected:\n                tooltip = \"Arweave: Connected\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n\n        widget.setToolTip(tooltip)\n\n        # Update the main status indicator\n        self.update_main_status_indicator()\n        \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated') and self.last_updated is not None:\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n\n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.update_main_status_indicator()\n                return\n                \n            # Check Arweave connection\n            arweave_connected = self.client.check_arweave_connection()\n            self.update_connection_status('arweave', arweave_connected)\n            \n            # Check Nano connection\n            nano_connected = self.client.check_nano_connection()\n            self.update_connection_status('nano', nano_connected)\n            \n            # Check Dogecoin connection\n            doge_connected = self.client.check_dogecoin_connection()\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update the main status indicator\n            self.update_main_status_indicator()\n            \n            # Update the timestamp\n            self.update_timestamp()\n            \n        except Exception as e:\n            print(f\"Error checking connections: {str(e)}\")\n            self.add_message(f\"Error checking connections: {str(e)}\", \"error\")\n            \n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            return\n            \n        # Check Arweave connection\n        arweave_connected = self.client.check_arweave_connection()\n        self.update_connection_status('arweave', arweave_connected)\n        \n        # Check Nano connection\n        nano_connected = self.client.check_nano_connection()\n        self.update_connection_status('nano', nano_connected)\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n        \n        widget.setToolTip(tooltip)\n        \n        # Update the main status indicator\n        self.update_main_status_indicator()\n    \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated'):\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n    \n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.connection_status = False\n                self.status_text.setText(\"Client not initialized\")\n                return\n            \n            # In mock mode, connections should always be available\n            if self.mock_mode:\n                arweave_connected = True\n                nano_connected = True\n                doge_connected = True\n                self.connection_status = True\n            else:\n                # Check actual connections using client's connection status\n                conn_status = getattr(self.client, 'connection_status', {})\n                arweave_connected = conn_status.get('arweave', False)\n                nano_connected = conn_status.get('nano', False)\n                doge_connected = conn_status.get('doge', False)\n                self.connection_status = conn_status.get('overall', False)\n            \n            # Update individual connection statuses\n            self.update_connection_status('arweave', arweave_connected)\n            self.update_connection_status('nano', nano_connected)\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update status text based on overall connection state\n            if self.mock_mode:\n                self.status_text.setText(\"Mock mode - All systems operational\")\n            else:\n                all_connected = arweave_connected and nano_connected and doge_connected\n                self.status_text.setText(\"All systems operational\" if all_connected else \"Some services unavailable\")\n            \n            # Update timestamp\n            self.update_timestamp()\n                \n            # Update the main status indicator\n            if hasattr(self, 'main_status_indicator') and self.main_status_indicator is not None:\n                color = '#2ecc71' if self.connection_status else '#e74c3c'\n                self.main_status_indicator.setStyleSheet(f\"font-size: 16px; color: {color};\")\n                \n                # Update the tooltip with connection status\n                status_text = \"All systems operational\" if self.connection_status else \"Connection issues detected\"\n                self.main_status_indicator.setToolTip(f\"Status: {status_text}\\nClick for details\")\n        except Exception as e:\n            self.status_text.setText(f\"Error checking connections\")\n            self.add_message(f\"Connection check error: {str(e)}\", \"error\", \"failed\")\n            print(f\"Error in check_connections: {e}\")\n            self.connection_status = False\n        \n        # Schedule next check (less frequent to reduce noise)\n        QTimer.singleShot(5000, self.check_connections)\n        \n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click to toggle connection indicators.\"\"\"\n        if not hasattr(self, 'indicators_visible'):\n            return\n            \n        # Toggle visibility of connection indicators\n        self.indicators_visible = not self.indicators_visible\n        self.indicators_container.setVisible(self.indicators_visible)\n        \n        # Update tooltip to indicate current state\n        state = \"Hide\" if self.indicators_visible else \"Show\"\n        self.main_status_indicator.setToolTip(\n            f\"{state} connection indicators\\n\"\n            \"Click to toggle visibility\"\n        )\n            \n    def create_status_indicator(self, name, color):\n        \"\"\"Create a status indicator widget.\n        \n        Args:\n            name (str): Name of the service (e.g., 'Arweave', 'Nano')\n            color (str): Base color for the indicator\n            \n        Returns:\n            QWidget: Configured status indicator widget\n        \"\"\"\n        widget = QWidget()\n        widget.setObjectName(name.lower() + \"_widget\")\n        layout = QHBoxLayout(widget)\n        layout.setContentsMargins(0, 0, 0, 0)\n        layout.setSpacing(5)\n        \n        # Status dot\n        dot = QLabel(\"‚óè\")\n        dot.setObjectName(name.lower() + \"_dot\")\n        dot.setStyleSheet(f\"font-size: 16px; color: #666;\")\n        \n        # Service name\n        label = QLabel(name)\n        label.setStyleSheet(\"font-size: 11px;\")\n        \n        layout.addWidget(dot)\n        layout.addWidget(label)\n        \n        return widget\n    \n    def update_main_status_indicator(self):\n        \"\"\"Update the main status indicator based on connection states.\"\"\"\n        if not hasattr(self, 'connection_indicators'):\n            return\n            \n        # Count connected services\n        connected = 0\n        total_services = len(self.connection_indicators)\n        \n        for service in self.connection_indicators.values():\n            dot = service.findChild(QLabel, service.objectName().replace('_widget', '_dot'))\n            if dot and \"color: #2ecc71\" in dot.styleSheet():\n                connected += 1\n        \n        # Set color and tooltip based on connection state (as per JSON spec)\n        if connected == total_services:\n            color = \"#2ecc71\"  # Green - All connections healthy\n            status_text = \"All connections healthy\"\n        elif connected > 0:\n            color = \"#f39c12\"  # Orange - Partial connection issues\n            status_text = \"Partial connection issues\"\n        else:\n            color = \"#e74c3c\"  # Red - One or more services offline or malfunctioning\n            status_text = \"One or more services offline or malfunctioning\"\n            \n        # Update main indicator with enhanced tooltip\n        style = f\"QLabel#main_status_indicator {{ font-size: 16px; color: {color}; }}\"\n        self.main_status_indicator.setStyleSheet(style)\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        \n        # Update tooltip to reflect current status\n        tooltip = f\"Click to expand error diagnostics\\n\\nStatus: {status_text}\\nConnected: {connected}/{total_services} services\"\n        self.main_status_indicator.setToolTip(tooltip)\n    \n    def toggle_message_log(self):\n        \"\"\"Toggle the visibility of the message log.\"\"\"\n        is_visible = self.message_log.isVisible()\n        self.message_log.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Feed\" if is_visible else \"‚ñ≤ Activity Feed\")\n        \n        # Resize window to fit content\n        self.adjustSize()\n        \n    def create_sidebar(self):\n        \"\"\"Create the sidebar with navigation buttons and user information.\"\"\"\n        self.sidebar = QWidget()\n        self.sidebar.setFixedWidth(200)\n        sidebar_style = (\n            \"QWidget { background-color: #2c3e50; border-right: 1px solid #34495e; }\"\n            \"QPushButton { background-color: transparent; color: #ecf0f1; border: none; padding: 12px 16px; text-align: left; font-size: 14px; font-weight: 500; }\"\n            \"QPushButton:hover { background-color: #34495e; }\"\n            \"QPushButton:checked { background-color: #1abc9c; }\"\n            \"QPushButton:pressed { background-color: #16a085; }\"\n            \"QLabel { color: #ecf0f1; padding: 8px; }\"\n            \"QLabel#user_info { font-size: 12px; padding: 4px 8px; background-color: rgba(0, 0, 0, 0.2); border-radius: 4px; margin: 8px; }\"\n            \"QLabel#user_balance { font-size: 14px; font-weight: bold; color: #1abc9c; }\"\n        )\n        self.sidebar.setStyleSheet(sidebar_style)\n        \n        # Create sidebar layout and store it as instance variable\n        self.sidebar_layout = QVBoxLayout()\n        self.sidebar_layout.setContentsMargins(0, 0, 0, 0)\n        self.sidebar_layout.setSpacing(0)\n        self.sidebar.setLayout(self.sidebar_layout)\n        \n        # Add logo\n        logo_label = QLabel(\"Sapphire Exchange\")\n        logo_label.setAlignment(Qt.AlignCenter)\n        logo_label.setStyleSheet(\n            \"QLabel {\"\n            \"    color: #ecf0f1;\"\n            \"    font-size: 16px;\"\n            \"    font-weight: bold;\"\n            \"    padding: 20px 10px;\"\n            \"    border-bottom: 1px solid #34495e;\"\n            \"}\"\n        )\n        self.sidebar_layout.addWidget(logo_label)\n        \n        # Add navigation buttons\n        self.create_nav_buttons()\n        \n        # Add spacer\n        self.sidebar_layout.addStretch(1)\n        \n        # Add user info (initially hidden)\n        self.user_info_widget = QLabel(\"Not logged in\")\n        self.user_info_widget.setAlignment(Qt.AlignCenter)\n        self.user_info_widget.setStyleSheet(\"QLabel { color: #bdc3c7; font-size: 12px; padding: 10px; border-top: 1px solid #34495e; }\")\n        self.user_info_widget.setVisible(False)\n        self.sidebar_layout.addWidget(self.user_info_widget)\n        \n        # Add logout button (initially hidden)\n        self.logout_btn = QPushButton(\"Logout\")\n        self.logout_btn.setStyleSheet(\"QPushButton { background-color: #e74c3c; color: white; border: none; padding: 10px; margin: 10px; border-radius: 4px; } QPushButton:hover { background-color: #c0392b; }\")\n        self.logout_btn.setVisible(False)\n        self.logout_btn.clicked.connect(self.logout)\n        self.sidebar_layout.addWidget(self.logout_btn)\n        \n        return self.sidebar\n        \n    def create_nav_buttons(self):\n        \"\"\"Create navigation buttons for the sidebar.\"\"\"\n        # Navigation buttons with proper visibility states\n        self.nav_buttons = {\n            \"marketplace_btn\": {\n                \"text\": \"üè†  Marketplace\",\n                \"page_id\": 1,\n                \"visible\": True,  # Always visible\n                \"requires_auth\": False\n            },\n            \"sell_item_btn\": {\n                \"text\": \"üõçÔ∏è  Sell Item\",\n                \"page_id\": 2,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"my_items_btn\": {\n                \"text\": \"üì¶  My Items\",\n                \"page_id\": 3,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"settings_btn\": {\n                \"text\": \"‚öôÔ∏è  Settings\",\n                \"page_id\": 4,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            }\n        }\n        \n        # Create navigation buttons\n        self.nav_button_group = QButtonGroup()\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = QPushButton(btn_data[\"text\"])\n            btn.setCheckable(True)\n            btn.setVisible(btn_data[\"visible\"])\n            btn.setProperty(\"requires_auth\", btn_data[\"requires_auth\"])\n            btn.clicked.connect(lambda checked, p=btn_data[\"page_id\"]: self.show_page(p))\n            self.nav_button_group.addButton(btn, btn_data[\"page_id\"])\n            setattr(self, btn_name, btn)  # Store reference to button\n            self.sidebar_layout.addWidget(btn)\n        \n    def create_login_page(self):\n        \"\"\"Create a simplified login/signup page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setAlignment(Qt.AlignCenter)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        # Logo/Title\n        title = QLabel(\"Sapphire Exchange\")\n        title.setFont(QFont('Arial', 24, QFont.Bold))\n        title.setAlignment(Qt.AlignCenter)\n        layout.addWidget(title)\n        \n        layout.addSpacing(30) \n        card = QWidget()\n        card.setFixedWidth(350)  # Reduced from 400px\n        card.setStyleSheet(\"QWidget { background: white; border-radius: 12px; padding: 25px; border: 1px solid #e0e0e0; }\")\n        \n        form_layout = QVBoxLayout(card)\n        form_layout.setSpacing(20)\n        \n        # Form title\n        form_title = QLabel(\"Welcome Back\")\n        form_title.setFont(QFont('Arial', 16, QFont.Bold))\n        form_title.setAlignment(Qt.AlignCenter)\n        \n        # Seed phrase input\n        seed_label = QLabel(\"Your Seed Phrase:\")\n        self.seed_input = QTextEdit()\n        self.seed_input.setPlaceholderText(\"seed should be 15 to 25 character long\")\n        self.seed_input.setMaximumHeight(80)  # Increased from 60 to 80\n        self.seed_input.setStyleSheet(\"QTextEdit { border: 1px solid #e0e0e0; border-radius: 4px; padding: 8px; font-size: 14px; min-height: 60px; max-height: 80px; } QTextEdit:focus { border: 1px solid #4a6ee0; }\")\n        \n        # New account link\n        new_account_link = QLabel(\n            \"<a href='#' style='color: #2b7bba; text-decoration: none;'>Create a new account</a>\"\n        )\n        new_account_link.setAlignment(Qt.AlignCenter)\n        new_account_link.linkActivated.connect(self.handle_new_account)\n        \n        # Login button\n        self.login_btn = QPushButton(\"Continue\")\n        self.login_btn.setStyleSheet(\"QPushButton { background: #2b7bba; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; font-size: 15px; } QPushButton:hover { background: #1a5a8f; } QPushButton:disabled { background: #cccccc; }\")\n        self.login_btn.clicked.connect(self.handle_login)\n        \n        # Add widgets to form\n        form_layout.addWidget(form_title)\n        form_layout.addWidget(seed_label)\n        form_layout.addWidget(self.seed_input)\n        form_layout.addWidget(new_account_link)\n        form_layout.addWidget(self.login_btn)\n        \n        # Add card to main layout\n        layout.addStretch()\n        layout.addWidget(title)\n        layout.addWidget(card, 0, Qt.AlignCenter)\n        layout.addStretch()\n        \n        # Initialize state\n        self.is_new_user = False\n        \n        return page\n        \n    def handle_new_account(self):\n        \"\"\"Handle new account creation.\"\"\"\n        try:\n            # Generate a nano-compliant BIP-39 seed phrase\n            import secrets\n            wordlist = [\n                'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract', 'absurd', 'abuse',\n                'access', 'accident', 'account', 'accuse', 'achieve', 'acid', 'acoustic', 'across', 'act', 'action',\n                'actor', 'actress', 'actual', 'adapt', 'add', 'addict', 'address', 'adjust', 'admit', 'adult',\n                'advance', 'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'age', 'agent', 'agree',\n                'ahead', 'aim', 'air', 'airport', 'aisle', 'alarm', 'album', 'alcohol', 'alert', 'alien'\n            ]\n            seed_phrase = ' '.join(secrets.choice(wordlist) for _ in range(12))\n            \n            # Create a custom dialog for the seed phrase\n            dialog = QDialog(self)\n            dialog.setWindowTitle(\"Your Recovery Phrase\")\n            dialog.setMinimumWidth(500)\n            dialog.setStyleSheet(\"QDialog { background-color: #f5f5f5; font-family: Arial, sans-serif; } QLabel { color: #333333; font-size: 14px; margin: 5px 0; } QPushButton { background: #2b7bba; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; } QTextEdit { border: 1px solid #cccccc; border-radius: 4px; padding: 10px; background: white; font-family: monospace; font-size: 16px; margin: 10px 0; }\")\n            \n            layout = QVBoxLayout(dialog)\n            \n            # Title\n            title = QLabel(\"Your Wallet Recovery Phrase\")\n            title.setStyleSheet(\"font-size: 18px; font-weight: bold; color: #2b7bba; margin-bottom: 15px;\")\n            \n            # Warning text\n            warning = QLabel(\n                \"Write down these words in the correct order and keep them in a secure location. \"\n                \"You will need this phrase to recover your wallet.\"\n            )\n            warning.setWordWrap(True)\n            warning.setStyleSheet(\"color: #d35400; background: #fdebd0; padding: 10px; border-radius: 4px;\")\n            \n            # Seed phrase display\n            seed_display = QTextEdit()\n            seed_display.setPlainText(seed_phrase)\n            seed_display.setReadOnly(True)\n            seed_display.setMinimumWidth(400)\n            seed_display.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed_phrase))\n            \n            # Confirm button\n            confirm_btn = QPushButton(\"I have saved this seed\")\n            confirm_btn.setStyleSheet(\"background: #27ae60;\")\n            \n            # Add widgets to layout\n            layout.addWidget(title)\n            layout.addWidget(warning)\n            layout.addWidget(QLabel(\"\\nYour recovery phrase:\"))\n            layout.addWidget(seed_display)\n            \n            # Button layout\n            btn_layout = QHBoxLayout()\n            btn_layout.addWidget(copy_btn)\n            btn_layout.addWidget(confirm_btn)\n            \n            layout.addLayout(btn_layout)\n            \n            # Show the dialog\n            dialog.exec_()\n            \n            # Store the seed phrase in a class variable for later use\n            self._pending_seed = seed_phrase\n            \n            # Set the seed phrase directly in the input field\n            success = self._set_seed_phrase(seed_phrase)\n            \n            # If direct setting failed, try again with a small delay\n            if not success:\n                QTimer.singleShot(100, lambda: self._set_seed_phrase(seed_phrase))\n            \n            # Enable login and set flags\n            self.login_btn.setEnabled(True)\n            self.is_new_user = True\n            \n            # Set focus to the login button for better UX\n            self.login_btn.setFocus()\n            \n            # Debug output\n            print(f\"DEBUG: Seed phrase generated: {seed_phrase}\")\n            print(f\"DEBUG: Input field content after setting: '{self.seed_input.toPlainText()}'\")\n            print(f\"DEBUG: Input field has focus: {self.seed_input.hasFocus()}\")\n            \n            # Force a complete UI update\n            QApplication.processEvents()\n            \n            return True\n            \n        except Exception as e:\n            QMessageBox.critical(self, \"Error\", f\"Failed to create account: {str(e)}\")\n            return False\n    \n    def _set_seed_phrase(self, seed_phrase):\n        \"\"\"Set the seed phrase in the input field. Returns True if successful.\"\"\"\n        try:\n            if hasattr(self, 'seed_input') and self.seed_input is not None:\n                self.seed_input.setPlainText(seed_phrase)\n                self.seed_input.setFocus()\n                return True\n            return False\n        except Exception as e:\n            print(f\"Error setting seed phrase: {e}\")\n            return False\n    \n    def handle_login(self):\n        \"\"\"Handle the login process with the provided seed phrase.\"\"\"\n        try:\n            # Get and validate seed phrase\n            seed_phrase = self.seed_input.toPlainText().strip()\n            \n            if not seed_phrase:\n                QMessageBox.warning(self, \"Input Required\", \"Please enter your seed phrase or create a new account.\")\n                return\n                \n            # Validate seed phrase format (basic check)\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Disable login button to prevent multiple clicks\n            self.login_btn.setEnabled(False)\n            self.login_btn.setText(\"Please wait...\")\n            \n            # Clear any previous error messages\n            self.statusBar().clearMessage()\n            \n            # Show status message\n            status_msg = \"Creating your account...\" if self.is_new_user else \"Logging in...\"\n            \n            # Create a worker for the login process\n            worker = AsyncWorker(self.login_async(seed_phrase, None))\n            worker.finished.connect(lambda result: self.on_login_complete(result))\n            worker.error.connect(lambda error: self.on_error(error))\n            worker.start()\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to login: {str(e)}\")\n            print(f\"Login error: {e}\")\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle completion of the login process.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            # Use the sidebar layout that's now properly defined\n            if hasattr(self, 'sidebar_layout') and self.sidebar_layout:\n                for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                    item = self.sidebar_layout.itemAt(i)\n                    if item and item.widget():\n                        btn = item.widget()\n                        if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                            btn.setVisible(True)\n            \n            # Make logout button visible\n            if hasattr(self, 'logout_btn'):\n                self.logout_btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    def create_marketplace_page(self):\n        \"\"\"Create the marketplace page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        # Items grid\n        self.items_grid = QListWidget()\n        self.items_grid.setViewMode(QListWidget.IconMode)\n        self.items_grid.setIconSize(QSize(200, 200))\n        self.items_grid.setResizeMode(QListWidget.Adjust)\n        self.items_grid.setSpacing(20)\n        \n        # Add items grid to layout\n        layout.addWidget(self.items_grid)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        print(\"  Marketplace page created\")\n        return page\n    \n    def create_item_creation_page(self):\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        title = QLabel(\"Create New Item\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Form layout\n        form_layout = QFormLayout()\n        form_layout.setSpacing(15)\n        \n        # Item name\n        self.item_name = QLineEdit()\n        self.item_name.setPlaceholderText(\"Item Name\")\n        form_layout.addRow(\"Item Name:\", self.item_name)\n        \n        # Item description\n        self.item_description = QTextEdit()\n        self.item_description.setPlaceholderText(\"Item Description\")\n        self.item_description.setMaximumHeight(100)\n        form_layout.addRow(\"Description:\", self.item_description)\n        \n        # Starting price\n        self.starting_price = QLineEdit()\n        self.starting_price.setPlaceholderText(\"Starting Price (NANO)\")\n        form_layout.addRow(\"Starting Price (NANO):\", self.starting_price)\n        \n        # Duration (in hours)\n        self.duration = QLineEdit(\"24\")\n        self.duration.setPlaceholderText(\"Auction Duration (hours)\")\n        form_layout.addRow(\"Auction Duration (hours):\", self.duration)\n        \n        # Image upload\n        self.image_path = QLineEdit()\n        self.image_path.setPlaceholderText(\"Image Path\")\n        self.image_path.setReadOnly(True)\n        \n        browse_btn = QPushButton(\"Browse...\")\n        browse_btn.clicked.connect(self.browse_image)\n        \n        image_layout = QHBoxLayout()\n        image_layout.addWidget(self.image_path)\n        image_layout.addWidget(browse_btn)\n        form_layout.addRow(\"Image:\", image_layout)\n        \n        # Add form to layout\n        layout.addWidget(title)\n        layout.addLayout(form_layout)\n        \n        # Create button\n        create_btn = QPushButton(\"Create Item\")\n        create_btn.clicked.connect(self.create_item)\n        layout.addWidget(create_btn, alignment=Qt.AlignRight)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        return page\n    \n    def create_my_items_page(self):\n        \"\"\"Create the 'My Items' page.\"\"\"\n        print(\"Creating My Items page...\")\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        title = QLabel(\"My Items\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Items list\n        print(\"  Creating my_items_list...\")\n        self.my_items_list = QListWidget()\n        self.my_items_list.setViewMode(QListWidget.IconMode)\n        self.my_items_list.setIconSize(QSize(150, 150))\n        self.my_items_list.setResizeMode(QListWidget.Adjust)\n        \n        # Add widgets to layout\n        layout.addWidget(title)\n        layout.addWidget(self.my_items_list)\n        \n        print(\"  My Items page created\")\n        return page\n    \n    def browse_image(self):\n        file_name, _ = QFileDialog.getOpenFileName(\n            self, \"Select Image\", \"\", \"Image Files (*.png *.jpg *.jpeg *.bmp)\")\n        if file_name:\n            self.image_path.setText(file_name)\n    \n    def load_my_items(self):\n        # Load the current user's items.\n        if not hasattr(self, 'my_items_list'):\n            return\n            \n        self.my_items_list.clear()\n        \n        if not self.current_user:\n            self.my_items_list.addItem(\"Please log in to view your items\")\n            return\n            \n        # Show loading indicator\n        self.my_items_list.addItem(\"Loading your items...\")\n        \n        # For now, just clear the loading message\n        # In a real implementation, this would load actual items\n        QTimer.singleShot(1000, lambda: self.my_items_list.clear())\n    \n    def show_page(self, page_index):\n        \"\"\"Show the page at the given index and load appropriate content.\"\"\"\n        if 0 <= page_index < self.stacked_widget.count():\n            self.stacked_widget.setCurrentIndex(page_index)\n            \n            # Load content for the specific page\n            if page_index == 1:  # Marketplace\n                self.load_marketplace_items()\n            elif page_index == 3:  # My Items\n                if hasattr(self, 'my_items_list'):\n                    self.load_my_items()\n                    \n        # Update button states based on login status\n        user_logged_in = hasattr(self, 'current_user') and self.current_user is not None\n        \n        # Update sidebar buttons based on login status\n        sidebar_layout = self.sidebar.layout()\n        if sidebar_layout:\n            for i in range(1, sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(user_logged_in)\n        \n        # Update user info and logout button visibility\n        if hasattr(self, 'user_info_widget'):\n            self.user_info_widget.setVisible(user_logged_in)\n            \n        if hasattr(self, 'logout_btn'):\n            self.logout_btn.setVisible(user_logged_in)\n\n        # Update navigation buttons for guest users\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = getattr(self, btn_name)\n            btn.setVisible(not btn.property(\"requires_auth\"))  # Only show non-auth buttons\n    \n    def logout(self):\n        \"\"\"Handle user logout.\"\"\"\n        self.current_user = None\n        self.client = None\n        \n        # Hide user info\n        if hasattr(self, 'user_info'):\n            self.user_info.setVisible(False)\n        \n        # Reset navigation buttons - only show Marketplace\n        if hasattr(self, 'nav_buttons'):\n            for btn_name, (_, _, _) in self.nav_buttons.items():\n                if hasattr(self, btn_name):\n                    getattr(self, btn_name).setVisible(False)  # Hide all buttons first\n            # Show only marketplace button\n            if hasattr(self, 'marketplace_btn'):\n                self.marketplace_btn.setVisible(True)\n        \n        # Hide other UI elements\n        for btn_name in ['create_item_btn', 'my_items_btn', 'logout_btn']:\n            if hasattr(self, btn_name):\n                getattr(self, btn_name).setVisible(False)\n        \n        # Clear any sensitive data\n        if hasattr(self, 'seed_input'):\n            self.seed_input.clear()\n        \n        # Show login page and add logout message\n        self.show_page(0)  # Assuming page 0 is the login page\n        self.add_message(\"Successfully logged out\", \"info\", \"verified\")\n\n    def create_item(self):\n        # Get form data\n        name = self.item_name.text().strip()\n        description = self.item_description.toPlainText().strip()\n        price_text = self.starting_price.text().strip()\n        duration_text = self.duration.text().strip()\n        \n        # Validate inputs\n        if not name:\n            QMessageBox.warning(self, \"Error\", \"Item name is required\")\n            return\n            \n        try:\n            price = float(price_text)\n            if price <= 0:\n                raise ValueError(\"Price must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid price\")\n            return\n            \n        try:\n            duration = float(duration_text)\n            if duration <= 0:\n                raise ValueError(\"Duration must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid duration\")\n            return\n        \n        # Create a simple loading overlay\n        loading_widget = QWidget(self)\n        loading_widget.setGeometry(self.rect())\n        loading_widget.setStyleSheet(\"background-color: rgba(0, 0, 0, 128);\")\n        \n        loading_layout = QVBoxLayout(loading_widget)\n        loading_label = QLabel(\"Creating your item...\")\n        loading_label.setStyleSheet(\"color: white; font-size: 16px;\")\n        loading_label.setAlignment(Qt.AlignCenter)\n        \n        loading_layout.addWidget(loading_label, 0, Qt.AlignCenter)\n        loading_widget.show()\n        \n        # Make sure the loading widget is on top\n        loading_widget.raise_()\n        \n        def on_item_created(result):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            \n            if result:\n                item, tx_id = result\n                QMessageBox.information(\n                    self,\n                    \"Item Created\",\n                    f\"Item created successfully!\\n\\n\"\n                    f\"Transaction ID: {tx_id}\\n\"\n                    f\"Nano Address: {item.metadata.get('nano_address', 'N/A')}\"\n                )\n                # Clear form\n                self.item_name.clear()\n                self.item_description.clear()\n                self.starting_price.clear()\n                self.duration.setText(\"24\")\n                self.image_path.clear()\n                \n                # Switch to marketplace\n                self.show_page(1)\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to create item\")\n        \n        def on_error(error_msg):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            QMessageBox.critical(self, \"Error\", f\"Failed to create item: {error_msg}\")\n        \n        # Start item creation in a worker thread\n        self.worker = AsyncWorker(\n            self.create_item_async(\n                name=name,\n                description=description,\n                starting_price=price,\n                duration_hours=duration,\n                image_path=self.image_path.text()\n            )\n        )\n        self.worker.finished.connect(on_item_created)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def login_async(self, seed_phrase, user_data=None):\n        \"\"\"\n        Handle the login or account creation process asynchronously.\n        \n        Args:\n            seed_phrase: The seed phrase for login\n            user_data: Not used in simplified flow (kept for compatibility)\n        \n        Returns:\n            User: The authenticated user object\n        \n        Raises:\n            ValueError: If login or account creation fails\n        \"\"\"\n        try:\n            import random\n            import asyncio\n            import time\n            from models import User\n            from decentralized_client import EnhancedDecentralizedClient\n            from nano_utils_fixed import NanoWallet\n            \n            # Simulate network delay (0.5-1.5 seconds)\n            await asyncio.sleep(0.5 + random.random())\n            \n            # Validate seed phrase format\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Initialize client if needed\n            if not hasattr(self, 'client') or self.client is None:\n                self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n            \n            # Connect to the network services\n            connection_status = await self.client.connect()\n            \n            # Check connection status\n            if not connection_status or not self.client.is_connected:\n                error_msg = \"Failed to connect to the network. \"\n                if 'arweave' in connection_status and not connection_status['arweave']:\n                    error_msg += \"Arweave connection failed. \"\n                if 'nano' in connection_status and not connection_status['nano']:\n                    error_msg += \"Nano connection failed. \"\n                if 'doge' in connection_status and not connection_status['doge']:\n                    error_msg += \"Dogecoin connection failed. \"\n                raise ValueError(error_msg.strip())\n            \n            # For new users (coming from handle_new_account)\n            if getattr(self, 'is_new_user', False):\n                print(\"Creating new account with provided seed phrase...\")\n                try:\n                    # Generate a default username\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    \n                    # Initialize user with the provided seed phrase\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n                    \n                    if not user or not hasattr(self.client, 'user_wallet') or not self.client.user_wallet:\n                        raise ValueError(\"Failed to initialize user wallet\")\n                        \n                    print(f\"Created new wallet with address: {self.client.user_wallet.address}\")\n                    return user\n                    \n                except Exception as e:\n                    error_msg = f\"Error creating account: {str(e)}\"\n                    print(error_msg)\n                    raise ValueError(error_msg) from e\n\n            # For existing users\n            print(\"Logging in with existing seed phrase...\")\n            try:\n                # First, try to create a wallet from the seed phrase\n                self.client.user_wallet = await asyncio.get_event_loop().run_in_executor(\n                    None,\n                    lambda: NanoWallet.from_seed(seed_phrase, mock_mode=True)\n                )\n\n                if not self.client.user_wallet or not hasattr(self.client.user_wallet, 'public_key'):\n                    raise ValueError(\"Invalid seed phrase: Could not derive wallet\")\n                \n                # Convert public key to hex for lookup\n                public_key_hex = self.client.user_wallet.public_key.to_ascii(encoding='hex').decode('utf-8')\n                \n                # Try to load user data\n                user = await self.client._load_user_data()\n                \n                if not user:\n                    # If no user data found, check if this is a valid Nano wallet\n                    if not hasattr(self.client.user_wallet, 'address'):\n                        raise ValueError(\"Invalid seed phrase: Not a valid wallet\")\n                        \n                    # For mock mode, we'll create a new user if one doesn't exist\n                    print(\"No existing user found, creating new user...\")\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n            \n                if not user:\n                    raise ValueError(\"Failed to load or create user\")\n                    \n                print(f\"Successfully logged in as {getattr(user, 'username', 'unknown')}\")\n                return user\n                \n            except Exception as e:\n                error_msg = f\"Login failed: {str(e)}\"\n                print(error_msg)\n                raise ValueError(error_msg) from e\n            \n        except Exception as e:\n            error_msg = f\"Login error: {str(e)}\"\n            print(error_msg)\n            raise ValueError(error_msg) from e\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle successful login completion.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = self.sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    async def load_items_async(self):\n        \"\"\"Load all items from the mock database.\"\"\"\n        from mock_server import arweave_db\n        from datetime import datetime, timezone\n        \n        items = []\n        \n        # Get all items from the mock Arweave database\n        for tx_id, item_data in arweave_db.items.items():\n            # Skip items that don't have the expected structure\n            if not isinstance(item_data, dict):\n                continue\n                \n            # Calculate time left\n            time_left = \"N/A\"\n            if 'auction_end_time' in item_data:\n                try:\n                    end_time = datetime.fromisoformat(item_data['auction_end_time'].replace('Z', '+00:00'))\n                    now = datetime.now(timezone.utc)\n                    \n                    if end_time <= now:\n                        time_left = \"Ended\"\n                    else:\n                        delta = end_time - now\n                        if delta.days > 0:\n                            time_left = f\"{delta.days}d {delta.seconds // 3600}h\"\n                        else:\n                            hours = delta.seconds // 3600\n                            minutes = (delta.seconds % 3600) // 60\n                            time_left = f\"{hours}h {minutes}m\"\n                except (ValueError, TypeError):\n                    pass\n            \n            # Create item dictionary for the UI\n            item = {\n                'id': tx_id,\n                'name': item_data.get('name', 'Unnamed Item'),\n                'description': item_data.get('description', 'No description'),\n                'starting_price': float(item_data.get('starting_price', 0.0)),\n                'current_bid': float(item_data.get('starting_price', 0.0)),  # In a real app, this would track the highest bid\n                'owner': item_data.get('original_owner', 'Unknown'),\n                'auction_end_time': item_data.get('auction_end_time', ''),\n                'nano_address': item_data.get('nano_address', '')\n            }\n            items.append(item)\n        \n        # If no items found in mock database, add some sample items\n        if not items and hasattr(self, 'mock_mode') and self.mock_mode:\n            sample_items = [\n                {\n                    'name': 'Sample Digital Art',\n                    'description': 'A beautiful piece of digital artwork',\n                    'starting_price': 10.5,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=24)).isoformat(),\n                    'original_owner': 'sample_owner_1',\n                    'nano_address': 'nano_sample1234567890'\n                },\n                {\n                    'name': 'Rare Collectible',\n                    'description': 'A limited edition collectible item',\n                    'starting_price': 25.0,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=12)).isoformat(),\n                    'original_owner': 'sample_owner_2',\n                    'nano_address': 'nano_sample0987654321'\n                }\n            ]\n            \n            for item_data in sample_items:\n                tx_id = arweave_db.store_data(item_data)\n                item = {\n                    'id': tx_id,\n                    'name': item_data['name'],\n                    'description': item_data['description'],\n                    'starting_price': float(item_data['starting_price']),\n                    'current_bid': float(item_data['starting_price']),\n                    'owner': item_data['original_owner'],\n                    'auction_end_time': item_data['auction_end_time'],\n                    'nano_address': item_data['nano_address']\n                }\n                items.append(item)\n        \n        return items\n    \n    async def load_user_items_async(self):\n        \"\"\"Load items owned by the current user.\"\"\"\n        if not self.current_user:\n            return []\n            \n        # Get all items and filter by owner\n        all_items = await self.load_items_async()\n        return [item for item in all_items if item.get('owner') == self.current_user.public_key]\n    \n    async def create_item_async(self, name, description, starting_price, duration_hours, image_path=None):\n        try:\n            if not self.client or not self.current_user:\n                raise ValueError(\"Not logged in or client not initialized\")\n                \n            # Create the item using the decentralized client\n            # client.create_item returns a tuple of (item_data, tx_id)\n            item_data, tx_id = await self.client.create_item(\n                name=name,\n                description=description,\n                starting_price=starting_price,\n                duration_hours=duration_hours,\n                image_data=image_path.encode() if image_path else None\n            )\n            \n            # Add to local items list for UI updates\n            if item_data:\n                self.items.append(item_data)\n            \n            # Return both the item data and transaction ID\n            return item_data, tx_id\n            \n        except Exception as e:\n            print(f\"Error creating item: {e}\")\n            raise\n    \n    def on_bid_clicked(self, item_data):\n        # Show custom bid dialog with history\n        dialog = BidDialog(item_data, self)\n        if dialog.exec_() == QDialog.Accepted:\n            self.place_bid(item_data['id'], dialog.bid_amount)\n    \n    def place_bid(self, item_id, amount):\n        # Show loading indicator\n        loading_msg = QMessageBox(self)\n        loading_msg.setWindowTitle(\"Placing Bid\")\n        loading_msg.setText(f\"Placing bid of {amount} DOGE...\")\n        loading_msg.setStandardButtons(QMessageBox.NoButton)\n        loading_msg.show()\n        \n        def on_bid_placed(result):\n            loading_msg.close()\n            if result:\n                self.add_message(\"Bid placed successfully!\", \"success\", \"pending\")\n                QMessageBox.information(\n                    self,\n                    \"Bid Placed\",\n                    f\"Your bid of {amount} DOGE has been placed!\\n\\n\"\n                    f\"Transaction ID: {result}\"\n                )\n                # Refresh marketplace\n                self.load_marketplace_items()\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to place bid\")\n        \n        def on_error(error_msg):\n            loading_msg.close()\n            self.add_message(f\"Bid failed: {str(error_msg)}\", \"error\", \"failed\")\n            QMessageBox.critical(self, \"Error\", f\"Failed to place bid: {error_msg}\")\n        \n        # Start bid process in a worker thread\n        self.worker = AsyncWorker(self.place_bid_async(item_id, amount))\n        self.worker.finished.connect(on_bid_placed)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def place_bid_async(self, item_id, amount):\n        # In a real implementation, this would use the EnhancedDecentralizedClient\n        # For now, return a mock transaction ID\n        return f\"mock_bid_tx_{item_id}_{int(amount * 1e6)}\"\n\n    def on_error(self, error):\n        print(f\"Error: {error}\")\n\n    def load_marketplace_items(self):\n        \"\"\"Load marketplace items from the mock server.\"\"\"\n        try:\n            print(\"Loading marketplace items...\")\n            \n            # Show loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.show()\n            \n            # Clear existing items\n            if hasattr(self, 'marketplace_list') and self.marketplace_list:\n                self.marketplace_list.clear()\n            \n            # Get items from mock server\n            items = self.mock_server.get_marketplace_items()\n            \n            if items:\n                for item in items:\n                    # Create item widget\n                    item_widget = self.create_marketplace_item_widget(item)\n                    if item_widget:\n                        list_item = QListWidgetItem()\n                        list_item.setSizeHint(item_widget.sizeHint())\n                        self.marketplace_list.addItem(list_item)\n                        self.marketplace_list.setItemWidget(list_item, item_widget)\n            \n            print(f\"Loaded {len(items)} marketplace items\")\n            \n            # Hide loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n                \n        except Exception as e:\n            print(f\"Error loading marketplace items: {e}\")\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n            if hasattr(self, 'add_message'):\n                self.add_message(f\"Failed to load marketplace items: {str(e)}\", \"error\", \"‚ö†Ô∏è\")\n\n    def create_marketplace_item_widget(self, item):\n        \"\"\"Create a widget for displaying a marketplace item.\"\"\"\n        try:\n            widget = QWidget()\n            layout = QHBoxLayout()\n            layout.setContentsMargins(10, 10, 10, 10)\n            \n            # Item image\n            image_label = QLabel()\n            image_label.setFixedSize(60, 60)\n            image_label.setStyleSheet(\"QLabel { background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; }\")\n            \n            # Item details\n            details_layout = QVBoxLayout()\n            \n            # Title\n            title_label = QLabel(item.get('title', 'Untitled Item'))\n            title_label.setStyleSheet(\"QLabel { font-weight: bold; font-size: 14px; }\")\n            \n            # Price\n            price_label = QLabel(f\"{item.get('price', 0)} {item.get('currency', 'NANO')}\")\n            price_label.setStyleSheet(\"QLabel { color: #27ae60; font-size: 16px; font-weight: bold; }\")\n            \n            # Description\n            desc_label = QLabel(item.get('description', 'No description available'))\n            desc_label.setStyleSheet(\"QLabel { color: #7f8c8d; font-size: 12px; }\")\n            desc_label.setWordWrap(True)\n            desc_label.setMaximumWidth(300)\n            \n            details_layout.addWidget(title_label)\n            details_layout.addWidget(price_label)\n            details_layout.addWidget(desc_label)\n            \n            layout.addWidget(image_label)\n            layout.addLayout(details_layout)\n            layout.addStretch()\n            \n            widget.setLayout(layout)\n            return widget\n            \n        except Exception as e:\n            print(f\"Error creating marketplace item widget: {e}\")\n            return None\n\n    def toggle_activity_feed(self):\n        \"\"\"Toggle the visibility of the activity feed.\"\"\"\n        if hasattr(self, 'activity_widget'):\n            is_visible = self.activity_widget.isVisible()\n            self.activity_widget.setVisible(not is_visible)\n            \n            # Update toggle button arrow\n            if hasattr(self, 'activity_toggle_btn'):\n                self.activity_toggle_btn.setText(\"‚ñ≤\" if is_visible else \"‚ñº\")\n\n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n",
                    "language": "python"
                },
                "codebaseEnabled": true
            },
            "createdAt": 1754366453977,
            "isInternal": false,
            "rawContent": {
                "type": "doc",
                "content": [
                    {
                        "type": "paragraph",
                        "content": [
                            {
                                "type": "text",
                                "text": " Generate tests for on_status_clicked method"
                            }
                        ]
                    }
                ]
            },
            "autoAppliedRules": [
                {
                    "name": "Repository Information Overview",
                    "description": "Repository Information Overview",
                    "uri": "zen-rules://repo/repo",
                    "content": "\n\n# Sapphire Exchange Information\n\n## Summary\nSapphire Exchange is a decentralized auction platform built on Arweave and Nano blockchains. It enables users to list, bid on, and purchase items with secure blockchain transactions. The application provides decentralized storage on Arweave, fast and feeless Nano transactions, secure wallet management, and a timed auction system.\n\n## Structure\n- **app.py**: Main application entry point\n- **main_window.py**: PyQt5-based UI implementation\n- **models.py**: Data models for users, items, and auctions\n- **database.py**: Database module using Arweave for storage\n- **arweave_utils.py**: Handles interactions with Arweave blockchain\n- **nano_utils.py**: Manages Nano wallet and transaction functionality\n- **decentralized_client.py**: Client for interacting with blockchain networks\n- **mock_servers.py**: Mock implementations for testing without real blockchain\n- **test_marketplace.py**: Test script for verifying marketplace functionality\n\n## Language & Runtime\n**Language**: Python\n**Version**: 3.7+\n**Build System**: pip (Python package manager)\n**Package Manager**: pip\n\n## Dependencies\n**Main Dependencies**:\n- PyArweave==0.6.0: Arweave blockchain integration\n- python-dotenv>=0.19.2: Environment variable management\n- requests>=2.28.0: HTTP requests\n- base58>=2.1.1: Base58 encoding/decoding\n- cryptography>=3.4.7: Cryptographic operations\n- ed25519-blake2b==1.4.1: Digital signatures\n- pynacl>=1.4.0: Cryptographic library\n- pycryptodome>=3.20.0: Cryptographic primitives\n- PyQt5>=5.15.9: GUI framework\n- qrcode>=7.4.2: QR code generation\n- Pillow>=9.5.0: Image processing\n\n**Development Dependencies**:\n- Not explicitly specified in requirements.txt\n\n## Build & Installation\n```bash\n# Create and activate virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install dependencies\npip install -r requirements.txt\n\n# Set up environment variables\n# Create .env file with:\n# ARWEAVE_GATEWAY_URL=https://arweave.net\n# ARWEAVE_WALLET_FILE=wallet.json\n# NANO_NODE_URL=https://mynano.ninja/api\n# NANO_REPRESENTATIVE=nano_3t6k35gi95xu6tergt6p69ck76ogmitsa8mnijtpxm9fkcm736xtoncuohr3\n```\n\n## Usage\n```bash\n# Run the application\npython app.py\n```\n\n## Testing\n**Framework**: Custom testing with mock implementations\n**Test Location**: test_marketplace.py\n**Mock Implementation**: mock_servers.py provides simulated blockchain environments\n**Run Command**:\n```bash\npython test_marketplace.py\n```\n\n## Features\n- **Decentralized Storage**: Item data stored on Arweave blockchain\n- **Nano Integration**: Fast, feeless Nano transactions for bidding and purchasing\n- **Secure Wallet Management**: Built-in wallet generation and management\n- **Auction System**: Support for timed auctions with automatic finalization\n- **Mock Mode**: Testing environment that simulates blockchain operations\n- **PyQt5 GUI**: Desktop application interface for user interaction"
                }
            ]
        },
        {
            "id": "fca111bc-f376-4d8f-99ad-e5a096cd836a",
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "I'll help you generate tests for the `on_status_clicked` method. First, let me examine the current file to understand the method's implementation and then look for existing test patterns in the codebase."
                }
            ],
            "context": {
                "author": "Unit Test Agent",
                "operationId": "9d0dd89e-8207-47e7-8371-6631fc3a8bd6"
            },
            "createdAt": 1754366457328,
            "isInternal": false
        },
        {
            "id": "e8e2da85-2ef8-48f6-9c9f-eea10c95418a",
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "many errors on the main_window.py file can you repair."
                }
            ],
            "context": {
                "currentFile": {
                    "path": "main_window.py",
                    "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py",
                    "sources": [
                        "opened_tab"
                    ],
                    "content": "\"\"\"\nSapphire Exchange - Main Application Window\n\nThis module contains the main PyQt5-based UI for the Sapphire Exchange desktop application.\n\"\"\"\nimport sys\nimport asyncio\nimport qrcode\nimport time\nfrom datetime import datetime, timedelta, timezone\nfrom PyQt5.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, \n                             QLabel, QPushButton, QStackedWidget, QLineEdit, QTextEdit, \n                             QMessageBox, QScrollArea, QFrame, QFileDialog, QInputDialog, \n                             QDialog, QDialogButtonBox, QFormLayout, QGroupBox, QTextBrowser,\n                             QListWidget, QListWidgetItem, QTabWidget, QButtonGroup)\nfrom PyQt5 import QtGui\nfrom PyQt5.QtCore import Qt, QThread, pyqtSignal, QSize, QTimer, pyqtSlot, QPropertyAnimation, QEasingCurve\nfrom PyQt5.QtGui import (QFont, QPixmap, QIcon, QTextCursor, QTextCharFormat, QColor, \n                         QFontMetrics, QDoubleValidator)\n\nfrom decentralized_client import EnhancedDecentralizedClient\nfrom models import Item, Auction, User, Bid\nfrom dogecoin_utils import DogeWalletManager\nfrom security_manager import SecurityManager, SessionManager\nfrom performance_manager import PerformanceManager\nfrom price_service import PriceConversionService, get_price_service\nfrom wallet_widget import MultiCurrencyWalletWidget\nfrom auction_widget import AuctionListWidget, AuctionDetailsWidget, CreateAuctionDialog\n\nclass AsyncWorker(QThread):\n    \"\"\"Worker thread for running async functions.\"\"\"\n    finished = pyqtSignal(object)\n    error = pyqtSignal(str)\n    \n    def __init__(self, coro):\n        super().__init__()\n        self.coro = coro\n        self._is_running = True\n        self.loop = None\n    \n    def run(self):\n        try:\n            self.loop = asyncio.new_event_loop()\n            asyncio.set_event_loop(self.loop)\n            if asyncio.iscoroutine(self.coro):\n                result = self.loop.run_until_complete(self.coro)\n            else:\n                result = self.coro  # In case it's not a coroutine\n            self.finished.emit(result)\n        except Exception as e:\n            self.error.emit(str(e))\n        finally:\n            self._is_running = False\n            if self.loop:\n                self.loop.close()\n    \n    def stop(self):\n        print(\"[AsyncWorker] stop() called. isRunning:\", self.isRunning(), \"_is_running:\", self._is_running)\n        self._is_running = False\n        if self.loop and self.loop.is_running():\n            print(\"[AsyncWorker] Stopping event loop...\")\n            self.loop.call_soon_threadsafe(self.loop.stop)\n        if self.isRunning():\n            print(\"[AsyncWorker] Quitting thread...\")\n            self.quit()\n            self.wait()\n        print(\"[AsyncWorker] stop() complete.\")\n    \n    def __del__(self):\n        print(\"[AsyncWorker] __del__ called.\")\n        try:\n            self.stop()\n        except RuntimeError:\n            print(\"[AsyncWorker] RuntimeError in __del__ (object deleted)\")\n            pass\n\nclass ItemWidget(QWidget):\n    \"\"\"Widget for displaying an item in the marketplace.\"\"\"\n    # Signal emitted when the bid button is clicked\n    bid_clicked = pyqtSignal(dict)  # Signal to emit the item data\n    \n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.init_ui()\n        \n    def init_ui(self):\n        layout = QVBoxLayout()\n        \n        # Item image (placeholder for now)\n        self.image_label = QLabel()\n        self.image_label.setFixedSize(200, 200)\n        self.image_label.setStyleSheet(\"background-color: #f0f0f0; border: 1px solid #ddd;\")\n        \n        # Item details\n        self.name_label = QLabel(self.item_data.get('name', 'Unnamed Item'))\n        self.name_label.setFont(QFont('Arial', 12, QFont.Bold))\n        \n        self.price_label = QLabel(f\"Price: {self.item_data.get('starting_price', 0)} DOGE\")\n        self.seller_label = QLabel(f\"Seller: {self.item_data.get('owner', 'Unknown')}\")\n        \n        # Bid button\n        self.bid_button = QPushButton(\"Place Bid\")\n        self.bid_button.clicked.connect(self.on_bid_clicked)\n        \n        # Add widgets to layout\n        layout.addWidget(self.image_label)\n        layout.addWidget(self.name_label)\n        layout.addWidget(self.price_label)\n        layout.addWidget(self.seller_label)\n        layout.addWidget(self.bid_button)\n        \n        self.setLayout(layout)\n    \n    def on_bid_clicked(self):\n        # Emit the signal with the item data\n        self.bid_clicked.emit(self.item_data)\n\nclass BidDialog(QDialog):\n    \"\"\"Custom dialog for placing bids with bid history.\"\"\"\n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.bid_amount = 0\n        self.init_ui()\n    \n    def init_ui(self):\n        self.setWindowTitle(f\"Bid on {self.item_data.get('name', 'Item')}\")\n        self.setMinimumWidth(400)\n        \n        layout = QVBoxLayout()\n        \n        # Current price and minimum bid\n        current_bid = float(self.item_data.get('current_bid', self.item_data.get('starting_price', 0)))\n        min_bid = max(current_bid * 1.1, current_bid + 0.1)  # 10% minimum increase or 0.1 NANO\n        \n        # Bid form\n        form_layout = QFormLayout()\n        \n        # Current price\n        self.current_price_label = QLabel(f\"<b>Current Price:</b> {current_bid:.6f} DOGE\")\n        form_layout.addRow(self.current_price_label)\n        \n        # Minimum bid\n        self.min_bid_label = QLabel(f\"<b>Minimum Bid:</b> {min_bid:.6f} DOGE\")\n        form_layout.addRow(self.min_bid_label)\n        \n        # Bid amount input\n        self.bid_input = QLineEdit()\n        self.bid_input.setPlaceholderText(f\"Minimum: {min_bid:.6f}\")\n        self.bid_input.setValidator(QDoubleValidator(min_bid, 1_000_000, 6))\n        self.bid_input.textChanged.connect(self.validate_bid)\n        form_layout.addRow(\"Your Bid (DOGE):\", self.bid_input)\n        \n        # Bid history group\n        history_group = QGroupBox(\"Bid History\")\n        history_layout = QVBoxLayout()\n        \n        self.history_browser = QTextBrowser()\n        self.history_browser.setOpenExternalLinks(False)\n        self.history_browser.setReadOnly(True)\n        self.history_browser.setStyleSheet(\"\"\"\n            QTextBrowser {\n                background-color: #f8f9fa;\n                border: 1px solid #dee2e6;\n                border-radius: 4px;\n                padding: 8px;\n                font-family: 'Courier New', monospace;\n                font-size: 12px;\n            }\n        \"\"\")\n        \n        # Add sample bid history (replace with actual data)\n        self.update_bid_history()\n        \n        # Toggle button for history\n        self.toggle_history_btn = QPushButton(\"Show History\")\n        self.toggle_history_btn.setCheckable(True)\n        self.toggle_history_btn.setChecked(False)\n        self.toggle_history_btn.clicked.connect(self.toggle_history)\n        \n        # Initially hide the history\n        self.history_browser.setVisible(False)\n        \n        history_layout.addWidget(self.toggle_history_btn)\n        history_layout.addWidget(self.history_browser)\n        history_group.setLayout(history_layout)\n        \n        # Dialog buttons\n        button_box = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)\n        button_box.accepted.connect(self.accept)\n        button_box.rejected.connect(self.reject)\n        self.ok_button = button_box.button(QDialogButtonBox.Ok)\n        self.ok_button.setEnabled(False)\n        \n        # Add widgets to main layout\n        layout.addLayout(form_layout)\n        layout.addWidget(history_group)\n        layout.addWidget(button_box)\n        \n        self.setLayout(layout)\n        \n        # Store min bid for validation\n        self.min_bid = min_bid\n    \n    def update_bid_history(self):\n        \"\"\"Update the bid history display.\"\"\"\n        # Get bids from item data (default to empty list if not present)\n        bids = self.item_data.get('bids', [])\n        \n        if not bids:\n            self.history_browser.setPlainText(\"No bids yet.\")\n            return\n        \n        # Format the history\n        history_text = []\n        for bid in sorted(bids, key=lambda x: x.get('timestamp', ''), reverse=True):\n            amount = bid.get('amount', 0)\n            bidder = bid.get('bidder', 'Unknown')\n            timestamp = bid.get('timestamp', '')\n            \n            # Format timestamp if available\n            if timestamp:\n                try:\n                    dt = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))\n                    timestamp = dt.strftime('%Y-%m-%d %H:%M:%S')\n                except (ValueError, AttributeError):\n                    pass\n            \n            history_text.append(f\"{timestamp} - {amount:.6f} DOGE by {bidder}\")\n        \n        self.history_browser.setPlainText(\"\\n\".join(history_text))\n    \n    def toggle_history(self):\n        \"\"\"Toggle the visibility of the bid history.\"\"\"\n        is_visible = not self.history_browser.isVisible()\n        self.history_browser.setVisible(is_visible)\n        self.toggle_history_btn.setText(\"Hide History\" if is_visible else \"Show History\")\n        \n        # Resize dialog to fit content\n        self.adjustSize()\n    \n    def validate_bid(self, text):\n        \"\"\"Validate the bid amount.\"\"\"\n        try:\n            bid = float(text) if text else 0\n            is_valid = bid >= self.min_bid\n            self.ok_button.setEnabled(is_valid)\n            \n            # Update text color based on validation\n            if text:\n                if bid < self.min_bid:\n                    self.bid_input.setStyleSheet(\"color: #dc3545;\")\n                else:\n                    self.bid_input.setStyleSheet(\"color: #28a745;\")\n            else:\n                self.bid_input.setStyleSheet(\"\")\n                \n            if is_valid:\n                self.bid_amount = bid\n                \n        except ValueError:\n            self.ok_button.setEnabled(False)\n            self.bid_input.setStyleSheet(\"color: #dc3545;\")\n    \n    def accept(self):\n        \"\"\"Handle accept button click.\"\"\"\n        try:\n            self.bid_amount = float(self.bid_input.text())\n            if self.bid_amount >= self.min_bid:\n                super().accept()\n            else:\n                QMessageBox.warning(self, \"Invalid Bid\", f\"Bid must be at least {self.min_bid:.6f} DOGE\")\n        except ValueError:\n            QMessageBox.warning(self, \"Invalid Input\", \"Please enter a valid bid amount.\")\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main application window.\"\"\"\n    # Signal to show the seed message box on the main thread\n    show_seed_message_box = pyqtSignal()\n    \n    def __init__(self):\n        print(\"Initializing MainWindow...\")\n        super().__init__()\n        print(\"  Setting up attributes...\")\n        self.mock_mode = True  # Ensure mock_mode is set\n        self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n        self.current_user = None\n        self.items = []\n        self._pending_seed = None\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Initialize mock servers\n        from mock_server import MockArweaveDB, MockNanoRPC, MockDogecoinRPC\n        self.mock_server = MockArweaveDB()\n        self.nano_rpc = MockNanoRPC()\n        self.doge_rpc = MockDogecoinRPC()\n        \n        print(\"  Initializing UI...\")\n        self.init_ui_components()\n        \n        # Connect the signal to the slot\n        print(\"  Connecting signals...\")\n        self.show_seed_message_box.connect(self._show_seed_message_box)\n        print(\"  MainWindow initialization complete\")\n        \n        # Initial connection check\n        QTimer.singleShot(1000, self.check_connections)\n        \n        # Start real-time event simulation for demo purposes\n        self.start_event_simulation()\n        \n        # Add initial welcome message with data quality indicator after UI is fully initialized\n        QTimer.singleShot(100, lambda: self.add_message(\"Sapphire Exchange initialized\", \"info\", \"‚úÖ\"))\n\n    def start_event_simulation(self):\n        \"\"\"Start simulating real-time events for demonstration of data quality indicators.\"\"\"\n        self.event_timer = QTimer()\n        self.event_timer.timeout.connect(self.simulate_event)\n        self.event_timer.start(15000)  # Simulate an event every 15 seconds\n        self.event_counter = 0\n    \n    def simulate_event(self):\n        \"\"\"Simulate various types of events with different data quality indicators.\"\"\"\n        import random\n        \n        events = [\n            (\"New bid received on Item #1234\", \"info\", \"pending\"),\n            (\"Arweave transaction confirmed\", \"success\", \"verified\"),\n            (\"DOGE wallet balance updated\", \"info\", \"verified\"),\n            (\"Bid verification in progress\", \"warning\", \"pending\"),\n            (\"RSA signature validation failed\", \"error\", \"failed\"),\n            (\"Nano block confirmation received\", \"success\", \"verified\"),\n            (\"Auction #5678 ended\", \"info\", \"verified\"),\n            (\"New item listed: Vintage Watch\", \"info\", \"pending\"),\n            (\"Payment processing timeout\", \"warning\", \"failed\"),\n            (\"Metadata integrity check passed\", \"success\", \"verified\")\n        ]\n        \n        if self.event_counter < len(events):\n            message, level, quality = events[self.event_counter]\n            self.add_message(message, level, quality)\n            self.event_counter += 1\n        else:\n            # Stop simulation after all demo events\n            self.event_timer.stop()\n    \n    def _show_seed_message_box(self):\n        \"\"\"Show the seed message box on the main thread with copy functionality.\"\"\"\n        try:\n            if not hasattr(self, '_pending_seed') or not self._pending_seed:\n                return\n                \n            seed = self._pending_seed\n            \n            # Set the seed phrase in the input box as well\n            self._set_seed_phrase(seed)\n            \n            # Create a custom message box\n            msg_box = QMessageBox(self)\n            msg_box.setWindowTitle(\"New Wallet Generated\")\n            msg_box.setIcon(QMessageBox.Information)\n            msg_box.setText(\n                \"A new wallet has been generated for you.\\n\\n\"\n                \"IMPORTANT: Please save this seed phrase in a secure location.\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n            \n            # Add the seed phrase in a read-only text field\n            seed_text = QTextEdit()\n            seed_text.setPlainText(seed)\n            seed_text.setReadOnly(True)\n            seed_text.setMinimumWidth(400)\n            seed_text.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed))\n            \n            # Add widgets to layout\n            layout = msg_box.layout()\n            layout.addWidget(QLabel(\"\\nYour seed phrase:\"), 1, 0, 1, 2)\n            layout.addWidget(seed_text, 2, 0, 1, 2)\n            layout.addWidget(QLabel(\" \"), 3, 0)  # Spacer\n            layout.addWidget(copy_btn, 4, 1)\n            \n            # Show the message box\n            msg_box.exec_()\n            \n        except Exception as e:\n            print(f\"Error showing seed message box: {e}\")\n            # Fall back to simple message box if there's an error\n            QMessageBox.information(\n                self, \n                \"New Wallet Generated\", \n                f\"A new wallet has been generated for you.\\n\\n\"\n                f\"IMPORTANT: Please save this seed phrase in a secure location:\\n\\n{seed}\\n\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n        finally:\n            # Clear the pending seed after showing the message\n            if hasattr(self, '_pending_seed'):\n                self._pending_seed = None\n    \n    def init_ui_components(self):\n        \"\"\"Initialize all UI components.\"\"\"\n        self.setWindowTitle(\"Sapphire Exchange\")\n        self.setMinimumSize(1000, 700)\n        \n        # Main layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        \n        # Main layout with status bar at bottom\n        main_layout = QVBoxLayout(main_widget)\n        main_layout.setContentsMargins(0, 0, 0, 0)\n        main_layout.setSpacing(0)\n        \n        # Initialize message history\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Content area with sidebar and main content\n        content_widget = QWidget()\n        content_layout = QHBoxLayout(content_widget)\n        content_layout.setContentsMargins(0, 0, 0, 0)\n        content_layout.setSpacing(0)\n        \n        # Sidebar\n        self.sidebar = self.create_sidebar()\n        content_layout.addWidget(self.sidebar, stretch=1)\n        \n        # Stacked widget for pages\n        self.stacked_widget = QStackedWidget()\n        \n        # Create and add login page\n        self.login_page = self.create_login_page()\n        self.stacked_widget.addWidget(self.login_page)\n        \n        # Create and add other pages\n        self.marketplace_page = self.create_marketplace_page()\n        self.stacked_widget.addWidget(self.marketplace_page)\n        \n        self.item_creation_page = self.create_item_creation_page()\n        self.stacked_widget.addWidget(self.item_creation_page)\n        \n        self.my_items_page = self.create_my_items_page()\n        self.stacked_widget.addWidget(self.my_items_page)\n        \n        # Set login page as initial page\n        self.stacked_widget.setCurrentIndex(0)\n        \n        content_layout.addWidget(self.stacked_widget, stretch=4)\n\n        # Status bar at bottom\n        self.status_bar = QFrame()\n        self.status_bar.setFrameShape(QFrame.StyledPanel)\n        self.status_bar.setStyleSheet(\"\"\"\n            QFrame {\n                background-color: #2c3e50;\n                border-top: 1px solid #34495e;\n                padding: 4px 8px;\n                color: #ecf0f1;\n            }\n            QLabel {\n                color: #ecf0f1;\n                font-size: 12px;\n                margin: 0 5px;\n            }\n            QPushButton {\n                background: transparent;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                padding: 2px 8px;\n                color: #ecf0f1;\n                font-size: 11px;\n            }\n        \"\"\")\n        \n        # Status indicators\n        self.connection_indicators = {}\n        \n        # Status layout\n        status_layout = QHBoxLayout(self.status_bar)\n        status_layout.setContentsMargins(8, 4, 8, 4)\n        status_layout.setSpacing(10)\n        \n        # Status text and timestamp\n        self.status_text = QLabel(\"Connecting...\")\n        self.status_text.setStyleSheet(\"color: #ecf0f1; font-size: 11px;\")\n        \n        # Last updated timestamp\n        self.last_updated = QLabel()\n        self.last_updated.setStyleSheet(\"color: #95a5a6; font-size: 11px;\")\n        \n        # Main status dot\n        self.main_status_indicator = QLabel(\"‚óè\")\n        self.main_status_indicator.setObjectName(\"main_status_indicator\")\n        self.main_status_indicator.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        self.main_status_indicator.mousePressEvent = self.on_status_clicked\n        \n        # Create status indicators for each service\n        services = [\n            ('arweave', '#3498db'),\n            ('nano', '#2ecc71'),\n            ('doge', '#f39c12')\n        ]\n        \n        # Add status widgets to layout\n        status_layout.addWidget(self.main_status_indicator)\n        status_layout.addWidget(self.status_text)\n        status_layout.addSpacing(10)\n        \n        # Container for connection indicators that can be toggled\n        self.indicators_container = QWidget()\n        indicators_layout = QHBoxLayout(self.indicators_container)\n        indicators_layout.setContentsMargins(0, 0, 0, 0)\n        indicators_layout.setSpacing(10)\n        \n        # Add connection indicators\n        for service, color in services:\n            indicator = self.create_status_indicator(service.capitalize(), color)\n            self.connection_indicators[service] = indicator\n            indicators_layout.addWidget(indicator)\n        \n        # Add indicators container to main layout\n        status_layout.addWidget(self.indicators_container)\n        \n        # Add last updated timestamp\n        status_layout.addStretch()\n        status_layout.addWidget(self.last_updated)\n        \n        # Initially show the indicators\n        self.indicators_visible = True\n        \n        # Activity feed as a bottom overlay (popup style)\n        self.activity_widget = self.create_activity_feed()\n        self.activity_widget.setVisible(False)\n        self.activity_widget.setFixedHeight(220)\n        self.activity_widget.setStyleSheet('''\n            QWidget#activityOverlay {\n                background: rgba(248,249,250,0.97);\n                border-top: 2px solid #4a627a;\n                border-radius: 0 0 12px 12px;\n                box-shadow: 0px -4px 16px rgba(44,62,80,0.11);\n            }\n        ''' + self.activity_widget.styleSheet())\n        self.activity_widget.setObjectName('activityOverlay')\n        self.activity_widget.setParent(self.centralWidget())\n        self.activity_widget.raise_()\n        self._position_activity_overlay()\n\n        # Ensure overlay is repositioned on resize\n        self.centralWidget().installEventFilter(self)\n\n        # Toggle Activity Feed button\n        self.toggle_log_btn = QPushButton(\"‚ñ≤ Activity Log\")\n        self.toggle_log_btn.setFixedHeight(20)\n        self.toggle_log_btn.setStyleSheet(\"\"\"\n            QPushButton {\n                font-size: 11px;\n                padding: 0 8px;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                color: #ecf0f1;\n                background: transparent;\n            }\n            QPushButton:hover {\n                background: #3d5366;\n            }\n        \"\"\")\n        self.toggle_log_btn.clicked.connect(self.toggle_activity_log_overlay)\n        status_layout.addWidget(self.toggle_log_btn)\n        \n        # Add status bar to main layout\n        main_layout.addWidget(content_widget, stretch=1)\n        main_layout.addWidget(self.status_bar)\n            \n    def _position_activity_overlay(self):\n        if hasattr(self, 'activity_widget') and self.activity_widget:\n            parent = self.centralWidget()\n            if parent:\n                h = self.activity_widget.height()\n                parent_h = parent.height()\n                parent_w = parent.width()\n                sb_h = self.status_bar.height() if hasattr(self, 'status_bar') else 0\n                self.activity_widget.setFixedWidth(parent_w)\n                self.activity_widget.move(0, parent_h - h - sb_h)\n    \n    def eventFilter(self, obj, event):\n        if obj == self.centralWidget() and event.type() == event.Resize:\n            self._position_activity_overlay()\n        return super().eventFilter(obj, event)\n\n    def toggle_activity_log_overlay(self):\n        if not hasattr(self, 'activity_widget'):\n            return\n        is_visible = self.activity_widget.isVisible()\n        self.activity_widget.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Log\" if is_visible else \"‚ñ≤ Activity Log\")\n        if not is_visible:\n            self._position_activity_overlay()\n        self.adjustSize()\n    \n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n\n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click.\"\"\"\n        # Toggle message log visibility when clicking on any status indicator\n        self.toggle_message_log()\n            \n    def add_message(self, message, level=\"info\", data_quality=\"unknown\"):\n        \"\"\"Add a message to the log with data quality indicator.\n        \n        Args:\n            message (str): The message to add\n            level (str): Message level ('info', 'warning', 'error', 'success')\n            data_quality (str): Data quality status ('verified', 'pending', 'failed', 'unknown')\n        \"\"\"\n        try:\n            # Add timestamp\n            timestamp = datetime.now().strftime(\"%H:%M:%S\")\n            self.message_history.append((timestamp, message, level, data_quality))\n            \n            # Keep only the last max_messages\n            if len(self.message_history) > self.max_messages:\n                self.message_history = self.message_history[-self.max_messages:]\n                \n            # Update the message log if it exists\n            if hasattr(self, 'message_log') and self.message_log is not None:\n                self.update_message_log()\n                \n            # Show error messages in status bar if available\n            if level == \"error\" and hasattr(self, 'status_text') and self.status_text is not None:\n                error_msg = f\"Error: {message[:50]}...\" if len(message) > 50 else f\"Error: {message}\"\n                self.status_text.setText(error_msg)\n                # Clear the error message after 5 seconds\n                QTimer.singleShot(5000, lambda: self.status_text.setText(\"\"))\n                \n            # Print to console for debugging\n            print(f\"[{timestamp}] [{level.upper()}] {message}\")\n            \n            # Ensure the message log is updated in the UI\n            QApplication.processEvents()\n            \n        except Exception as e:\n            print(f\"Error in add_message: {str(e)}\")\n            \n    def update_message_log(self):\n        \"\"\"Update the message log with all messages and data quality indicators.\"\"\"\n        try:\n            if not hasattr(self, 'message_log') or self.message_log is None:\n                return\n                \n            log_text = \"\"\n            for entry in self.message_history:\n                # Handle both old format (3 items) and new format (4 items)\n                if len(entry) == 3:\n                    timestamp, msg, level = entry\n                    data_quality = \"unknown\"\n                else:\n                    timestamp, msg, level, data_quality = entry\n                \n                # Data quality indicator circle\n                if data_quality == \"verified\":\n                    quality_circle = \"<span style='color: #2ecc71;'>‚óè</span>\"  # Green\n                    quality_tooltip = \"Valid Nano & Arweave confirmations\"\n                elif data_quality == \"pending\":\n                    quality_circle = \"<span style='color: #f39c12;'>‚óè</span>\"  # Orange\n                    quality_tooltip = \"Pending or recent bid / not yet verified\"\n                elif data_quality == \"failed\":\n                    quality_circle = \"<span style='color: #e74c3c;'>‚óè</span>\"  # Red\n                    quality_tooltip = \"RSA verification failed / corrupted metadata\"\n                else:\n                    quality_circle = \"<span style='color: #666;'>‚óè</span>\"  # Gray\n                    quality_tooltip = \"Unknown verification status\"\n                \n                # Message color based on level\n                if level == \"error\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#e74c3c'>{timestamp} - {msg}</font><br>\"\n                elif level == \"warning\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#f39c12'>{timestamp} - {msg}</font><br>\"\n                elif level == \"success\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#2ecc71'>{timestamp} - {msg}</font><br>\"\n                else:\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> {timestamp} - {msg}<br>\"\n            \n            self.message_log.setHtml(log_text)\n            \n        except Exception as e:\n            print(f\"Error in update_message_log: {str(e)}\")\n            \n    def toggle_connection_details(self, event=None):\n        \"\"\"Toggle the visibility of connection details.\"\"\"\n        if not hasattr(self, 'connection_details') or self.connection_details is None:\n            return\n            \n        is_visible = self.connection_details.isVisible()\n        self.connection_details.setVisible(not is_visible)\n        self.update_main_status_indicator()\n\n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            service (str): Service name ('arweave', 'nano', 'doge')\n            is_connected (bool): Whether the service is connected\n            error_msg (str, optional): Error message if connection failed\n            status_detail (str, optional): Detailed status information\n        \"\"\"\n        if service not in self.connection_indicators:\n            return\n\n        widget = self.connection_indicators[service]\n        dot = widget.findChild(QLabel, service + \"_dot\")\n\n        if not dot:\n            return\n\n        # Update tooltip with detailed status information\n        if service == 'arweave':\n            if is_connected:\n                tooltip = \"Arweave: Connected\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n\n        widget.setToolTip(tooltip)\n\n        # Update the main status indicator\n        self.update_main_status_indicator()\n        \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated') and self.last_updated is not None:\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n\n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.update_main_status_indicator()\n                return\n                \n            # Check Arweave connection\n            arweave_connected = self.client.check_arweave_connection()\n            self.update_connection_status('arweave', arweave_connected)\n            \n            # Check Nano connection\n            nano_connected = self.client.check_nano_connection()\n            self.update_connection_status('nano', nano_connected)\n            \n            # Check Dogecoin connection\n            doge_connected = self.client.check_dogecoin_connection()\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update the main status indicator\n            self.update_main_status_indicator()\n            \n            # Update the timestamp\n            self.update_timestamp()\n            \n        except Exception as e:\n            print(f\"Error checking connections: {str(e)}\")\n            self.add_message(f\"Error checking connections: {str(e)}\", \"error\")\n            \n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            return\n            \n        # Check Arweave connection\n        arweave_connected = self.client.check_arweave_connection()\n        self.update_connection_status('arweave', arweave_connected)\n        \n        # Check Nano connection\n        nano_connected = self.client.check_nano_connection()\n        self.update_connection_status('nano', nano_connected)\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n        \n        widget.setToolTip(tooltip)\n        \n        # Update the main status indicator\n        self.update_main_status_indicator()\n    \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated'):\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n    \n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.connection_status = False\n                self.status_text.setText(\"Client not initialized\")\n                return\n            \n            # In mock mode, connections should always be available\n            if self.mock_mode:\n                arweave_connected = True\n                nano_connected = True\n                doge_connected = True\n                self.connection_status = True\n            else:\n                # Check actual connections using client's connection status\n                conn_status = getattr(self.client, 'connection_status', {})\n                arweave_connected = conn_status.get('arweave', False)\n                nano_connected = conn_status.get('nano', False)\n                doge_connected = conn_status.get('doge', False)\n                self.connection_status = conn_status.get('overall', False)\n            \n            # Update individual connection statuses\n            self.update_connection_status('arweave', arweave_connected)\n            self.update_connection_status('nano', nano_connected)\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update status text based on overall connection state\n            if self.mock_mode:\n                self.status_text.setText(\"Mock mode - All systems operational\")\n            else:\n                all_connected = arweave_connected and nano_connected and doge_connected\n                self.status_text.setText(\"All systems operational\" if all_connected else \"Some services unavailable\")\n            \n            # Update timestamp\n            self.update_timestamp()\n                \n            # Update the main status indicator\n            if hasattr(self, 'main_status_indicator') and self.main_status_indicator is not None:\n                color = '#2ecc71' if self.connection_status else '#e74c3c'\n                self.main_status_indicator.setStyleSheet(f\"font-size: 16px; color: {color};\")\n                \n                # Update the tooltip with connection status\n                status_text = \"All systems operational\" if self.connection_status else \"Connection issues detected\"\n                self.main_status_indicator.setToolTip(f\"Status: {status_text}\\nClick for details\")\n        except Exception as e:\n            self.status_text.setText(f\"Error checking connections\")\n            self.add_message(f\"Connection check error: {str(e)}\", \"error\", \"failed\")\n            print(f\"Error in check_connections: {e}\")\n            self.connection_status = False\n        \n        # Schedule next check (less frequent to reduce noise)\n        QTimer.singleShot(5000, self.check_connections)\n        \n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click to toggle connection indicators.\"\"\"\n        if not hasattr(self, 'indicators_visible'):\n            return\n            \n        # Toggle visibility of connection indicators\n        self.indicators_visible = not self.indicators_visible\n        self.indicators_container.setVisible(self.indicators_visible)\n        \n        # Update tooltip to indicate current state\n        state = \"Hide\" if self.indicators_visible else \"Show\"\n        self.main_status_indicator.setToolTip(\n            f\"{state} connection indicators\\n\"\n            \"Click to toggle visibility\"\n        )\n            \n    def create_status_indicator(self, name, color):\n        \"\"\"Create a status indicator widget.\n        \n        Args:\n            name (str): Name of the service (e.g., 'Arweave', 'Nano')\n            color (str): Base color for the indicator\n            \n        Returns:\n            QWidget: Configured status indicator widget\n        \"\"\"\n        widget = QWidget()\n        widget.setObjectName(name.lower() + \"_widget\")\n        layout = QHBoxLayout(widget)\n        layout.setContentsMargins(0, 0, 0, 0)\n        layout.setSpacing(5)\n        \n        # Status dot\n        dot = QLabel(\"‚óè\")\n        dot.setObjectName(name.lower() + \"_dot\")\n        dot.setStyleSheet(f\"font-size: 16px; color: #666;\")\n        \n        # Service name\n        label = QLabel(name)\n        label.setStyleSheet(\"font-size: 11px;\")\n        \n        layout.addWidget(dot)\n        layout.addWidget(label)\n        \n        return widget\n    \n    def update_main_status_indicator(self):\n        \"\"\"Update the main status indicator based on connection states.\"\"\"\n        if not hasattr(self, 'connection_indicators'):\n            return\n            \n        # Count connected services\n        connected = 0\n        total_services = len(self.connection_indicators)\n        \n        for service in self.connection_indicators.values():\n            dot = service.findChild(QLabel, service.objectName().replace('_widget', '_dot'))\n            if dot and \"color: #2ecc71\" in dot.styleSheet():\n                connected += 1\n        \n        # Set color and tooltip based on connection state (as per JSON spec)\n        if connected == total_services:\n            color = \"#2ecc71\"  # Green - All connections healthy\n            status_text = \"All connections healthy\"\n        elif connected > 0:\n            color = \"#f39c12\"  # Orange - Partial connection issues\n            status_text = \"Partial connection issues\"\n        else:\n            color = \"#e74c3c\"  # Red - One or more services offline or malfunctioning\n            status_text = \"One or more services offline or malfunctioning\"\n            \n        # Update main indicator with enhanced tooltip\n        style = f\"QLabel#main_status_indicator {{ font-size: 16px; color: {color}; }}\"\n        self.main_status_indicator.setStyleSheet(style)\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        \n        # Update tooltip to reflect current status\n        tooltip = f\"Click to expand error diagnostics\\n\\nStatus: {status_text}\\nConnected: {connected}/{total_services} services\"\n        self.main_status_indicator.setToolTip(tooltip)\n    \n    def toggle_message_log(self):\n        \"\"\"Toggle the visibility of the message log.\"\"\"\n        is_visible = self.message_log.isVisible()\n        self.message_log.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Feed\" if is_visible else \"‚ñ≤ Activity Feed\")\n        \n        # Resize window to fit content\n        self.adjustSize()\n        \n    def create_sidebar(self):\n        \"\"\"Create the sidebar with navigation buttons and user information.\"\"\"\n        self.sidebar = QWidget()\n        self.sidebar.setFixedWidth(200)\n        sidebar_style = (\n            \"QWidget { background-color: #2c3e50; border-right: 1px solid #34495e; }\"\n            \"QPushButton { background-color: transparent; color: #ecf0f1; border: none; padding: 12px 16px; text-align: left; font-size: 14px; font-weight: 500; }\"\n            \"QPushButton:hover { background-color: #34495e; }\"\n            \"QPushButton:checked { background-color: #1abc9c; }\"\n            \"QPushButton:pressed { background-color: #16a085; }\"\n            \"QLabel { color: #ecf0f1; padding: 8px; }\"\n            \"QLabel#user_info { font-size: 12px; padding: 4px 8px; background-color: rgba(0, 0, 0, 0.2); border-radius: 4px; margin: 8px; }\"\n            \"QLabel#user_balance { font-size: 14px; font-weight: bold; color: #1abc9c; }\"\n        )\n        self.sidebar.setStyleSheet(sidebar_style)\n        \n        # Create sidebar layout and store it as instance variable\n        self.sidebar_layout = QVBoxLayout()\n        self.sidebar_layout.setContentsMargins(0, 0, 0, 0)\n        self.sidebar_layout.setSpacing(0)\n        self.sidebar.setLayout(self.sidebar_layout)\n        \n        # Add logo\n        logo_label = QLabel(\"Sapphire Exchange\")\n        logo_label.setAlignment(Qt.AlignCenter)\n        logo_label.setStyleSheet(\n            \"QLabel {\"\n            \"    color: #ecf0f1;\"\n            \"    font-size: 16px;\"\n            \"    font-weight: bold;\"\n            \"    padding: 20px 10px;\"\n            \"    border-bottom: 1px solid #34495e;\"\n            \"}\"\n        )\n        self.sidebar_layout.addWidget(logo_label)\n        \n        # Add navigation buttons\n        self.create_nav_buttons()\n        \n        # Add spacer\n        self.sidebar_layout.addStretch(1)\n        \n        # Add user info (initially hidden)\n        self.user_info_widget = QLabel(\"Not logged in\")\n        self.user_info_widget.setAlignment(Qt.AlignCenter)\n        self.user_info_widget.setStyleSheet(\"QLabel { color: #bdc3c7; font-size: 12px; padding: 10px; border-top: 1px solid #34495e; }\")\n        self.user_info_widget.setVisible(False)\n        self.sidebar_layout.addWidget(self.user_info_widget)\n        \n        # Add logout button (initially hidden)\n        self.logout_btn = QPushButton(\"Logout\")\n        self.logout_btn.setStyleSheet(\"QPushButton { background-color: #e74c3c; color: white; border: none; padding: 10px; margin: 10px; border-radius: 4px; } QPushButton:hover { background-color: #c0392b; }\")\n        self.logout_btn.setVisible(False)\n        self.logout_btn.clicked.connect(self.logout)\n        self.sidebar_layout.addWidget(self.logout_btn)\n        \n        return self.sidebar\n        \n    def create_nav_buttons(self):\n        \"\"\"Create navigation buttons for the sidebar.\"\"\"\n        # Navigation buttons with proper visibility states\n        self.nav_buttons = {\n            \"marketplace_btn\": {\n                \"text\": \"üè†  Marketplace\",\n                \"page_id\": 1,\n                \"visible\": True,  # Always visible\n                \"requires_auth\": False\n            },\n            \"sell_item_btn\": {\n                \"text\": \"üõçÔ∏è  Sell Item\",\n                \"page_id\": 2,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"my_items_btn\": {\n                \"text\": \"üì¶  My Items\",\n                \"page_id\": 3,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"settings_btn\": {\n                \"text\": \"‚öôÔ∏è  Settings\",\n                \"page_id\": 4,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            }\n        }\n        \n        # Create navigation buttons\n        self.nav_button_group = QButtonGroup()\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = QPushButton(btn_data[\"text\"])\n            btn.setCheckable(True)\n            btn.setVisible(btn_data[\"visible\"])\n            btn.setProperty(\"requires_auth\", btn_data[\"requires_auth\"])\n            btn.clicked.connect(lambda checked, p=btn_data[\"page_id\"]: self.show_page(p))\n            self.nav_button_group.addButton(btn, btn_data[\"page_id\"])\n            setattr(self, btn_name, btn)  # Store reference to button\n            self.sidebar_layout.addWidget(btn)\n        \n    def create_login_page(self):\n        \"\"\"Create a simplified login/signup page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setAlignment(Qt.AlignCenter)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        # Logo/Title\n        title = QLabel(\"Sapphire Exchange\")\n        title.setFont(QFont('Arial', 24, QFont.Bold))\n        title.setAlignment(Qt.AlignCenter)\n        layout.addWidget(title)\n        \n        layout.addSpacing(30) \n        card = QWidget()\n        card.setFixedWidth(350)  # Reduced from 400px\n        card.setStyleSheet(\"QWidget { background: white; border-radius: 12px; padding: 25px; border: 1px solid #e0e0e0; }\")\n        \n        form_layout = QVBoxLayout(card)\n        form_layout.setSpacing(20)\n        \n        # Form title\n        form_title = QLabel(\"Welcome Back\")\n        form_title.setFont(QFont('Arial', 16, QFont.Bold))\n        form_title.setAlignment(Qt.AlignCenter)\n        \n        # Seed phrase input\n        seed_label = QLabel(\"Your Seed Phrase:\")\n        self.seed_input = QTextEdit()\n        self.seed_input.setPlaceholderText(\"seed should be 15 to 25 character long\")\n        self.seed_input.setMaximumHeight(80)  # Increased from 60 to 80\n        self.seed_input.setStyleSheet(\"QTextEdit { border: 1px solid #e0e0e0; border-radius: 4px; padding: 8px; font-size: 14px; min-height: 60px; max-height: 80px; } QTextEdit:focus { border: 1px solid #4a6ee0; }\")\n        \n        # New account link\n        new_account_link = QLabel(\n            \"<a href='#' style='color: #2b7bba; text-decoration: none;'>Create a new account</a>\"\n        )\n        new_account_link.setAlignment(Qt.AlignCenter)\n        new_account_link.linkActivated.connect(self.handle_new_account)\n        \n        # Login button\n        self.login_btn = QPushButton(\"Continue\")\n        self.login_btn.setStyleSheet(\"QPushButton { background: #2b7bba; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; font-size: 15px; } QPushButton:hover { background: #1a5a8f; } QPushButton:disabled { background: #cccccc; }\")\n        self.login_btn.clicked.connect(self.handle_login)\n        \n        # Add widgets to form\n        form_layout.addWidget(form_title)\n        form_layout.addWidget(seed_label)\n        form_layout.addWidget(self.seed_input)\n        form_layout.addWidget(new_account_link)\n        form_layout.addWidget(self.login_btn)\n        \n        # Add card to main layout\n        layout.addStretch()\n        layout.addWidget(title)\n        layout.addWidget(card, 0, Qt.AlignCenter)\n        layout.addStretch()\n        \n        # Initialize state\n        self.is_new_user = False\n        \n        return page\n        \n    def handle_new_account(self):\n        \"\"\"Handle new account creation.\"\"\"\n        try:\n            # Generate a nano-compliant BIP-39 seed phrase\n            import secrets\n            wordlist = [\n                'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract', 'absurd', 'abuse',\n                'access', 'accident', 'account', 'accuse', 'achieve', 'acid', 'acoustic', 'across', 'act', 'action',\n                'actor', 'actress', 'actual', 'adapt', 'add', 'addict', 'address', 'adjust', 'admit', 'adult',\n                'advance', 'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'age', 'agent', 'agree',\n                'ahead', 'aim', 'air', 'airport', 'aisle', 'alarm', 'album', 'alcohol', 'alert', 'alien'\n            ]\n            seed_phrase = ' '.join(secrets.choice(wordlist) for _ in range(12))\n            \n            # Create a custom dialog for the seed phrase\n            dialog = QDialog(self)\n            dialog.setWindowTitle(\"Your Recovery Phrase\")\n            dialog.setMinimumWidth(500)\n            dialog.setStyleSheet(\"QDialog { background-color: #f5f5f5; font-family: Arial, sans-serif; } QLabel { color: #333333; font-size: 14px; margin: 5px 0; } QPushButton { background: #2b7bba; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; } QTextEdit { border: 1px solid #cccccc; border-radius: 4px; padding: 10px; background: white; font-family: monospace; font-size: 16px; margin: 10px 0; }\")\n            \n            layout = QVBoxLayout(dialog)\n            \n            # Title\n            title = QLabel(\"Your Wallet Recovery Phrase\")\n            title.setStyleSheet(\"font-size: 18px; font-weight: bold; color: #2b7bba; margin-bottom: 15px;\")\n            \n            # Warning text\n            warning = QLabel(\n                \"Write down these words in the correct order and keep them in a secure location. \"\n                \"You will need this phrase to recover your wallet.\"\n            )\n            warning.setWordWrap(True)\n            warning.setStyleSheet(\"color: #d35400; background: #fdebd0; padding: 10px; border-radius: 4px;\")\n            \n            # Seed phrase display\n            seed_display = QTextEdit()\n            seed_display.setPlainText(seed_phrase)\n            seed_display.setReadOnly(True)\n            seed_display.setMinimumWidth(400)\n            seed_display.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed_phrase))\n            \n            # Confirm button\n            confirm_btn = QPushButton(\"I have saved this seed\")\n            confirm_btn.setStyleSheet(\"background: #27ae60;\")\n            \n            # Add widgets to layout\n            layout.addWidget(title)\n            layout.addWidget(warning)\n            layout.addWidget(QLabel(\"\\nYour recovery phrase:\"))\n            layout.addWidget(seed_display)\n            \n            # Button layout\n            btn_layout = QHBoxLayout()\n            btn_layout.addWidget(copy_btn)\n            btn_layout.addWidget(confirm_btn)\n            \n            layout.addLayout(btn_layout)\n            \n            # Show the dialog\n            dialog.exec_()\n            \n            # Store the seed phrase in a class variable for later use\n            self._pending_seed = seed_phrase\n            \n            # Set the seed phrase directly in the input field\n            success = self._set_seed_phrase(seed_phrase)\n            \n            # If direct setting failed, try again with a small delay\n            if not success:\n                QTimer.singleShot(100, lambda: self._set_seed_phrase(seed_phrase))\n            \n            # Enable login and set flags\n            self.login_btn.setEnabled(True)\n            self.is_new_user = True\n            \n            # Set focus to the login button for better UX\n            self.login_btn.setFocus()\n            \n            # Debug output\n            print(f\"DEBUG: Seed phrase generated: {seed_phrase}\")\n            print(f\"DEBUG: Input field content after setting: '{self.seed_input.toPlainText()}'\")\n            print(f\"DEBUG: Input field has focus: {self.seed_input.hasFocus()}\")\n            \n            # Force a complete UI update\n            QApplication.processEvents()\n            \n            return True\n            \n        except Exception as e:\n            QMessageBox.critical(self, \"Error\", f\"Failed to create account: {str(e)}\")\n            return False\n    \n    def _set_seed_phrase(self, seed_phrase):\n        \"\"\"Set the seed phrase in the input field. Returns True if successful.\"\"\"\n        try:\n            if hasattr(self, 'seed_input') and self.seed_input is not None:\n                self.seed_input.setPlainText(seed_phrase)\n                self.seed_input.setFocus()\n                return True\n            return False\n        except Exception as e:\n            print(f\"Error setting seed phrase: {e}\")\n            return False\n    \n    def handle_login(self):\n        \"\"\"Handle the login process with the provided seed phrase.\"\"\"\n        try:\n            # Get and validate seed phrase\n            seed_phrase = self.seed_input.toPlainText().strip()\n            \n            if not seed_phrase:\n                QMessageBox.warning(self, \"Input Required\", \"Please enter your seed phrase or create a new account.\")\n                return\n                \n            # Validate seed phrase format (basic check)\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Disable login button to prevent multiple clicks\n            self.login_btn.setEnabled(False)\n            self.login_btn.setText(\"Please wait...\")\n            \n            # Clear any previous error messages\n            self.statusBar().clearMessage()\n            \n            # Show status message\n            status_msg = \"Creating your account...\" if self.is_new_user else \"Logging in...\"\n            \n            # Create a worker for the login process\n            worker = AsyncWorker(self.login_async(seed_phrase, None))\n            worker.finished.connect(lambda result: self.on_login_complete(result))\n            worker.error.connect(lambda error: self.on_error(error))\n            worker.start()\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to login: {str(e)}\")\n            print(f\"Login error: {e}\")\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle completion of the login process.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            # Use the sidebar layout that's now properly defined\n            if hasattr(self, 'sidebar_layout') and self.sidebar_layout:\n                for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                    item = self.sidebar_layout.itemAt(i)\n                    if item and item.widget():\n                        btn = item.widget()\n                        if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                            btn.setVisible(True)\n            \n            # Make logout button visible\n            if hasattr(self, 'logout_btn'):\n                self.logout_btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    def create_marketplace_page(self):\n        \"\"\"Create the marketplace page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        # Items grid\n        self.items_grid = QListWidget()\n        self.items_grid.setViewMode(QListWidget.IconMode)\n        self.items_grid.setIconSize(QSize(200, 200))\n        self.items_grid.setResizeMode(QListWidget.Adjust)\n        self.items_grid.setSpacing(20)\n        \n        # Add items grid to layout\n        layout.addWidget(self.items_grid)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        print(\"  Marketplace page created\")\n        return page\n    \n    def create_item_creation_page(self):\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        title = QLabel(\"Create New Item\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Form layout\n        form_layout = QFormLayout()\n        form_layout.setSpacing(15)\n        \n        # Item name\n        self.item_name = QLineEdit()\n        self.item_name.setPlaceholderText(\"Item Name\")\n        form_layout.addRow(\"Item Name:\", self.item_name)\n        \n        # Item description\n        self.item_description = QTextEdit()\n        self.item_description.setPlaceholderText(\"Item Description\")\n        self.item_description.setMaximumHeight(100)\n        form_layout.addRow(\"Description:\", self.item_description)\n        \n        # Starting price\n        self.starting_price = QLineEdit()\n        self.starting_price.setPlaceholderText(\"Starting Price (NANO)\")\n        form_layout.addRow(\"Starting Price (NANO):\", self.starting_price)\n        \n        # Duration (in hours)\n        self.duration = QLineEdit(\"24\")\n        self.duration.setPlaceholderText(\"Auction Duration (hours)\")\n        form_layout.addRow(\"Auction Duration (hours):\", self.duration)\n        \n        # Image upload\n        self.image_path = QLineEdit()\n        self.image_path.setPlaceholderText(\"Image Path\")\n        self.image_path.setReadOnly(True)\n        \n        browse_btn = QPushButton(\"Browse...\")\n        browse_btn.clicked.connect(self.browse_image)\n        \n        image_layout = QHBoxLayout()\n        image_layout.addWidget(self.image_path)\n        image_layout.addWidget(browse_btn)\n        form_layout.addRow(\"Image:\", image_layout)\n        \n        # Add form to layout\n        layout.addWidget(title)\n        layout.addLayout(form_layout)\n        \n        # Create button\n        create_btn = QPushButton(\"Create Item\")\n        create_btn.clicked.connect(self.create_item)\n        layout.addWidget(create_btn, alignment=Qt.AlignRight)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        return page\n    \n    def create_my_items_page(self):\n        \"\"\"Create the 'My Items' page.\"\"\"\n        print(\"Creating My Items page...\")\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        title = QLabel(\"My Items\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Items list\n        print(\"  Creating my_items_list...\")\n        self.my_items_list = QListWidget()\n        self.my_items_list.setViewMode(QListWidget.IconMode)\n        self.my_items_list.setIconSize(QSize(150, 150))\n        self.my_items_list.setResizeMode(QListWidget.Adjust)\n        \n        # Add widgets to layout\n        layout.addWidget(title)\n        layout.addWidget(self.my_items_list)\n        \n        print(\"  My Items page created\")\n        return page\n    \n    def browse_image(self):\n        file_name, _ = QFileDialog.getOpenFileName(\n            self, \"Select Image\", \"\", \"Image Files (*.png *.jpg *.jpeg *.bmp)\")\n        if file_name:\n            self.image_path.setText(file_name)\n    \n    def load_my_items(self):\n        # Load the current user's items.\n        if not hasattr(self, 'my_items_list'):\n            return\n            \n        self.my_items_list.clear()\n        \n        if not self.current_user:\n            self.my_items_list.addItem(\"Please log in to view your items\")\n            return\n            \n        # Show loading indicator\n        self.my_items_list.addItem(\"Loading your items...\")\n        \n        # For now, just clear the loading message\n        # In a real implementation, this would load actual items\n        QTimer.singleShot(1000, lambda: self.my_items_list.clear())\n    \n    def show_page(self, page_index):\n        \"\"\"Show the page at the given index and load appropriate content.\"\"\"\n        if 0 <= page_index < self.stacked_widget.count():\n            self.stacked_widget.setCurrentIndex(page_index)\n            \n            # Load content for the specific page\n            if page_index == 1:  # Marketplace\n                self.load_marketplace_items()\n            elif page_index == 3:  # My Items\n                if hasattr(self, 'my_items_list'):\n                    self.load_my_items()\n                    \n        # Update button states based on login status\n        user_logged_in = hasattr(self, 'current_user') and self.current_user is not None\n        \n        # Update sidebar buttons based on login status\n        sidebar_layout = self.sidebar.layout()\n        if sidebar_layout:\n            for i in range(1, sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(user_logged_in)\n        \n        # Update user info and logout button visibility\n        if hasattr(self, 'user_info_widget'):\n            self.user_info_widget.setVisible(user_logged_in)\n            \n        if hasattr(self, 'logout_btn'):\n            self.logout_btn.setVisible(user_logged_in)\n\n        # Update navigation buttons for guest users\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = getattr(self, btn_name)\n            btn.setVisible(not btn.property(\"requires_auth\"))  # Only show non-auth buttons\n    \n    def logout(self):\n        \"\"\"Handle user logout.\"\"\"\n        self.current_user = None\n        self.client = None\n        \n        # Hide user info\n        if hasattr(self, 'user_info'):\n            self.user_info.setVisible(False)\n        \n        # Reset navigation buttons - only show Marketplace\n        if hasattr(self, 'nav_buttons'):\n            for btn_name, (_, _, _) in self.nav_buttons.items():\n                if hasattr(self, btn_name):\n                    getattr(self, btn_name).setVisible(False)  # Hide all buttons first\n            # Show only marketplace button\n            if hasattr(self, 'marketplace_btn'):\n                self.marketplace_btn.setVisible(True)\n        \n        # Hide other UI elements\n        for btn_name in ['create_item_btn', 'my_items_btn', 'logout_btn']:\n            if hasattr(self, btn_name):\n                getattr(self, btn_name).setVisible(False)\n        \n        # Clear any sensitive data\n        if hasattr(self, 'seed_input'):\n            self.seed_input.clear()\n        \n        # Show login page and add logout message\n        self.show_page(0)  # Assuming page 0 is the login page\n        self.add_message(\"Successfully logged out\", \"info\", \"verified\")\n\n    def create_item(self):\n        # Get form data\n        name = self.item_name.text().strip()\n        description = self.item_description.toPlainText().strip()\n        price_text = self.starting_price.text().strip()\n        duration_text = self.duration.text().strip()\n        \n        # Validate inputs\n        if not name:\n            QMessageBox.warning(self, \"Error\", \"Item name is required\")\n            return\n            \n        try:\n            price = float(price_text)\n            if price <= 0:\n                raise ValueError(\"Price must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid price\")\n            return\n            \n        try:\n            duration = float(duration_text)\n            if duration <= 0:\n                raise ValueError(\"Duration must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid duration\")\n            return\n        \n        # Create a simple loading overlay\n        loading_widget = QWidget(self)\n        loading_widget.setGeometry(self.rect())\n        loading_widget.setStyleSheet(\"background-color: rgba(0, 0, 0, 128);\")\n        \n        loading_layout = QVBoxLayout(loading_widget)\n        loading_label = QLabel(\"Creating your item...\")\n        loading_label.setStyleSheet(\"color: white; font-size: 16px;\")\n        loading_label.setAlignment(Qt.AlignCenter)\n        \n        loading_layout.addWidget(loading_label, 0, Qt.AlignCenter)\n        loading_widget.show()\n        \n        # Make sure the loading widget is on top\n        loading_widget.raise_()\n        \n        def on_item_created(result):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            \n            if result:\n                item, tx_id = result\n                QMessageBox.information(\n                    self,\n                    \"Item Created\",\n                    f\"Item created successfully!\\n\\n\"\n                    f\"Transaction ID: {tx_id}\\n\"\n                    f\"Nano Address: {item.metadata.get('nano_address', 'N/A')}\"\n                )\n                # Clear form\n                self.item_name.clear()\n                self.item_description.clear()\n                self.starting_price.clear()\n                self.duration.setText(\"24\")\n                self.image_path.clear()\n                \n                # Switch to marketplace\n                self.show_page(1)\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to create item\")\n        \n        def on_error(error_msg):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            QMessageBox.critical(self, \"Error\", f\"Failed to create item: {error_msg}\")\n        \n        # Start item creation in a worker thread\n        self.worker = AsyncWorker(\n            self.create_item_async(\n                name=name,\n                description=description,\n                starting_price=price,\n                duration_hours=duration,\n                image_path=self.image_path.text()\n            )\n        )\n        self.worker.finished.connect(on_item_created)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def login_async(self, seed_phrase, user_data=None):\n        \"\"\"\n        Handle the login or account creation process asynchronously.\n        \n        Args:\n            seed_phrase: The seed phrase for login\n            user_data: Not used in simplified flow (kept for compatibility)\n        \n        Returns:\n            User: The authenticated user object\n        \n        Raises:\n            ValueError: If login or account creation fails\n        \"\"\"\n        try:\n            import random\n            import asyncio\n            import time\n            from models import User\n            from decentralized_client import EnhancedDecentralizedClient\n            from nano_utils_fixed import NanoWallet\n            \n            # Simulate network delay (0.5-1.5 seconds)\n            await asyncio.sleep(0.5 + random.random())\n            \n            # Validate seed phrase format\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Initialize client if needed\n            if not hasattr(self, 'client') or self.client is None:\n                self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n            \n            # Connect to the network services\n            connection_status = await self.client.connect()\n            \n            # Check connection status\n            if not connection_status or not self.client.is_connected:\n                error_msg = \"Failed to connect to the network. \"\n                if 'arweave' in connection_status and not connection_status['arweave']:\n                    error_msg += \"Arweave connection failed. \"\n                if 'nano' in connection_status and not connection_status['nano']:\n                    error_msg += \"Nano connection failed. \"\n                if 'doge' in connection_status and not connection_status['doge']:\n                    error_msg += \"Dogecoin connection failed. \"\n                raise ValueError(error_msg.strip())\n            \n            # For new users (coming from handle_new_account)\n            if getattr(self, 'is_new_user', False):\n                print(\"Creating new account with provided seed phrase...\")\n                try:\n                    # Generate a default username\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    \n                    # Initialize user with the provided seed phrase\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n                    \n                    if not user or not hasattr(self.client, 'user_wallet') or not self.client.user_wallet:\n                        raise ValueError(\"Failed to initialize user wallet\")\n                        \n                    print(f\"Created new wallet with address: {self.client.user_wallet.address}\")\n                    return user\n                    \n                except Exception as e:\n                    error_msg = f\"Error creating account: {str(e)}\"\n                    print(error_msg)\n                    raise ValueError(error_msg) from e\n\n            # For existing users\n            print(\"Logging in with existing seed phrase...\")\n            try:\n                # First, try to create a wallet from the seed phrase\n                self.client.user_wallet = await asyncio.get_event_loop().run_in_executor(\n                    None,\n                    lambda: NanoWallet.from_seed(seed_phrase, mock_mode=True)\n                )\n\n                if not self.client.user_wallet or not hasattr(self.client.user_wallet, 'public_key'):\n                    raise ValueError(\"Invalid seed phrase: Could not derive wallet\")\n                \n                # Convert public key to hex for lookup\n                public_key_hex = self.client.user_wallet.public_key.to_ascii(encoding='hex').decode('utf-8')\n                \n                # Try to load user data\n                user = await self.client._load_user_data()\n                \n                if not user:\n                    # If no user data found, check if this is a valid Nano wallet\n                    if not hasattr(self.client.user_wallet, 'address'):\n                        raise ValueError(\"Invalid seed phrase: Not a valid wallet\")\n                        \n                    # For mock mode, we'll create a new user if one doesn't exist\n                    print(\"No existing user found, creating new user...\")\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n            \n                if not user:\n                    raise ValueError(\"Failed to load or create user\")\n                    \n                print(f\"Successfully logged in as {getattr(user, 'username', 'unknown')}\")\n                return user\n                \n            except Exception as e:\n                error_msg = f\"Login failed: {str(e)}\"\n                print(error_msg)\n                raise ValueError(error_msg) from e\n            \n        except Exception as e:\n            error_msg = f\"Login error: {str(e)}\"\n            print(error_msg)\n            raise ValueError(error_msg) from e\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle successful login completion.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = self.sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    async def load_items_async(self):\n        \"\"\"Load all items from the mock database.\"\"\"\n        from mock_server import arweave_db\n        from datetime import datetime, timezone\n        \n        items = []\n        \n        # Get all items from the mock Arweave database\n        for tx_id, item_data in arweave_db.items.items():\n            # Skip items that don't have the expected structure\n            if not isinstance(item_data, dict):\n                continue\n                \n            # Calculate time left\n            time_left = \"N/A\"\n            if 'auction_end_time' in item_data:\n                try:\n                    end_time = datetime.fromisoformat(item_data['auction_end_time'].replace('Z', '+00:00'))\n                    now = datetime.now(timezone.utc)\n                    \n                    if end_time <= now:\n                        time_left = \"Ended\"\n                    else:\n                        delta = end_time - now\n                        if delta.days > 0:\n                            time_left = f\"{delta.days}d {delta.seconds // 3600}h\"\n                        else:\n                            hours = delta.seconds // 3600\n                            minutes = (delta.seconds % 3600) // 60\n                            time_left = f\"{hours}h {minutes}m\"\n                except (ValueError, TypeError):\n                    pass\n            \n            # Create item dictionary for the UI\n            item = {\n                'id': tx_id,\n                'name': item_data.get('name', 'Unnamed Item'),\n                'description': item_data.get('description', 'No description'),\n                'starting_price': float(item_data.get('starting_price', 0.0)),\n                'current_bid': float(item_data.get('starting_price', 0.0)),  # In a real app, this would track the highest bid\n                'owner': item_data.get('original_owner', 'Unknown'),\n                'auction_end_time': item_data.get('auction_end_time', ''),\n                'nano_address': item_data.get('nano_address', '')\n            }\n            items.append(item)\n        \n        # If no items found in mock database, add some sample items\n        if not items and hasattr(self, 'mock_mode') and self.mock_mode:\n            sample_items = [\n                {\n                    'name': 'Sample Digital Art',\n                    'description': 'A beautiful piece of digital artwork',\n                    'starting_price': 10.5,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=24)).isoformat(),\n                    'original_owner': 'sample_owner_1',\n                    'nano_address': 'nano_sample1234567890'\n                },\n                {\n                    'name': 'Rare Collectible',\n                    'description': 'A limited edition collectible item',\n                    'starting_price': 25.0,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=12)).isoformat(),\n                    'original_owner': 'sample_owner_2',\n                    'nano_address': 'nano_sample0987654321'\n                }\n            ]\n            \n            for item_data in sample_items:\n                tx_id = arweave_db.store_data(item_data)\n                item = {\n                    'id': tx_id,\n                    'name': item_data['name'],\n                    'description': item_data['description'],\n                    'starting_price': float(item_data['starting_price']),\n                    'current_bid': float(item_data['starting_price']),\n                    'owner': item_data['original_owner'],\n                    'auction_end_time': item_data['auction_end_time'],\n                    'nano_address': item_data['nano_address']\n                }\n                items.append(item)\n        \n        return items\n    \n    async def load_user_items_async(self):\n        \"\"\"Load items owned by the current user.\"\"\"\n        if not self.current_user:\n            return []\n            \n        # Get all items and filter by owner\n        all_items = await self.load_items_async()\n        return [item for item in all_items if item.get('owner') == self.current_user.public_key]\n    \n    async def create_item_async(self, name, description, starting_price, duration_hours, image_path=None):\n        try:\n            if not self.client or not self.current_user:\n                raise ValueError(\"Not logged in or client not initialized\")\n                \n            # Create the item using the decentralized client\n            # client.create_item returns a tuple of (item_data, tx_id)\n            item_data, tx_id = await self.client.create_item(\n                name=name,\n                description=description,\n                starting_price=starting_price,\n                duration_hours=duration_hours,\n                image_data=image_path.encode() if image_path else None\n            )\n            \n            # Add to local items list for UI updates\n            if item_data:\n                self.items.append(item_data)\n            \n            # Return both the item data and transaction ID\n            return item_data, tx_id\n            \n        except Exception as e:\n            print(f\"Error creating item: {e}\")\n            raise\n    \n    def on_bid_clicked(self, item_data):\n        # Show custom bid dialog with history\n        dialog = BidDialog(item_data, self)\n        if dialog.exec_() == QDialog.Accepted:\n            self.place_bid(item_data['id'], dialog.bid_amount)\n    \n    def place_bid(self, item_id, amount):\n        # Show loading indicator\n        loading_msg = QMessageBox(self)\n        loading_msg.setWindowTitle(\"Placing Bid\")\n        loading_msg.setText(f\"Placing bid of {amount} DOGE...\")\n        loading_msg.setStandardButtons(QMessageBox.NoButton)\n        loading_msg.show()\n        \n        def on_bid_placed(result):\n            loading_msg.close()\n            if result:\n                self.add_message(\"Bid placed successfully!\", \"success\", \"pending\")\n                QMessageBox.information(\n                    self,\n                    \"Bid Placed\",\n                    f\"Your bid of {amount} DOGE has been placed!\\n\\n\"\n                    f\"Transaction ID: {result}\"\n                )\n                # Refresh marketplace\n                self.load_marketplace_items()\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to place bid\")\n        \n        def on_error(error_msg):\n            loading_msg.close()\n            self.add_message(f\"Bid failed: {str(error_msg)}\", \"error\", \"failed\")\n            QMessageBox.critical(self, \"Error\", f\"Failed to place bid: {error_msg}\")\n        \n        # Start bid process in a worker thread\n        self.worker = AsyncWorker(self.place_bid_async(item_id, amount))\n        self.worker.finished.connect(on_bid_placed)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def place_bid_async(self, item_id, amount):\n        # In a real implementation, this would use the EnhancedDecentralizedClient\n        # For now, return a mock transaction ID\n        return f\"mock_bid_tx_{item_id}_{int(amount * 1e6)}\"\n\n    def on_error(self, error):\n        print(f\"Error: {error}\")\n\n    def load_marketplace_items(self):\n        \"\"\"Load marketplace items from the mock server.\"\"\"\n        try:\n            print(\"Loading marketplace items...\")\n            \n            # Show loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.show()\n            \n            # Clear existing items\n            if hasattr(self, 'marketplace_list') and self.marketplace_list:\n                self.marketplace_list.clear()\n            \n            # Get items from mock server\n            items = self.mock_server.get_marketplace_items()\n            \n            if items:\n                for item in items:\n                    # Create item widget\n                    item_widget = self.create_marketplace_item_widget(item)\n                    if item_widget:\n                        list_item = QListWidgetItem()\n                        list_item.setSizeHint(item_widget.sizeHint())\n                        self.marketplace_list.addItem(list_item)\n                        self.marketplace_list.setItemWidget(list_item, item_widget)\n            \n            print(f\"Loaded {len(items)} marketplace items\")\n            \n            # Hide loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n                \n        except Exception as e:\n            print(f\"Error loading marketplace items: {e}\")\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n            if hasattr(self, 'add_message'):\n                self.add_message(f\"Failed to load marketplace items: {str(e)}\", \"error\", \"‚ö†Ô∏è\")\n\n    def create_marketplace_item_widget(self, item):\n        \"\"\"Create a widget for displaying a marketplace item.\"\"\"\n        try:\n            widget = QWidget()\n            layout = QHBoxLayout()\n            layout.setContentsMargins(10, 10, 10, 10)\n            \n            # Item image\n            image_label = QLabel()\n            image_label.setFixedSize(60, 60)\n            image_label.setStyleSheet(\"QLabel { background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; }\")\n            \n            # Item details\n            details_layout = QVBoxLayout()\n            \n            # Title\n            title_label = QLabel(item.get('title', 'Untitled Item'))\n            title_label.setStyleSheet(\"QLabel { font-weight: bold; font-size: 14px; }\")\n            \n            # Price\n            price_label = QLabel(f\"{item.get('price', 0)} {item.get('currency', 'NANO')}\")\n            price_label.setStyleSheet(\"QLabel { color: #27ae60; font-size: 16px; font-weight: bold; }\")\n            \n            # Description\n            desc_label = QLabel(item.get('description', 'No description available'))\n            desc_label.setStyleSheet(\"QLabel { color: #7f8c8d; font-size: 12px; }\")\n            desc_label.setWordWrap(True)\n            desc_label.setMaximumWidth(300)\n            \n            details_layout.addWidget(title_label)\n            details_layout.addWidget(price_label)\n            details_layout.addWidget(desc_label)\n            \n            layout.addWidget(image_label)\n            layout.addLayout(details_layout)\n            layout.addStretch()\n            \n            widget.setLayout(layout)\n            return widget\n            \n        except Exception as e:\n            print(f\"Error creating marketplace item widget: {e}\")\n            return None\n\n    def toggle_activity_feed(self):\n        \"\"\"Toggle the visibility of the activity feed.\"\"\"\n        if hasattr(self, 'activity_widget'):\n            is_visible = self.activity_widget.isVisible()\n            self.activity_widget.setVisible(not is_visible)\n            \n            # Update toggle button arrow\n            if hasattr(self, 'activity_toggle_btn'):\n                self.activity_toggle_btn.setText(\"‚ñ≤\" if is_visible else \"‚ñº\")\n\n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n",
                    "language": "python"
                },
                "codebaseEnabled": true
            },
            "createdAt": 1754366519252,
            "isInternal": false,
            "rawContent": {
                "type": "doc",
                "content": [
                    {
                        "type": "paragraph",
                        "content": [
                            {
                                "type": "text",
                                "text": "many errors on the main_window.py file can you repair."
                            }
                        ]
                    }
                ]
            },
            "autoAppliedRules": [
                {
                    "name": "Repository Information Overview",
                    "description": "Repository Information Overview",
                    "uri": "zen-rules://repo/repo",
                    "content": "\n\n# Sapphire Exchange Information\n\n## Summary\nSapphire Exchange is a decentralized auction platform built on Arweave and Nano blockchains. It enables users to list, bid on, and purchase items with secure blockchain transactions. The application provides decentralized storage on Arweave, fast and feeless Nano transactions, secure wallet management, and a timed auction system.\n\n## Structure\n- **app.py**: Main application entry point\n- **main_window.py**: PyQt5-based UI implementation\n- **models.py**: Data models for users, items, and auctions\n- **database.py**: Database module using Arweave for storage\n- **arweave_utils.py**: Handles interactions with Arweave blockchain\n- **nano_utils.py**: Manages Nano wallet and transaction functionality\n- **decentralized_client.py**: Client for interacting with blockchain networks\n- **mock_servers.py**: Mock implementations for testing without real blockchain\n- **test_marketplace.py**: Test script for verifying marketplace functionality\n\n## Language & Runtime\n**Language**: Python\n**Version**: 3.7+\n**Build System**: pip (Python package manager)\n**Package Manager**: pip\n\n## Dependencies\n**Main Dependencies**:\n- PyArweave==0.6.0: Arweave blockchain integration\n- python-dotenv>=0.19.2: Environment variable management\n- requests>=2.28.0: HTTP requests\n- base58>=2.1.1: Base58 encoding/decoding\n- cryptography>=3.4.7: Cryptographic operations\n- ed25519-blake2b==1.4.1: Digital signatures\n- pynacl>=1.4.0: Cryptographic library\n- pycryptodome>=3.20.0: Cryptographic primitives\n- PyQt5>=5.15.9: GUI framework\n- qrcode>=7.4.2: QR code generation\n- Pillow>=9.5.0: Image processing\n\n**Development Dependencies**:\n- Not explicitly specified in requirements.txt\n\n## Build & Installation\n```bash\n# Create and activate virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install dependencies\npip install -r requirements.txt\n\n# Set up environment variables\n# Create .env file with:\n# ARWEAVE_GATEWAY_URL=https://arweave.net\n# ARWEAVE_WALLET_FILE=wallet.json\n# NANO_NODE_URL=https://mynano.ninja/api\n# NANO_REPRESENTATIVE=nano_3t6k35gi95xu6tergt6p69ck76ogmitsa8mnijtpxm9fkcm736xtoncuohr3\n```\n\n## Usage\n```bash\n# Run the application\npython app.py\n```\n\n## Testing\n**Framework**: Custom testing with mock implementations\n**Test Location**: test_marketplace.py\n**Mock Implementation**: mock_servers.py provides simulated blockchain environments\n**Run Command**:\n```bash\npython test_marketplace.py\n```\n\n## Features\n- **Decentralized Storage**: Item data stored on Arweave blockchain\n- **Nano Integration**: Fast, feeless Nano transactions for bidding and purchasing\n- **Secure Wallet Management**: Built-in wallet generation and management\n- **Auction System**: Support for timed auctions with automatic finalization\n- **Mock Mode**: Testing environment that simulates blockchain operations\n- **PyQt5 GUI**: Desktop application interface for user interaction"
                }
            ]
        },
        {
            "id": "381d5ebc-0066-41bd-86ae-a8355f080edb",
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "many errors on the main_window.py file can you repair."
                }
            ],
            "context": {
                "currentFile": {
                    "path": "main_window.py",
                    "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py",
                    "sources": [
                        "opened_tab"
                    ],
                    "content": "\"\"\"\nSapphire Exchange - Main Application Window\n\nThis module contains the main PyQt5-based UI for the Sapphire Exchange desktop application.\n\"\"\"\nimport sys\nimport asyncio\nimport qrcode\nimport time\nfrom datetime import datetime, timedelta, timezone\nfrom PyQt5.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, \n                             QLabel, QPushButton, QStackedWidget, QLineEdit, QTextEdit, \n                             QMessageBox, QScrollArea, QFrame, QFileDialog, QInputDialog, \n                             QDialog, QDialogButtonBox, QFormLayout, QGroupBox, QTextBrowser,\n                             QListWidget, QListWidgetItem, QTabWidget, QButtonGroup)\nfrom PyQt5 import QtGui\nfrom PyQt5.QtCore import Qt, QThread, pyqtSignal, QSize, QTimer, pyqtSlot, QPropertyAnimation, QEasingCurve\nfrom PyQt5.QtGui import (QFont, QPixmap, QIcon, QTextCursor, QTextCharFormat, QColor, \n                         QFontMetrics, QDoubleValidator)\n\nfrom decentralized_client import EnhancedDecentralizedClient\nfrom models import Item, Auction, User, Bid\nfrom dogecoin_utils import DogeWalletManager\nfrom security_manager import SecurityManager, SessionManager\nfrom performance_manager import PerformanceManager\nfrom price_service import PriceConversionService, get_price_service\nfrom wallet_widget import MultiCurrencyWalletWidget\nfrom auction_widget import AuctionListWidget, AuctionDetailsWidget, CreateAuctionDialog\n\nclass AsyncWorker(QThread):\n    \"\"\"Worker thread for running async functions.\"\"\"\n    finished = pyqtSignal(object)\n    error = pyqtSignal(str)\n    \n    def __init__(self, coro):\n        super().__init__()\n        self.coro = coro\n        self._is_running = True\n        self.loop = None\n    \n    def run(self):\n        try:\n            self.loop = asyncio.new_event_loop()\n            asyncio.set_event_loop(self.loop)\n            if asyncio.iscoroutine(self.coro):\n                result = self.loop.run_until_complete(self.coro)\n            else:\n                result = self.coro  # In case it's not a coroutine\n            self.finished.emit(result)\n        except Exception as e:\n            self.error.emit(str(e))\n        finally:\n            self._is_running = False\n            if self.loop:\n                self.loop.close()\n    \n    def stop(self):\n        print(\"[AsyncWorker] stop() called. isRunning:\", self.isRunning(), \"_is_running:\", self._is_running)\n        self._is_running = False\n        if self.loop and self.loop.is_running():\n            print(\"[AsyncWorker] Stopping event loop...\")\n            self.loop.call_soon_threadsafe(self.loop.stop)\n        if self.isRunning():\n            print(\"[AsyncWorker] Quitting thread...\")\n            self.quit()\n            self.wait()\n        print(\"[AsyncWorker] stop() complete.\")\n    \n    def __del__(self):\n        print(\"[AsyncWorker] __del__ called.\")\n        try:\n            self.stop()\n        except RuntimeError:\n            print(\"[AsyncWorker] RuntimeError in __del__ (object deleted)\")\n            pass\n\nclass ItemWidget(QWidget):\n    \"\"\"Widget for displaying an item in the marketplace.\"\"\"\n    # Signal emitted when the bid button is clicked\n    bid_clicked = pyqtSignal(dict)  # Signal to emit the item data\n    \n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.init_ui()\n        \n    def init_ui(self):\n        layout = QVBoxLayout()\n        \n        # Item image (placeholder for now)\n        self.image_label = QLabel()\n        self.image_label.setFixedSize(200, 200)\n        self.image_label.setStyleSheet(\"background-color: #f0f0f0; border: 1px solid #ddd;\")\n        \n        # Item details\n        self.name_label = QLabel(self.item_data.get('name', 'Unnamed Item'))\n        self.name_label.setFont(QFont('Arial', 12, QFont.Bold))\n        \n        self.price_label = QLabel(f\"Price: {self.item_data.get('starting_price', 0)} DOGE\")\n        self.seller_label = QLabel(f\"Seller: {self.item_data.get('owner', 'Unknown')}\")\n        \n        # Bid button\n        self.bid_button = QPushButton(\"Place Bid\")\n        self.bid_button.clicked.connect(self.on_bid_clicked)\n        \n        # Add widgets to layout\n        layout.addWidget(self.image_label)\n        layout.addWidget(self.name_label)\n        layout.addWidget(self.price_label)\n        layout.addWidget(self.seller_label)\n        layout.addWidget(self.bid_button)\n        \n        self.setLayout(layout)\n    \n    def on_bid_clicked(self):\n        # Emit the signal with the item data\n        self.bid_clicked.emit(self.item_data)\n\nclass BidDialog(QDialog):\n    \"\"\"Custom dialog for placing bids with bid history.\"\"\"\n    def __init__(self, item_data, parent=None):\n        super().__init__(parent)\n        self.item_data = item_data\n        self.bid_amount = 0\n        self.init_ui()\n    \n    def init_ui(self):\n        self.setWindowTitle(f\"Bid on {self.item_data.get('name', 'Item')}\")\n        self.setMinimumWidth(400)\n        \n        layout = QVBoxLayout()\n        \n        # Current price and minimum bid\n        current_bid = float(self.item_data.get('current_bid', self.item_data.get('starting_price', 0)))\n        min_bid = max(current_bid * 1.1, current_bid + 0.1)  # 10% minimum increase or 0.1 NANO\n        \n        # Bid form\n        form_layout = QFormLayout()\n        \n        # Current price\n        self.current_price_label = QLabel(f\"<b>Current Price:</b> {current_bid:.6f} DOGE\")\n        form_layout.addRow(self.current_price_label)\n        \n        # Minimum bid\n        self.min_bid_label = QLabel(f\"<b>Minimum Bid:</b> {min_bid:.6f} DOGE\")\n        form_layout.addRow(self.min_bid_label)\n        \n        # Bid amount input\n        self.bid_input = QLineEdit()\n        self.bid_input.setPlaceholderText(f\"Minimum: {min_bid:.6f}\")\n        self.bid_input.setValidator(QDoubleValidator(min_bid, 1_000_000, 6))\n        self.bid_input.textChanged.connect(self.validate_bid)\n        form_layout.addRow(\"Your Bid (DOGE):\", self.bid_input)\n        \n        # Bid history group\n        history_group = QGroupBox(\"Bid History\")\n        history_layout = QVBoxLayout()\n        \n        self.history_browser = QTextBrowser()\n        self.history_browser.setOpenExternalLinks(False)\n        self.history_browser.setReadOnly(True)\n        self.history_browser.setStyleSheet(\"\"\"\n            QTextBrowser {\n                background-color: #f8f9fa;\n                border: 1px solid #dee2e6;\n                border-radius: 4px;\n                padding: 8px;\n                font-family: 'Courier New', monospace;\n                font-size: 12px;\n            }\n        \"\"\")\n        \n        # Add sample bid history (replace with actual data)\n        self.update_bid_history()\n        \n        # Toggle button for history\n        self.toggle_history_btn = QPushButton(\"Show History\")\n        self.toggle_history_btn.setCheckable(True)\n        self.toggle_history_btn.setChecked(False)\n        self.toggle_history_btn.clicked.connect(self.toggle_history)\n        \n        # Initially hide the history\n        self.history_browser.setVisible(False)\n        \n        history_layout.addWidget(self.toggle_history_btn)\n        history_layout.addWidget(self.history_browser)\n        history_group.setLayout(history_layout)\n        \n        # Dialog buttons\n        button_box = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)\n        button_box.accepted.connect(self.accept)\n        button_box.rejected.connect(self.reject)\n        self.ok_button = button_box.button(QDialogButtonBox.Ok)\n        self.ok_button.setEnabled(False)\n        \n        # Add widgets to main layout\n        layout.addLayout(form_layout)\n        layout.addWidget(history_group)\n        layout.addWidget(button_box)\n        \n        self.setLayout(layout)\n        \n        # Store min bid for validation\n        self.min_bid = min_bid\n    \n    def update_bid_history(self):\n        \"\"\"Update the bid history display.\"\"\"\n        # Get bids from item data (default to empty list if not present)\n        bids = self.item_data.get('bids', [])\n        \n        if not bids:\n            self.history_browser.setPlainText(\"No bids yet.\")\n            return\n        \n        # Format the history\n        history_text = []\n        for bid in sorted(bids, key=lambda x: x.get('timestamp', ''), reverse=True):\n            amount = bid.get('amount', 0)\n            bidder = bid.get('bidder', 'Unknown')\n            timestamp = bid.get('timestamp', '')\n            \n            # Format timestamp if available\n            if timestamp:\n                try:\n                    dt = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))\n                    timestamp = dt.strftime('%Y-%m-%d %H:%M:%S')\n                except (ValueError, AttributeError):\n                    pass\n            \n            history_text.append(f\"{timestamp} - {amount:.6f} DOGE by {bidder}\")\n        \n        self.history_browser.setPlainText(\"\\n\".join(history_text))\n    \n    def toggle_history(self):\n        \"\"\"Toggle the visibility of the bid history.\"\"\"\n        is_visible = not self.history_browser.isVisible()\n        self.history_browser.setVisible(is_visible)\n        self.toggle_history_btn.setText(\"Hide History\" if is_visible else \"Show History\")\n        \n        # Resize dialog to fit content\n        self.adjustSize()\n    \n    def validate_bid(self, text):\n        \"\"\"Validate the bid amount.\"\"\"\n        try:\n            bid = float(text) if text else 0\n            is_valid = bid >= self.min_bid\n            self.ok_button.setEnabled(is_valid)\n            \n            # Update text color based on validation\n            if text:\n                if bid < self.min_bid:\n                    self.bid_input.setStyleSheet(\"color: #dc3545;\")\n                else:\n                    self.bid_input.setStyleSheet(\"color: #28a745;\")\n            else:\n                self.bid_input.setStyleSheet(\"\")\n                \n            if is_valid:\n                self.bid_amount = bid\n                \n        except ValueError:\n            self.ok_button.setEnabled(False)\n            self.bid_input.setStyleSheet(\"color: #dc3545;\")\n    \n    def accept(self):\n        \"\"\"Handle accept button click.\"\"\"\n        try:\n            self.bid_amount = float(self.bid_input.text())\n            if self.bid_amount >= self.min_bid:\n                super().accept()\n            else:\n                QMessageBox.warning(self, \"Invalid Bid\", f\"Bid must be at least {self.min_bid:.6f} DOGE\")\n        except ValueError:\n            QMessageBox.warning(self, \"Invalid Input\", \"Please enter a valid bid amount.\")\n\nclass MainWindow(QMainWindow):\n    \"\"\"Main application window.\"\"\"\n    # Signal to show the seed message box on the main thread\n    show_seed_message_box = pyqtSignal()\n    \n    def __init__(self):\n        print(\"Initializing MainWindow...\")\n        super().__init__()\n        print(\"  Setting up attributes...\")\n        self.mock_mode = True  # Ensure mock_mode is set\n        self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n        self.current_user = None\n        self.items = []\n        self._pending_seed = None\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Initialize mock servers\n        from mock_server import MockArweaveDB, MockNanoRPC, MockDogecoinRPC\n        self.mock_server = MockArweaveDB()\n        self.nano_rpc = MockNanoRPC()\n        self.doge_rpc = MockDogecoinRPC()\n        \n        print(\"  Initializing UI...\")\n        self.init_ui_components()\n        \n        # Connect the signal to the slot\n        print(\"  Connecting signals...\")\n        self.show_seed_message_box.connect(self._show_seed_message_box)\n        print(\"  MainWindow initialization complete\")\n        \n        # Initial connection check\n        QTimer.singleShot(1000, self.check_connections)\n        \n        # Start real-time event simulation for demo purposes\n        self.start_event_simulation()\n        \n        # Add initial welcome message with data quality indicator after UI is fully initialized\n        QTimer.singleShot(100, lambda: self.add_message(\"Sapphire Exchange initialized\", \"info\", \"‚úÖ\"))\n\n    def start_event_simulation(self):\n        \"\"\"Start simulating real-time events for demonstration of data quality indicators.\"\"\"\n        self.event_timer = QTimer()\n        self.event_timer.timeout.connect(self.simulate_event)\n        self.event_timer.start(15000)  # Simulate an event every 15 seconds\n        self.event_counter = 0\n    \n    def simulate_event(self):\n        \"\"\"Simulate various types of events with different data quality indicators.\"\"\"\n        import random\n        \n        events = [\n            (\"New bid received on Item #1234\", \"info\", \"pending\"),\n            (\"Arweave transaction confirmed\", \"success\", \"verified\"),\n            (\"DOGE wallet balance updated\", \"info\", \"verified\"),\n            (\"Bid verification in progress\", \"warning\", \"pending\"),\n            (\"RSA signature validation failed\", \"error\", \"failed\"),\n            (\"Nano block confirmation received\", \"success\", \"verified\"),\n            (\"Auction #5678 ended\", \"info\", \"verified\"),\n            (\"New item listed: Vintage Watch\", \"info\", \"pending\"),\n            (\"Payment processing timeout\", \"warning\", \"failed\"),\n            (\"Metadata integrity check passed\", \"success\", \"verified\")\n        ]\n        \n        if self.event_counter < len(events):\n            message, level, quality = events[self.event_counter]\n            self.add_message(message, level, quality)\n            self.event_counter += 1\n        else:\n            # Stop simulation after all demo events\n            self.event_timer.stop()\n    \n    def _show_seed_message_box(self):\n        \"\"\"Show the seed message box on the main thread with copy functionality.\"\"\"\n        try:\n            if not hasattr(self, '_pending_seed') or not self._pending_seed:\n                return\n                \n            seed = self._pending_seed\n            \n            # Set the seed phrase in the input box as well\n            self._set_seed_phrase(seed)\n            \n            # Create a custom message box\n            msg_box = QMessageBox(self)\n            msg_box.setWindowTitle(\"New Wallet Generated\")\n            msg_box.setIcon(QMessageBox.Information)\n            msg_box.setText(\n                \"A new wallet has been generated for you.\\n\\n\"\n                \"IMPORTANT: Please save this seed phrase in a secure location.\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n            \n            # Add the seed phrase in a read-only text field\n            seed_text = QTextEdit()\n            seed_text.setPlainText(seed)\n            seed_text.setReadOnly(True)\n            seed_text.setMinimumWidth(400)\n            seed_text.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed))\n            \n            # Add widgets to layout\n            layout = msg_box.layout()\n            layout.addWidget(QLabel(\"\\nYour seed phrase:\"), 1, 0, 1, 2)\n            layout.addWidget(seed_text, 2, 0, 1, 2)\n            layout.addWidget(QLabel(\" \"), 3, 0)  # Spacer\n            layout.addWidget(copy_btn, 4, 1)\n            \n            # Show the message box\n            msg_box.exec_()\n            \n        except Exception as e:\n            print(f\"Error showing seed message box: {e}\")\n            # Fall back to simple message box if there's an error\n            QMessageBox.information(\n                self, \n                \"New Wallet Generated\", \n                f\"A new wallet has been generated for you.\\n\\n\"\n                f\"IMPORTANT: Please save this seed phrase in a secure location:\\n\\n{seed}\\n\\n\"\n                \"You will need this seed phrase to recover your wallet.\"\n            )\n        finally:\n            # Clear the pending seed after showing the message\n            if hasattr(self, '_pending_seed'):\n                self._pending_seed = None\n    \n    def init_ui_components(self):\n        \"\"\"Initialize all UI components.\"\"\"\n        self.setWindowTitle(\"Sapphire Exchange\")\n        self.setMinimumSize(1000, 700)\n        \n        # Main layout\n        main_widget = QWidget()\n        self.setCentralWidget(main_widget)\n        \n        # Main layout with status bar at bottom\n        main_layout = QVBoxLayout(main_widget)\n        main_layout.setContentsMargins(0, 0, 0, 0)\n        main_layout.setSpacing(0)\n        \n        # Initialize message history\n        self.message_history = []\n        self.max_messages = 100  # Maximum number of messages to keep in history\n        \n        # Content area with sidebar and main content\n        content_widget = QWidget()\n        content_layout = QHBoxLayout(content_widget)\n        content_layout.setContentsMargins(0, 0, 0, 0)\n        content_layout.setSpacing(0)\n        \n        # Sidebar\n        self.sidebar = self.create_sidebar()\n        content_layout.addWidget(self.sidebar, stretch=1)\n        \n        # Stacked widget for pages\n        self.stacked_widget = QStackedWidget()\n        \n        # Create and add login page\n        self.login_page = self.create_login_page()\n        self.stacked_widget.addWidget(self.login_page)\n        \n        # Create and add other pages\n        self.marketplace_page = self.create_marketplace_page()\n        self.stacked_widget.addWidget(self.marketplace_page)\n        \n        self.item_creation_page = self.create_item_creation_page()\n        self.stacked_widget.addWidget(self.item_creation_page)\n        \n        self.my_items_page = self.create_my_items_page()\n        self.stacked_widget.addWidget(self.my_items_page)\n        \n        # Set login page as initial page\n        self.stacked_widget.setCurrentIndex(0)\n        \n        content_layout.addWidget(self.stacked_widget, stretch=4)\n\n        # Status bar at bottom\n        self.status_bar = QFrame()\n        self.status_bar.setFrameShape(QFrame.StyledPanel)\n        self.status_bar.setStyleSheet(\"\"\"\n            QFrame {\n                background-color: #2c3e50;\n                border-top: 1px solid #34495e;\n                padding: 4px 8px;\n                color: #ecf0f1;\n            }\n            QLabel {\n                color: #ecf0f1;\n                font-size: 12px;\n                margin: 0 5px;\n            }\n            QPushButton {\n                background: transparent;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                padding: 2px 8px;\n                color: #ecf0f1;\n                font-size: 11px;\n            }\n        \"\"\")\n        \n        # Status indicators\n        self.connection_indicators = {}\n        \n        # Status layout\n        status_layout = QHBoxLayout(self.status_bar)\n        status_layout.setContentsMargins(8, 4, 8, 4)\n        status_layout.setSpacing(10)\n        \n        # Status text and timestamp\n        self.status_text = QLabel(\"Connecting...\")\n        self.status_text.setStyleSheet(\"color: #ecf0f1; font-size: 11px;\")\n        \n        # Last updated timestamp\n        self.last_updated = QLabel()\n        self.last_updated.setStyleSheet(\"color: #95a5a6; font-size: 11px;\")\n        \n        # Main status dot\n        self.main_status_indicator = QLabel(\"‚óè\")\n        self.main_status_indicator.setObjectName(\"main_status_indicator\")\n        self.main_status_indicator.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        self.main_status_indicator.mousePressEvent = self.on_status_clicked\n        \n        # Create status indicators for each service\n        services = [\n            ('arweave', '#3498db'),\n            ('nano', '#2ecc71'),\n            ('doge', '#f39c12')\n        ]\n        \n        # Add status widgets to layout\n        status_layout.addWidget(self.main_status_indicator)\n        status_layout.addWidget(self.status_text)\n        status_layout.addSpacing(10)\n        \n        # Container for connection indicators that can be toggled\n        self.indicators_container = QWidget()\n        indicators_layout = QHBoxLayout(self.indicators_container)\n        indicators_layout.setContentsMargins(0, 0, 0, 0)\n        indicators_layout.setSpacing(10)\n        \n        # Add connection indicators\n        for service, color in services:\n            indicator = self.create_status_indicator(service.capitalize(), color)\n            self.connection_indicators[service] = indicator\n            indicators_layout.addWidget(indicator)\n        \n        # Add indicators container to main layout\n        status_layout.addWidget(self.indicators_container)\n        \n        # Add last updated timestamp\n        status_layout.addStretch()\n        status_layout.addWidget(self.last_updated)\n        \n        # Initially show the indicators\n        self.indicators_visible = True\n        \n        # Activity feed as a bottom overlay (popup style)\n        self.activity_widget = self.create_activity_feed()\n        self.activity_widget.setVisible(False)\n        self.activity_widget.setFixedHeight(220)\n        self.activity_widget.setStyleSheet('''\n            QWidget#activityOverlay {\n                background: rgba(248,249,250,0.97);\n                border-top: 2px solid #4a627a;\n                border-radius: 0 0 12px 12px;\n                box-shadow: 0px -4px 16px rgba(44,62,80,0.11);\n            }\n        ''' + self.activity_widget.styleSheet())\n        self.activity_widget.setObjectName('activityOverlay')\n        self.activity_widget.setParent(self.centralWidget())\n        self.activity_widget.raise_()\n        self._position_activity_overlay()\n\n        # Ensure overlay is repositioned on resize\n        self.centralWidget().installEventFilter(self)\n\n        # Toggle Activity Feed button\n        self.toggle_log_btn = QPushButton(\"‚ñ≤ Activity Log\")\n        self.toggle_log_btn.setFixedHeight(20)\n        self.toggle_log_btn.setStyleSheet(\"\"\"\n            QPushButton {\n                font-size: 11px;\n                padding: 0 8px;\n                border: 1px solid #4a627a;\n                border-radius: 3px;\n                color: #ecf0f1;\n                background: transparent;\n            }\n            QPushButton:hover {\n                background: #3d5366;\n            }\n        \"\"\")\n        self.toggle_log_btn.clicked.connect(self.toggle_activity_log_overlay)\n        status_layout.addWidget(self.toggle_log_btn)\n        \n        # Add status bar to main layout\n        main_layout.addWidget(content_widget, stretch=1)\n        main_layout.addWidget(self.status_bar)\n            \n    def _position_activity_overlay(self):\n        if hasattr(self, 'activity_widget') and self.activity_widget:\n            parent = self.centralWidget()\n            if parent:\n                h = self.activity_widget.height()\n                parent_h = parent.height()\n                parent_w = parent.width()\n                sb_h = self.status_bar.height() if hasattr(self, 'status_bar') else 0\n                self.activity_widget.setFixedWidth(parent_w)\n                self.activity_widget.move(0, parent_h - h - sb_h)\n    \n    def eventFilter(self, obj, event):\n        if obj == self.centralWidget() and event.type() == event.Resize:\n            self._position_activity_overlay()\n        return super().eventFilter(obj, event)\n\n    def toggle_activity_log_overlay(self):\n        if not hasattr(self, 'activity_widget'):\n            return\n        is_visible = self.activity_widget.isVisible()\n        self.activity_widget.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Log\" if is_visible else \"‚ñ≤ Activity Log\")\n        if not is_visible:\n            self._position_activity_overlay()\n        self.adjustSize()\n    \n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n\n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click.\"\"\"\n        # Toggle message log visibility when clicking on any status indicator\n        self.toggle_message_log()\n            \n    def add_message(self, message, level=\"info\", data_quality=\"unknown\"):\n        \"\"\"Add a message to the log with data quality indicator.\n        \n        Args:\n            message (str): The message to add\n            level (str): Message level ('info', 'warning', 'error', 'success')\n            data_quality (str): Data quality status ('verified', 'pending', 'failed', 'unknown')\n        \"\"\"\n        try:\n            # Add timestamp\n            timestamp = datetime.now().strftime(\"%H:%M:%S\")\n            self.message_history.append((timestamp, message, level, data_quality))\n            \n            # Keep only the last max_messages\n            if len(self.message_history) > self.max_messages:\n                self.message_history = self.message_history[-self.max_messages:]\n                \n            # Update the message log if it exists\n            if hasattr(self, 'message_log') and self.message_log is not None:\n                self.update_message_log()\n                \n            # Show error messages in status bar if available\n            if level == \"error\" and hasattr(self, 'status_text') and self.status_text is not None:\n                error_msg = f\"Error: {message[:50]}...\" if len(message) > 50 else f\"Error: {message}\"\n                self.status_text.setText(error_msg)\n                # Clear the error message after 5 seconds\n                QTimer.singleShot(5000, lambda: self.status_text.setText(\"\"))\n                \n            # Print to console for debugging\n            print(f\"[{timestamp}] [{level.upper()}] {message}\")\n            \n            # Ensure the message log is updated in the UI\n            QApplication.processEvents()\n            \n        except Exception as e:\n            print(f\"Error in add_message: {str(e)}\")\n            \n    def update_message_log(self):\n        \"\"\"Update the message log with all messages and data quality indicators.\"\"\"\n        try:\n            if not hasattr(self, 'message_log') or self.message_log is None:\n                return\n                \n            log_text = \"\"\n            for entry in self.message_history:\n                # Handle both old format (3 items) and new format (4 items)\n                if len(entry) == 3:\n                    timestamp, msg, level = entry\n                    data_quality = \"unknown\"\n                else:\n                    timestamp, msg, level, data_quality = entry\n                \n                # Data quality indicator circle\n                if data_quality == \"verified\":\n                    quality_circle = \"<span style='color: #2ecc71;'>‚óè</span>\"  # Green\n                    quality_tooltip = \"Valid Nano & Arweave confirmations\"\n                elif data_quality == \"pending\":\n                    quality_circle = \"<span style='color: #f39c12;'>‚óè</span>\"  # Orange\n                    quality_tooltip = \"Pending or recent bid / not yet verified\"\n                elif data_quality == \"failed\":\n                    quality_circle = \"<span style='color: #e74c3c;'>‚óè</span>\"  # Red\n                    quality_tooltip = \"RSA verification failed / corrupted metadata\"\n                else:\n                    quality_circle = \"<span style='color: #666;'>‚óè</span>\"  # Gray\n                    quality_tooltip = \"Unknown verification status\"\n                \n                # Message color based on level\n                if level == \"error\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#e74c3c'>{timestamp} - {msg}</font><br>\"\n                elif level == \"warning\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#f39c12'>{timestamp} - {msg}</font><br>\"\n                elif level == \"success\":\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> <font color='#2ecc71'>{timestamp} - {msg}</font><br>\"\n                else:\n                    log_text += f\"<span title='{quality_tooltip}'>{quality_circle}</span> {timestamp} - {msg}<br>\"\n            \n            self.message_log.setHtml(log_text)\n            \n        except Exception as e:\n            print(f\"Error in update_message_log: {str(e)}\")\n            \n    def toggle_connection_details(self, event=None):\n        \"\"\"Toggle the visibility of connection details.\"\"\"\n        if not hasattr(self, 'connection_details') or self.connection_details is None:\n            return\n            \n        is_visible = self.connection_details.isVisible()\n        self.connection_details.setVisible(not is_visible)\n        self.update_main_status_indicator()\n\n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            service (str): Service name ('arweave', 'nano', 'doge')\n            is_connected (bool): Whether the service is connected\n            error_msg (str, optional): Error message if connection failed\n            status_detail (str, optional): Detailed status information\n        \"\"\"\n        if service not in self.connection_indicators:\n            return\n\n        widget = self.connection_indicators[service]\n        dot = widget.findChild(QLabel, service + \"_dot\")\n\n        if not dot:\n            return\n\n        # Update tooltip with detailed status information\n        if service == 'arweave':\n            if is_connected:\n                tooltip = \"Arweave: Connected\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n\n        widget.setToolTip(tooltip)\n\n        # Update the main status indicator\n        self.update_main_status_indicator()\n        \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated') and self.last_updated is not None:\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n\n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.update_main_status_indicator()\n                return\n                \n            # Check Arweave connection\n            arweave_connected = self.client.check_arweave_connection()\n            self.update_connection_status('arweave', arweave_connected)\n            \n            # Check Nano connection\n            nano_connected = self.client.check_nano_connection()\n            self.update_connection_status('nano', nano_connected)\n            \n            # Check Dogecoin connection\n            doge_connected = self.client.check_dogecoin_connection()\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update the main status indicator\n            self.update_main_status_indicator()\n            \n            # Update the timestamp\n            self.update_timestamp()\n            \n        except Exception as e:\n            print(f\"Error checking connections: {str(e)}\")\n            self.add_message(f\"Error checking connections: {str(e)}\", \"error\")\n            \n    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n        \"\"\"Update the connection status for a service.\n        \n        Args:\n            return\n            \n        # Check Arweave connection\n        arweave_connected = self.client.check_arweave_connection()\n        self.update_connection_status('arweave', arweave_connected)\n        \n        # Check Nano connection\n        nano_connected = self.client.check_nano_connection()\n        self.update_connection_status('nano', nano_connected)\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Disconnected\"\n                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'nano':\n            if is_connected:\n                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"RPC error\"\n                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n        elif service == 'doge':\n            if is_connected:\n                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n                if not self.mock_mode:  # Only log success messages in real mode\n                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n            else:\n                status = status_detail or \"Locked\"\n                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n                if not self.mock_mode:  # Only log error messages in real mode\n                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n        \n        widget.setToolTip(tooltip)\n        \n        # Update the main status indicator\n        self.update_main_status_indicator()\n    \n    def update_timestamp(self):\n        \"\"\"Update the last updated timestamp.\"\"\"\n        if hasattr(self, 'last_updated'):\n            now = datetime.now().strftime(\"%H:%M:%S\")\n            self.last_updated.setText(f\"Last updated: {now}\")\n    \n    def check_connections(self):\n        \"\"\"Check the current connection status for all services.\"\"\"\n        try:\n            if not self.client:\n                self.connection_status = False\n                self.status_text.setText(\"Client not initialized\")\n                return\n            \n            # In mock mode, connections should always be available\n            if self.mock_mode:\n                arweave_connected = True\n                nano_connected = True\n                doge_connected = True\n                self.connection_status = True\n            else:\n                # Check actual connections using client's connection status\n                conn_status = getattr(self.client, 'connection_status', {})\n                arweave_connected = conn_status.get('arweave', False)\n                nano_connected = conn_status.get('nano', False)\n                doge_connected = conn_status.get('doge', False)\n                self.connection_status = conn_status.get('overall', False)\n            \n            # Update individual connection statuses\n            self.update_connection_status('arweave', arweave_connected)\n            self.update_connection_status('nano', nano_connected)\n            self.update_connection_status('doge', doge_connected)\n            \n            # Update status text based on overall connection state\n            if self.mock_mode:\n                self.status_text.setText(\"Mock mode - All systems operational\")\n            else:\n                all_connected = arweave_connected and nano_connected and doge_connected\n                self.status_text.setText(\"All systems operational\" if all_connected else \"Some services unavailable\")\n            \n            # Update timestamp\n            self.update_timestamp()\n                \n            # Update the main status indicator\n            if hasattr(self, 'main_status_indicator') and self.main_status_indicator is not None:\n                color = '#2ecc71' if self.connection_status else '#e74c3c'\n                self.main_status_indicator.setStyleSheet(f\"font-size: 16px; color: {color};\")\n                \n                # Update the tooltip with connection status\n                status_text = \"All systems operational\" if self.connection_status else \"Connection issues detected\"\n                self.main_status_indicator.setToolTip(f\"Status: {status_text}\\nClick for details\")\n        except Exception as e:\n            self.status_text.setText(f\"Error checking connections\")\n            self.add_message(f\"Connection check error: {str(e)}\", \"error\", \"failed\")\n            print(f\"Error in check_connections: {e}\")\n            self.connection_status = False\n        \n        # Schedule next check (less frequent to reduce noise)\n        QTimer.singleShot(5000, self.check_connections)\n        \n    def on_status_clicked(self, event):\n        \"\"\"Handle status indicator click to toggle connection indicators.\"\"\"\n        if not hasattr(self, 'indicators_visible'):\n            return\n            \n        # Toggle visibility of connection indicators\n        self.indicators_visible = not self.indicators_visible\n        self.indicators_container.setVisible(self.indicators_visible)\n        \n        # Update tooltip to indicate current state\n        state = \"Hide\" if self.indicators_visible else \"Show\"\n        self.main_status_indicator.setToolTip(\n            f\"{state} connection indicators\\n\"\n            \"Click to toggle visibility\"\n        )\n            \n    def create_status_indicator(self, name, color):\n        \"\"\"Create a status indicator widget.\n        \n        Args:\n            name (str): Name of the service (e.g., 'Arweave', 'Nano')\n            color (str): Base color for the indicator\n            \n        Returns:\n            QWidget: Configured status indicator widget\n        \"\"\"\n        widget = QWidget()\n        widget.setObjectName(name.lower() + \"_widget\")\n        layout = QHBoxLayout(widget)\n        layout.setContentsMargins(0, 0, 0, 0)\n        layout.setSpacing(5)\n        \n        # Status dot\n        dot = QLabel(\"‚óè\")\n        dot.setObjectName(name.lower() + \"_dot\")\n        dot.setStyleSheet(f\"font-size: 16px; color: #666;\")\n        \n        # Service name\n        label = QLabel(name)\n        label.setStyleSheet(\"font-size: 11px;\")\n        \n        layout.addWidget(dot)\n        layout.addWidget(label)\n        \n        return widget\n    \n    def update_main_status_indicator(self):\n        \"\"\"Update the main status indicator based on connection states.\"\"\"\n        if not hasattr(self, 'connection_indicators'):\n            return\n            \n        # Count connected services\n        connected = 0\n        total_services = len(self.connection_indicators)\n        \n        for service in self.connection_indicators.values():\n            dot = service.findChild(QLabel, service.objectName().replace('_widget', '_dot'))\n            if dot and \"color: #2ecc71\" in dot.styleSheet():\n                connected += 1\n        \n        # Set color and tooltip based on connection state (as per JSON spec)\n        if connected == total_services:\n            color = \"#2ecc71\"  # Green - All connections healthy\n            status_text = \"All connections healthy\"\n        elif connected > 0:\n            color = \"#f39c12\"  # Orange - Partial connection issues\n            status_text = \"Partial connection issues\"\n        else:\n            color = \"#e74c3c\"  # Red - One or more services offline or malfunctioning\n            status_text = \"One or more services offline or malfunctioning\"\n            \n        # Update main indicator with enhanced tooltip\n        style = f\"QLabel#main_status_indicator {{ font-size: 16px; color: {color}; }}\"\n        self.main_status_indicator.setStyleSheet(style)\n        self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n        \n        # Update tooltip to reflect current status\n        tooltip = f\"Click to expand error diagnostics\\n\\nStatus: {status_text}\\nConnected: {connected}/{total_services} services\"\n        self.main_status_indicator.setToolTip(tooltip)\n    \n    def toggle_message_log(self):\n        \"\"\"Toggle the visibility of the message log.\"\"\"\n        is_visible = self.message_log.isVisible()\n        self.message_log.setVisible(not is_visible)\n        self.toggle_log_btn.setText(\"‚ñº Activity Feed\" if is_visible else \"‚ñ≤ Activity Feed\")\n        \n        # Resize window to fit content\n        self.adjustSize()\n        \n    def create_sidebar(self):\n        \"\"\"Create the sidebar with navigation buttons and user information.\"\"\"\n        self.sidebar = QWidget()\n        self.sidebar.setFixedWidth(200)\n        sidebar_style = (\n            \"QWidget { background-color: #2c3e50; border-right: 1px solid #34495e; }\"\n            \"QPushButton { background-color: transparent; color: #ecf0f1; border: none; padding: 12px 16px; text-align: left; font-size: 14px; font-weight: 500; }\"\n            \"QPushButton:hover { background-color: #34495e; }\"\n            \"QPushButton:checked { background-color: #1abc9c; }\"\n            \"QPushButton:pressed { background-color: #16a085; }\"\n            \"QLabel { color: #ecf0f1; padding: 8px; }\"\n            \"QLabel#user_info { font-size: 12px; padding: 4px 8px; background-color: rgba(0, 0, 0, 0.2); border-radius: 4px; margin: 8px; }\"\n            \"QLabel#user_balance { font-size: 14px; font-weight: bold; color: #1abc9c; }\"\n        )\n        self.sidebar.setStyleSheet(sidebar_style)\n        \n        # Create sidebar layout and store it as instance variable\n        self.sidebar_layout = QVBoxLayout()\n        self.sidebar_layout.setContentsMargins(0, 0, 0, 0)\n        self.sidebar_layout.setSpacing(0)\n        self.sidebar.setLayout(self.sidebar_layout)\n        \n        # Add logo\n        logo_label = QLabel(\"Sapphire Exchange\")\n        logo_label.setAlignment(Qt.AlignCenter)\n        logo_label.setStyleSheet(\n            \"QLabel {\"\n            \"    color: #ecf0f1;\"\n            \"    font-size: 16px;\"\n            \"    font-weight: bold;\"\n            \"    padding: 20px 10px;\"\n            \"    border-bottom: 1px solid #34495e;\"\n            \"}\"\n        )\n        self.sidebar_layout.addWidget(logo_label)\n        \n        # Add navigation buttons\n        self.create_nav_buttons()\n        \n        # Add spacer\n        self.sidebar_layout.addStretch(1)\n        \n        # Add user info (initially hidden)\n        self.user_info_widget = QLabel(\"Not logged in\")\n        self.user_info_widget.setAlignment(Qt.AlignCenter)\n        self.user_info_widget.setStyleSheet(\"QLabel { color: #bdc3c7; font-size: 12px; padding: 10px; border-top: 1px solid #34495e; }\")\n        self.user_info_widget.setVisible(False)\n        self.sidebar_layout.addWidget(self.user_info_widget)\n        \n        # Add logout button (initially hidden)\n        self.logout_btn = QPushButton(\"Logout\")\n        self.logout_btn.setStyleSheet(\"QPushButton { background-color: #e74c3c; color: white; border: none; padding: 10px; margin: 10px; border-radius: 4px; } QPushButton:hover { background-color: #c0392b; }\")\n        self.logout_btn.setVisible(False)\n        self.logout_btn.clicked.connect(self.logout)\n        self.sidebar_layout.addWidget(self.logout_btn)\n        \n        return self.sidebar\n        \n    def create_nav_buttons(self):\n        \"\"\"Create navigation buttons for the sidebar.\"\"\"\n        # Navigation buttons with proper visibility states\n        self.nav_buttons = {\n            \"marketplace_btn\": {\n                \"text\": \"üè†  Marketplace\",\n                \"page_id\": 1,\n                \"visible\": True,  # Always visible\n                \"requires_auth\": False\n            },\n            \"sell_item_btn\": {\n                \"text\": \"üõçÔ∏è  Sell Item\",\n                \"page_id\": 2,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"my_items_btn\": {\n                \"text\": \"üì¶  My Items\",\n                \"page_id\": 3,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            },\n            \"settings_btn\": {\n                \"text\": \"‚öôÔ∏è  Settings\",\n                \"page_id\": 4,\n                \"visible\": False,  # Requires auth\n                \"requires_auth\": True\n            }\n        }\n        \n        # Create navigation buttons\n        self.nav_button_group = QButtonGroup()\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = QPushButton(btn_data[\"text\"])\n            btn.setCheckable(True)\n            btn.setVisible(btn_data[\"visible\"])\n            btn.setProperty(\"requires_auth\", btn_data[\"requires_auth\"])\n            btn.clicked.connect(lambda checked, p=btn_data[\"page_id\"]: self.show_page(p))\n            self.nav_button_group.addButton(btn, btn_data[\"page_id\"])\n            setattr(self, btn_name, btn)  # Store reference to button\n            self.sidebar_layout.addWidget(btn)\n        \n    def create_login_page(self):\n        \"\"\"Create a simplified login/signup page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setAlignment(Qt.AlignCenter)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        # Logo/Title\n        title = QLabel(\"Sapphire Exchange\")\n        title.setFont(QFont('Arial', 24, QFont.Bold))\n        title.setAlignment(Qt.AlignCenter)\n        layout.addWidget(title)\n        \n        layout.addSpacing(30) \n        card = QWidget()\n        card.setFixedWidth(350)  # Reduced from 400px\n        card.setStyleSheet(\"QWidget { background: white; border-radius: 12px; padding: 25px; border: 1px solid #e0e0e0; }\")\n        \n        form_layout = QVBoxLayout(card)\n        form_layout.setSpacing(20)\n        \n        # Form title\n        form_title = QLabel(\"Welcome Back\")\n        form_title.setFont(QFont('Arial', 16, QFont.Bold))\n        form_title.setAlignment(Qt.AlignCenter)\n        \n        # Seed phrase input\n        seed_label = QLabel(\"Your Seed Phrase:\")\n        self.seed_input = QTextEdit()\n        self.seed_input.setPlaceholderText(\"seed should be 15 to 25 character long\")\n        self.seed_input.setMaximumHeight(80)  # Increased from 60 to 80\n        self.seed_input.setStyleSheet(\"QTextEdit { border: 1px solid #e0e0e0; border-radius: 4px; padding: 8px; font-size: 14px; min-height: 60px; max-height: 80px; } QTextEdit:focus { border: 1px solid #4a6ee0; }\")\n        \n        # New account link\n        new_account_link = QLabel(\n            \"<a href='#' style='color: #2b7bba; text-decoration: none;'>Create a new account</a>\"\n        )\n        new_account_link.setAlignment(Qt.AlignCenter)\n        new_account_link.linkActivated.connect(self.handle_new_account)\n        \n        # Login button\n        self.login_btn = QPushButton(\"Continue\")\n        self.login_btn.setStyleSheet(\"QPushButton { background: #2b7bba; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; font-size: 15px; } QPushButton:hover { background: #1a5a8f; } QPushButton:disabled { background: #cccccc; }\")\n        self.login_btn.clicked.connect(self.handle_login)\n        \n        # Add widgets to form\n        form_layout.addWidget(form_title)\n        form_layout.addWidget(seed_label)\n        form_layout.addWidget(self.seed_input)\n        form_layout.addWidget(new_account_link)\n        form_layout.addWidget(self.login_btn)\n        \n        # Add card to main layout\n        layout.addStretch()\n        layout.addWidget(title)\n        layout.addWidget(card, 0, Qt.AlignCenter)\n        layout.addStretch()\n        \n        # Initialize state\n        self.is_new_user = False\n        \n        return page\n        \n    def handle_new_account(self):\n        \"\"\"Handle new account creation.\"\"\"\n        try:\n            # Generate a nano-compliant BIP-39 seed phrase\n            import secrets\n            wordlist = [\n                'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract', 'absurd', 'abuse',\n                'access', 'accident', 'account', 'accuse', 'achieve', 'acid', 'acoustic', 'across', 'act', 'action',\n                'actor', 'actress', 'actual', 'adapt', 'add', 'addict', 'address', 'adjust', 'admit', 'adult',\n                'advance', 'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'age', 'agent', 'agree',\n                'ahead', 'aim', 'air', 'airport', 'aisle', 'alarm', 'album', 'alcohol', 'alert', 'alien'\n            ]\n            seed_phrase = ' '.join(secrets.choice(wordlist) for _ in range(12))\n            \n            # Create a custom dialog for the seed phrase\n            dialog = QDialog(self)\n            dialog.setWindowTitle(\"Your Recovery Phrase\")\n            dialog.setMinimumWidth(500)\n            dialog.setStyleSheet(\"QDialog { background-color: #f5f5f5; font-family: Arial, sans-serif; } QLabel { color: #333333; font-size: 14px; margin: 5px 0; } QPushButton { background: #2b7bba; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; } QTextEdit { border: 1px solid #cccccc; border-radius: 4px; padding: 10px; background: white; font-family: monospace; font-size: 16px; margin: 10px 0; }\")\n            \n            layout = QVBoxLayout(dialog)\n            \n            # Title\n            title = QLabel(\"Your Wallet Recovery Phrase\")\n            title.setStyleSheet(\"font-size: 18px; font-weight: bold; color: #2b7bba; margin-bottom: 15px;\")\n            \n            # Warning text\n            warning = QLabel(\n                \"Write down these words in the correct order and keep them in a secure location. \"\n                \"You will need this phrase to recover your wallet.\"\n            )\n            warning.setWordWrap(True)\n            warning.setStyleSheet(\"color: #d35400; background: #fdebd0; padding: 10px; border-radius: 4px;\")\n            \n            # Seed phrase display\n            seed_display = QTextEdit()\n            seed_display.setPlainText(seed_phrase)\n            seed_display.setReadOnly(True)\n            seed_display.setMinimumWidth(400)\n            seed_display.setMinimumHeight(100)\n            \n            # Add copy to clipboard button\n            copy_btn = QPushButton(\"Copy to Clipboard\")\n            copy_btn.clicked.connect(lambda: QApplication.clipboard().setText(seed_phrase))\n            \n            # Confirm button\n            confirm_btn = QPushButton(\"I have saved this seed\")\n            confirm_btn.setStyleSheet(\"background: #27ae60;\")\n            \n            # Add widgets to layout\n            layout.addWidget(title)\n            layout.addWidget(warning)\n            layout.addWidget(QLabel(\"\\nYour recovery phrase:\"))\n            layout.addWidget(seed_display)\n            \n            # Button layout\n            btn_layout = QHBoxLayout()\n            btn_layout.addWidget(copy_btn)\n            btn_layout.addWidget(confirm_btn)\n            \n            layout.addLayout(btn_layout)\n            \n            # Show the dialog\n            dialog.exec_()\n            \n            # Store the seed phrase in a class variable for later use\n            self._pending_seed = seed_phrase\n            \n            # Set the seed phrase directly in the input field\n            success = self._set_seed_phrase(seed_phrase)\n            \n            # If direct setting failed, try again with a small delay\n            if not success:\n                QTimer.singleShot(100, lambda: self._set_seed_phrase(seed_phrase))\n            \n            # Enable login and set flags\n            self.login_btn.setEnabled(True)\n            self.is_new_user = True\n            \n            # Set focus to the login button for better UX\n            self.login_btn.setFocus()\n            \n            # Debug output\n            print(f\"DEBUG: Seed phrase generated: {seed_phrase}\")\n            print(f\"DEBUG: Input field content after setting: '{self.seed_input.toPlainText()}'\")\n            print(f\"DEBUG: Input field has focus: {self.seed_input.hasFocus()}\")\n            \n            # Force a complete UI update\n            QApplication.processEvents()\n            \n            return True\n            \n        except Exception as e:\n            QMessageBox.critical(self, \"Error\", f\"Failed to create account: {str(e)}\")\n            return False\n    \n    def _set_seed_phrase(self, seed_phrase):\n        \"\"\"Set the seed phrase in the input field. Returns True if successful.\"\"\"\n        try:\n            if hasattr(self, 'seed_input') and self.seed_input is not None:\n                self.seed_input.setPlainText(seed_phrase)\n                self.seed_input.setFocus()\n                return True\n            return False\n        except Exception as e:\n            print(f\"Error setting seed phrase: {e}\")\n            return False\n    \n    def handle_login(self):\n        \"\"\"Handle the login process with the provided seed phrase.\"\"\"\n        try:\n            # Get and validate seed phrase\n            seed_phrase = self.seed_input.toPlainText().strip()\n            \n            if not seed_phrase:\n                QMessageBox.warning(self, \"Input Required\", \"Please enter your seed phrase or create a new account.\")\n                return\n                \n            # Validate seed phrase format (basic check)\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Disable login button to prevent multiple clicks\n            self.login_btn.setEnabled(False)\n            self.login_btn.setText(\"Please wait...\")\n            \n            # Clear any previous error messages\n            self.statusBar().clearMessage()\n            \n            # Show status message\n            status_msg = \"Creating your account...\" if self.is_new_user else \"Logging in...\"\n            \n            # Create a worker for the login process\n            worker = AsyncWorker(self.login_async(seed_phrase, None))\n            worker.finished.connect(lambda result: self.on_login_complete(result))\n            worker.error.connect(lambda error: self.on_error(error))\n            worker.start()\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to login: {str(e)}\")\n            print(f\"Login error: {e}\")\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle completion of the login process.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            # Use the sidebar layout that's now properly defined\n            if hasattr(self, 'sidebar_layout') and self.sidebar_layout:\n                for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                    item = self.sidebar_layout.itemAt(i)\n                    if item and item.widget():\n                        btn = item.widget()\n                        if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                            btn.setVisible(True)\n            \n            # Make logout button visible\n            if hasattr(self, 'logout_btn'):\n                self.logout_btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    def create_marketplace_page(self):\n        \"\"\"Create the marketplace page.\"\"\"\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        # Items grid\n        self.items_grid = QListWidget()\n        self.items_grid.setViewMode(QListWidget.IconMode)\n        self.items_grid.setIconSize(QSize(200, 200))\n        self.items_grid.setResizeMode(QListWidget.Adjust)\n        self.items_grid.setSpacing(20)\n        \n        # Add items grid to layout\n        layout.addWidget(self.items_grid)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        print(\"  Marketplace page created\")\n        return page\n    \n    def create_item_creation_page(self):\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        layout.setContentsMargins(20, 20, 20, 20)\n        \n        title = QLabel(\"Create New Item\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Form layout\n        form_layout = QFormLayout()\n        form_layout.setSpacing(15)\n        \n        # Item name\n        self.item_name = QLineEdit()\n        self.item_name.setPlaceholderText(\"Item Name\")\n        form_layout.addRow(\"Item Name:\", self.item_name)\n        \n        # Item description\n        self.item_description = QTextEdit()\n        self.item_description.setPlaceholderText(\"Item Description\")\n        self.item_description.setMaximumHeight(100)\n        form_layout.addRow(\"Description:\", self.item_description)\n        \n        # Starting price\n        self.starting_price = QLineEdit()\n        self.starting_price.setPlaceholderText(\"Starting Price (NANO)\")\n        form_layout.addRow(\"Starting Price (NANO):\", self.starting_price)\n        \n        # Duration (in hours)\n        self.duration = QLineEdit(\"24\")\n        self.duration.setPlaceholderText(\"Auction Duration (hours)\")\n        form_layout.addRow(\"Auction Duration (hours):\", self.duration)\n        \n        # Image upload\n        self.image_path = QLineEdit()\n        self.image_path.setPlaceholderText(\"Image Path\")\n        self.image_path.setReadOnly(True)\n        \n        browse_btn = QPushButton(\"Browse...\")\n        browse_btn.clicked.connect(self.browse_image)\n        \n        image_layout = QHBoxLayout()\n        image_layout.addWidget(self.image_path)\n        image_layout.addWidget(browse_btn)\n        form_layout.addRow(\"Image:\", image_layout)\n        \n        # Add form to layout\n        layout.addWidget(title)\n        layout.addLayout(form_layout)\n        \n        # Create button\n        create_btn = QPushButton(\"Create Item\")\n        create_btn.clicked.connect(self.create_item)\n        layout.addWidget(create_btn, alignment=Qt.AlignRight)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        return page\n    \n    def create_my_items_page(self):\n        \"\"\"Create the 'My Items' page.\"\"\"\n        print(\"Creating My Items page...\")\n        page = QWidget()\n        layout = QVBoxLayout(page)\n        \n        # Add to stacked widget\n        self.stacked_widget.addWidget(page)\n        \n        title = QLabel(\"My Items\")\n        title.setFont(QFont('Arial', 16, QFont.Bold))\n        \n        # Items list\n        print(\"  Creating my_items_list...\")\n        self.my_items_list = QListWidget()\n        self.my_items_list.setViewMode(QListWidget.IconMode)\n        self.my_items_list.setIconSize(QSize(150, 150))\n        self.my_items_list.setResizeMode(QListWidget.Adjust)\n        \n        # Add widgets to layout\n        layout.addWidget(title)\n        layout.addWidget(self.my_items_list)\n        \n        print(\"  My Items page created\")\n        return page\n    \n    def browse_image(self):\n        file_name, _ = QFileDialog.getOpenFileName(\n            self, \"Select Image\", \"\", \"Image Files (*.png *.jpg *.jpeg *.bmp)\")\n        if file_name:\n            self.image_path.setText(file_name)\n    \n    def load_my_items(self):\n        # Load the current user's items.\n        if not hasattr(self, 'my_items_list'):\n            return\n            \n        self.my_items_list.clear()\n        \n        if not self.current_user:\n            self.my_items_list.addItem(\"Please log in to view your items\")\n            return\n            \n        # Show loading indicator\n        self.my_items_list.addItem(\"Loading your items...\")\n        \n        # For now, just clear the loading message\n        # In a real implementation, this would load actual items\n        QTimer.singleShot(1000, lambda: self.my_items_list.clear())\n    \n    def show_page(self, page_index):\n        \"\"\"Show the page at the given index and load appropriate content.\"\"\"\n        if 0 <= page_index < self.stacked_widget.count():\n            self.stacked_widget.setCurrentIndex(page_index)\n            \n            # Load content for the specific page\n            if page_index == 1:  # Marketplace\n                self.load_marketplace_items()\n            elif page_index == 3:  # My Items\n                if hasattr(self, 'my_items_list'):\n                    self.load_my_items()\n                    \n        # Update button states based on login status\n        user_logged_in = hasattr(self, 'current_user') and self.current_user is not None\n        \n        # Update sidebar buttons based on login status\n        sidebar_layout = self.sidebar.layout()\n        if sidebar_layout:\n            for i in range(1, sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(user_logged_in)\n        \n        # Update user info and logout button visibility\n        if hasattr(self, 'user_info_widget'):\n            self.user_info_widget.setVisible(user_logged_in)\n            \n        if hasattr(self, 'logout_btn'):\n            self.logout_btn.setVisible(user_logged_in)\n\n        # Update navigation buttons for guest users\n        for btn_name, btn_data in self.nav_buttons.items():\n            btn = getattr(self, btn_name)\n            btn.setVisible(not btn.property(\"requires_auth\"))  # Only show non-auth buttons\n    \n    def logout(self):\n        \"\"\"Handle user logout.\"\"\"\n        self.current_user = None\n        self.client = None\n        \n        # Hide user info\n        if hasattr(self, 'user_info'):\n            self.user_info.setVisible(False)\n        \n        # Reset navigation buttons - only show Marketplace\n        if hasattr(self, 'nav_buttons'):\n            for btn_name, (_, _, _) in self.nav_buttons.items():\n                if hasattr(self, btn_name):\n                    getattr(self, btn_name).setVisible(False)  # Hide all buttons first\n            # Show only marketplace button\n            if hasattr(self, 'marketplace_btn'):\n                self.marketplace_btn.setVisible(True)\n        \n        # Hide other UI elements\n        for btn_name in ['create_item_btn', 'my_items_btn', 'logout_btn']:\n            if hasattr(self, btn_name):\n                getattr(self, btn_name).setVisible(False)\n        \n        # Clear any sensitive data\n        if hasattr(self, 'seed_input'):\n            self.seed_input.clear()\n        \n        # Show login page and add logout message\n        self.show_page(0)  # Assuming page 0 is the login page\n        self.add_message(\"Successfully logged out\", \"info\", \"verified\")\n\n    def create_item(self):\n        # Get form data\n        name = self.item_name.text().strip()\n        description = self.item_description.toPlainText().strip()\n        price_text = self.starting_price.text().strip()\n        duration_text = self.duration.text().strip()\n        \n        # Validate inputs\n        if not name:\n            QMessageBox.warning(self, \"Error\", \"Item name is required\")\n            return\n            \n        try:\n            price = float(price_text)\n            if price <= 0:\n                raise ValueError(\"Price must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid price\")\n            return\n            \n        try:\n            duration = float(duration_text)\n            if duration <= 0:\n                raise ValueError(\"Duration must be positive\")\n        except ValueError:\n            QMessageBox.warning(self, \"Error\", \"Invalid duration\")\n            return\n        \n        # Create a simple loading overlay\n        loading_widget = QWidget(self)\n        loading_widget.setGeometry(self.rect())\n        loading_widget.setStyleSheet(\"background-color: rgba(0, 0, 0, 128);\")\n        \n        loading_layout = QVBoxLayout(loading_widget)\n        loading_label = QLabel(\"Creating your item...\")\n        loading_label.setStyleSheet(\"color: white; font-size: 16px;\")\n        loading_label.setAlignment(Qt.AlignCenter)\n        \n        loading_layout.addWidget(loading_label, 0, Qt.AlignCenter)\n        loading_widget.show()\n        \n        # Make sure the loading widget is on top\n        loading_widget.raise_()\n        \n        def on_item_created(result):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            \n            if result:\n                item, tx_id = result\n                QMessageBox.information(\n                    self,\n                    \"Item Created\",\n                    f\"Item created successfully!\\n\\n\"\n                    f\"Transaction ID: {tx_id}\\n\"\n                    f\"Nano Address: {item.metadata.get('nano_address', 'N/A')}\"\n                )\n                # Clear form\n                self.item_name.clear()\n                self.item_description.clear()\n                self.starting_price.clear()\n                self.duration.setText(\"24\")\n                self.image_path.clear()\n                \n                # Switch to marketplace\n                self.show_page(1)\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to create item\")\n        \n        def on_error(error_msg):\n            loading_widget.deleteLater()  # Clean up the loading widget\n            QMessageBox.critical(self, \"Error\", f\"Failed to create item: {error_msg}\")\n        \n        # Start item creation in a worker thread\n        self.worker = AsyncWorker(\n            self.create_item_async(\n                name=name,\n                description=description,\n                starting_price=price,\n                duration_hours=duration,\n                image_path=self.image_path.text()\n            )\n        )\n        self.worker.finished.connect(on_item_created)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def login_async(self, seed_phrase, user_data=None):\n        \"\"\"\n        Handle the login or account creation process asynchronously.\n        \n        Args:\n            seed_phrase: The seed phrase for login\n            user_data: Not used in simplified flow (kept for compatibility)\n        \n        Returns:\n            User: The authenticated user object\n        \n        Raises:\n            ValueError: If login or account creation fails\n        \"\"\"\n        try:\n            import random\n            import asyncio\n            import time\n            from models import User\n            from decentralized_client import EnhancedDecentralizedClient\n            from nano_utils_fixed import NanoWallet\n            \n            # Simulate network delay (0.5-1.5 seconds)\n            await asyncio.sleep(0.5 + random.random())\n            \n            # Validate seed phrase format\n            if not seed_phrase or not seed_phrase.strip():\n                raise ValueError(\"Seed phrase cannot be empty\")\n                \n            words = seed_phrase.strip().split()\n            if len(words) not in [12, 15, 18, 21, 24]:\n                raise ValueError(f\"Invalid seed phrase length: {len(words)} words. Must be 12, 15, 18, 21, or 24 words.\")\n            \n            # Initialize client if needed\n            if not hasattr(self, 'client') or self.client is None:\n                self.client = EnhancedDecentralizedClient(mock_mode=self.mock_mode)\n            \n            # Connect to the network services\n            connection_status = await self.client.connect()\n            \n            # Check connection status\n            if not connection_status or not self.client.is_connected:\n                error_msg = \"Failed to connect to the network. \"\n                if 'arweave' in connection_status and not connection_status['arweave']:\n                    error_msg += \"Arweave connection failed. \"\n                if 'nano' in connection_status and not connection_status['nano']:\n                    error_msg += \"Nano connection failed. \"\n                if 'doge' in connection_status and not connection_status['doge']:\n                    error_msg += \"Dogecoin connection failed. \"\n                raise ValueError(error_msg.strip())\n            \n            # For new users (coming from handle_new_account)\n            if getattr(self, 'is_new_user', False):\n                print(\"Creating new account with provided seed phrase...\")\n                try:\n                    # Generate a default username\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    \n                    # Initialize user with the provided seed phrase\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n                    \n                    if not user or not hasattr(self.client, 'user_wallet') or not self.client.user_wallet:\n                        raise ValueError(\"Failed to initialize user wallet\")\n                        \n                    print(f\"Created new wallet with address: {self.client.user_wallet.address}\")\n                    return user\n                    \n                except Exception as e:\n                    error_msg = f\"Error creating account: {str(e)}\"\n                    print(error_msg)\n                    raise ValueError(error_msg) from e\n\n            # For existing users\n            print(\"Logging in with existing seed phrase...\")\n            try:\n                # First, try to create a wallet from the seed phrase\n                self.client.user_wallet = await asyncio.get_event_loop().run_in_executor(\n                    None,\n                    lambda: NanoWallet.from_seed(seed_phrase, mock_mode=True)\n                )\n\n                if not self.client.user_wallet or not hasattr(self.client.user_wallet, 'public_key'):\n                    raise ValueError(\"Invalid seed phrase: Could not derive wallet\")\n                \n                # Convert public key to hex for lookup\n                public_key_hex = self.client.user_wallet.public_key.to_ascii(encoding='hex').decode('utf-8')\n                \n                # Try to load user data\n                user = await self.client._load_user_data()\n                \n                if not user:\n                    # If no user data found, check if this is a valid Nano wallet\n                    if not hasattr(self.client.user_wallet, 'address'):\n                        raise ValueError(\"Invalid seed phrase: Not a valid wallet\")\n                        \n                    # For mock mode, we'll create a new user if one doesn't exist\n                    print(\"No existing user found, creating new user...\")\n                    username = f\"user_{int(time.time()) % 10000}\"\n                    user = await self.client.initialize_user(\n                        seed_phrase=seed_phrase,\n                        username=username\n                    )\n            \n                if not user:\n                    raise ValueError(\"Failed to load or create user\")\n                    \n                print(f\"Successfully logged in as {getattr(user, 'username', 'unknown')}\")\n                return user\n                \n            except Exception as e:\n                error_msg = f\"Login failed: {str(e)}\"\n                print(error_msg)\n                raise ValueError(error_msg) from e\n            \n        except Exception as e:\n            error_msg = f\"Login error: {str(e)}\"\n            print(error_msg)\n            raise ValueError(error_msg) from e\n    \n    def on_login_complete(self, user):\n        \"\"\"Handle successful login completion.\"\"\"\n        try:\n            print(\"Login completed successfully\")\n            self.current_user = user\n            \n            # Update UI\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            \n            # Show user info\n            if hasattr(self, 'user_info'):\n                self.user_info.setVisible(True)\n            \n            # Show navigation buttons that require auth\n            for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n                item = self.sidebar_layout.itemAt(i)\n                if item and item.widget():\n                    btn = item.widget()\n                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n                        btn.setVisible(True)\n            \n            # Switch to marketplace\n            self.show_page(1)\n            \n            self.add_message(\"Login successful\", \"success\", \"verified\")\n            \n        except Exception as e:\n            self.login_btn.setEnabled(True)\n            self.login_btn.setText(\"Continue\")\n            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n            print(f\"Login completion error: {e}\")\n    \n    async def load_items_async(self):\n        \"\"\"Load all items from the mock database.\"\"\"\n        from mock_server import arweave_db\n        from datetime import datetime, timezone\n        \n        items = []\n        \n        # Get all items from the mock Arweave database\n        for tx_id, item_data in arweave_db.items.items():\n            # Skip items that don't have the expected structure\n            if not isinstance(item_data, dict):\n                continue\n                \n            # Calculate time left\n            time_left = \"N/A\"\n            if 'auction_end_time' in item_data:\n                try:\n                    end_time = datetime.fromisoformat(item_data['auction_end_time'].replace('Z', '+00:00'))\n                    now = datetime.now(timezone.utc)\n                    \n                    if end_time <= now:\n                        time_left = \"Ended\"\n                    else:\n                        delta = end_time - now\n                        if delta.days > 0:\n                            time_left = f\"{delta.days}d {delta.seconds // 3600}h\"\n                        else:\n                            hours = delta.seconds // 3600\n                            minutes = (delta.seconds % 3600) // 60\n                            time_left = f\"{hours}h {minutes}m\"\n                except (ValueError, TypeError):\n                    pass\n            \n            # Create item dictionary for the UI\n            item = {\n                'id': tx_id,\n                'name': item_data.get('name', 'Unnamed Item'),\n                'description': item_data.get('description', 'No description'),\n                'starting_price': float(item_data.get('starting_price', 0.0)),\n                'current_bid': float(item_data.get('starting_price', 0.0)),  # In a real app, this would track the highest bid\n                'owner': item_data.get('original_owner', 'Unknown'),\n                'auction_end_time': item_data.get('auction_end_time', ''),\n                'nano_address': item_data.get('nano_address', '')\n            }\n            items.append(item)\n        \n        # If no items found in mock database, add some sample items\n        if not items and hasattr(self, 'mock_mode') and self.mock_mode:\n            sample_items = [\n                {\n                    'name': 'Sample Digital Art',\n                    'description': 'A beautiful piece of digital artwork',\n                    'starting_price': 10.5,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=24)).isoformat(),\n                    'original_owner': 'sample_owner_1',\n                    'nano_address': 'nano_sample1234567890'\n                },\n                {\n                    'name': 'Rare Collectible',\n                    'description': 'A limited edition collectible item',\n                    'starting_price': 25.0,\n                    'auction_end_time': (datetime.now(timezone.utc) + timedelta(hours=12)).isoformat(),\n                    'original_owner': 'sample_owner_2',\n                    'nano_address': 'nano_sample0987654321'\n                }\n            ]\n            \n            for item_data in sample_items:\n                tx_id = arweave_db.store_data(item_data)\n                item = {\n                    'id': tx_id,\n                    'name': item_data['name'],\n                    'description': item_data['description'],\n                    'starting_price': float(item_data['starting_price']),\n                    'current_bid': float(item_data['starting_price']),\n                    'owner': item_data['original_owner'],\n                    'auction_end_time': item_data['auction_end_time'],\n                    'nano_address': item_data['nano_address']\n                }\n                items.append(item)\n        \n        return items\n    \n    async def load_user_items_async(self):\n        \"\"\"Load items owned by the current user.\"\"\"\n        if not self.current_user:\n            return []\n            \n        # Get all items and filter by owner\n        all_items = await self.load_items_async()\n        return [item for item in all_items if item.get('owner') == self.current_user.public_key]\n    \n    async def create_item_async(self, name, description, starting_price, duration_hours, image_path=None):\n        try:\n            if not self.client or not self.current_user:\n                raise ValueError(\"Not logged in or client not initialized\")\n                \n            # Create the item using the decentralized client\n            # client.create_item returns a tuple of (item_data, tx_id)\n            item_data, tx_id = await self.client.create_item(\n                name=name,\n                description=description,\n                starting_price=starting_price,\n                duration_hours=duration_hours,\n                image_data=image_path.encode() if image_path else None\n            )\n            \n            # Add to local items list for UI updates\n            if item_data:\n                self.items.append(item_data)\n            \n            # Return both the item data and transaction ID\n            return item_data, tx_id\n            \n        except Exception as e:\n            print(f\"Error creating item: {e}\")\n            raise\n    \n    def on_bid_clicked(self, item_data):\n        # Show custom bid dialog with history\n        dialog = BidDialog(item_data, self)\n        if dialog.exec_() == QDialog.Accepted:\n            self.place_bid(item_data['id'], dialog.bid_amount)\n    \n    def place_bid(self, item_id, amount):\n        # Show loading indicator\n        loading_msg = QMessageBox(self)\n        loading_msg.setWindowTitle(\"Placing Bid\")\n        loading_msg.setText(f\"Placing bid of {amount} DOGE...\")\n        loading_msg.setStandardButtons(QMessageBox.NoButton)\n        loading_msg.show()\n        \n        def on_bid_placed(result):\n            loading_msg.close()\n            if result:\n                self.add_message(\"Bid placed successfully!\", \"success\", \"pending\")\n                QMessageBox.information(\n                    self,\n                    \"Bid Placed\",\n                    f\"Your bid of {amount} DOGE has been placed!\\n\\n\"\n                    f\"Transaction ID: {result}\"\n                )\n                # Refresh marketplace\n                self.load_marketplace_items()\n            else:\n                QMessageBox.critical(self, \"Error\", \"Failed to place bid\")\n        \n        def on_error(error_msg):\n            loading_msg.close()\n            self.add_message(f\"Bid failed: {str(error_msg)}\", \"error\", \"failed\")\n            QMessageBox.critical(self, \"Error\", f\"Failed to place bid: {error_msg}\")\n        \n        # Start bid process in a worker thread\n        self.worker = AsyncWorker(self.place_bid_async(item_id, amount))\n        self.worker.finished.connect(on_bid_placed)\n        self.worker.error.connect(on_error)\n        self.worker.start()\n    \n    async def place_bid_async(self, item_id, amount):\n        # In a real implementation, this would use the EnhancedDecentralizedClient\n        # For now, return a mock transaction ID\n        return f\"mock_bid_tx_{item_id}_{int(amount * 1e6)}\"\n\n    def on_error(self, error):\n        print(f\"Error: {error}\")\n\n    def load_marketplace_items(self):\n        \"\"\"Load marketplace items from the mock server.\"\"\"\n        try:\n            print(\"Loading marketplace items...\")\n            \n            # Show loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.show()\n            \n            # Clear existing items\n            if hasattr(self, 'marketplace_list') and self.marketplace_list:\n                self.marketplace_list.clear()\n            \n            # Get items from mock server\n            items = self.mock_server.get_marketplace_items()\n            \n            if items:\n                for item in items:\n                    # Create item widget\n                    item_widget = self.create_marketplace_item_widget(item)\n                    if item_widget:\n                        list_item = QListWidgetItem()\n                        list_item.setSizeHint(item_widget.sizeHint())\n                        self.marketplace_list.addItem(list_item)\n                        self.marketplace_list.setItemWidget(list_item, item_widget)\n            \n            print(f\"Loaded {len(items)} marketplace items\")\n            \n            # Hide loading overlay\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n                \n        except Exception as e:\n            print(f\"Error loading marketplace items: {e}\")\n            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n                self.loading_overlay.hide()\n            if hasattr(self, 'add_message'):\n                self.add_message(f\"Failed to load marketplace items: {str(e)}\", \"error\", \"‚ö†Ô∏è\")\n\n    def create_marketplace_item_widget(self, item):\n        \"\"\"Create a widget for displaying a marketplace item.\"\"\"\n        try:\n            widget = QWidget()\n            layout = QHBoxLayout()\n            layout.setContentsMargins(10, 10, 10, 10)\n            \n            # Item image\n            image_label = QLabel()\n            image_label.setFixedSize(60, 60)\n            image_label.setStyleSheet(\"QLabel { background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; }\")\n            \n            # Item details\n            details_layout = QVBoxLayout()\n            \n            # Title\n            title_label = QLabel(item.get('title', 'Untitled Item'))\n            title_label.setStyleSheet(\"QLabel { font-weight: bold; font-size: 14px; }\")\n            \n            # Price\n            price_label = QLabel(f\"{item.get('price', 0)} {item.get('currency', 'NANO')}\")\n            price_label.setStyleSheet(\"QLabel { color: #27ae60; font-size: 16px; font-weight: bold; }\")\n            \n            # Description\n            desc_label = QLabel(item.get('description', 'No description available'))\n            desc_label.setStyleSheet(\"QLabel { color: #7f8c8d; font-size: 12px; }\")\n            desc_label.setWordWrap(True)\n            desc_label.setMaximumWidth(300)\n            \n            details_layout.addWidget(title_label)\n            details_layout.addWidget(price_label)\n            details_layout.addWidget(desc_label)\n            \n            layout.addWidget(image_label)\n            layout.addLayout(details_layout)\n            layout.addStretch()\n            \n            widget.setLayout(layout)\n            return widget\n            \n        except Exception as e:\n            print(f\"Error creating marketplace item widget: {e}\")\n            return None\n\n    def toggle_activity_feed(self):\n        \"\"\"Toggle the visibility of the activity feed.\"\"\"\n        if hasattr(self, 'activity_widget'):\n            is_visible = self.activity_widget.isVisible()\n            self.activity_widget.setVisible(not is_visible)\n            \n            # Update toggle button arrow\n            if hasattr(self, 'activity_toggle_btn'):\n                self.activity_toggle_btn.setText(\"‚ñ≤\" if is_visible else \"‚ñº\")\n\n    def closeEvent(self, event):\n        \"\"\"Handle application close event with proper cleanup.\"\"\"\n        try:\n            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n                self.worker.stop()\n            event.accept()\n        except Exception as e:\n            print(f\"Error during shutdown: {e}\")\n            event.accept()\n",
                    "language": "python"
                },
                "codebaseEnabled": true
            },
            "createdAt": 1754366649746,
            "isInternal": false,
            "rawContent": {
                "type": "doc",
                "content": [
                    {
                        "type": "paragraph",
                        "content": [
                            {
                                "type": "text",
                                "text": "many errors on the main_window.py file can you repair."
                            }
                        ]
                    }
                ]
            },
            "autoAppliedRules": [
                {
                    "name": "Repository Information Overview",
                    "description": "Repository Information Overview",
                    "uri": "zen-rules://repo/repo",
                    "content": "\n\n# Sapphire Exchange Information\n\n## Summary\nSapphire Exchange is a decentralized auction platform built on Arweave and Nano blockchains. It enables users to list, bid on, and purchase items with secure blockchain transactions. The application provides decentralized storage on Arweave, fast and feeless Nano transactions, secure wallet management, and a timed auction system.\n\n## Structure\n- **app.py**: Main application entry point\n- **main_window.py**: PyQt5-based UI implementation\n- **models.py**: Data models for users, items, and auctions\n- **database.py**: Database module using Arweave for storage\n- **arweave_utils.py**: Handles interactions with Arweave blockchain\n- **nano_utils.py**: Manages Nano wallet and transaction functionality\n- **decentralized_client.py**: Client for interacting with blockchain networks\n- **mock_servers.py**: Mock implementations for testing without real blockchain\n- **test_marketplace.py**: Test script for verifying marketplace functionality\n\n## Language & Runtime\n**Language**: Python\n**Version**: 3.7+\n**Build System**: pip (Python package manager)\n**Package Manager**: pip\n\n## Dependencies\n**Main Dependencies**:\n- PyArweave==0.6.0: Arweave blockchain integration\n- python-dotenv>=0.19.2: Environment variable management\n- requests>=2.28.0: HTTP requests\n- base58>=2.1.1: Base58 encoding/decoding\n- cryptography>=3.4.7: Cryptographic operations\n- ed25519-blake2b==1.4.1: Digital signatures\n- pynacl>=1.4.0: Cryptographic library\n- pycryptodome>=3.20.0: Cryptographic primitives\n- PyQt5>=5.15.9: GUI framework\n- qrcode>=7.4.2: QR code generation\n- Pillow>=9.5.0: Image processing\n\n**Development Dependencies**:\n- Not explicitly specified in requirements.txt\n\n## Build & Installation\n```bash\n# Create and activate virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install dependencies\npip install -r requirements.txt\n\n# Set up environment variables\n# Create .env file with:\n# ARWEAVE_GATEWAY_URL=https://arweave.net\n# ARWEAVE_WALLET_FILE=wallet.json\n# NANO_NODE_URL=https://mynano.ninja/api\n# NANO_REPRESENTATIVE=nano_3t6k35gi95xu6tergt6p69ck76ogmitsa8mnijtpxm9fkcm736xtoncuohr3\n```\n\n## Usage\n```bash\n# Run the application\npython app.py\n```\n\n## Testing\n**Framework**: Custom testing with mock implementations\n**Test Location**: test_marketplace.py\n**Mock Implementation**: mock_servers.py provides simulated blockchain environments\n**Run Command**:\n```bash\npython test_marketplace.py\n```\n\n## Features\n- **Decentralized Storage**: Item data stored on Arweave blockchain\n- **Nano Integration**: Fast, feeless Nano transactions for bidding and purchasing\n- **Secure Wallet Management**: Built-in wallet generation and management\n- **Auction System**: Support for timed auctions with automatic finalization\n- **Mock Mode**: Testing environment that simulates blockchain operations\n- **PyQt5 GUI**: Desktop application interface for user interaction"
                }
            ]
        },
        {
            "id": "295d4949-c9e9-4cfa-8af2-62c86fd0332f",
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "I'll help you repair the errors in the main_window.py file. First, let me examine the full file to understand what issues need to be fixed."
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01XDXPPKLrAgKs6FNxTHaAXg",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me see the rest of the file to understand all the issues:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_018DC1HYZ4ZYpARsdffH1QrU",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me continue viewing the rest of the file to see all the methods and identify the issues:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01SFNTGHgSni1fL66ireBzUZ",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me continue to see the rest of the file to identify all the issues:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01Qra498Wvak1zbu3JQNDJM4",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Now I can see the issues in the file. Let me check if there are more methods to understand the complete structure:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01YVFCunCxNRXdpJvrGFh9rE",
                    "title": "Fulltext search",
                    "statusText": "Done",
                    "status": "SUCCESS",
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me search specifically for methods in main_window.py to understand the complete structure:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01PL9KP2XxRknDCjtyvmaLAZ",
                    "title": "Fulltext search",
                    "statusText": "Failed",
                    "status": "ERROR",
                    "isHidden": false
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01673GgnDPEPWpNFjqYXDZRv",
                    "title": "Fulltext search",
                    "statusText": "Done",
                    "status": "SUCCESS",
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Now let me check the end of the main_window.py file to see all the methods:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01PBWHSjF81SHbYSaBFg9bFT",
                    "status": "IN_PROGRESS",
                    "isHidden": true,
                    "localResult": "{\"status\":\"SUCCESS\",\"exitCode\":0,\"output\":\"    2068 /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\\r\\n\"}"
                },
                {
                    "type": "shellCommand",
                    "command": "wc -l /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py",
                    "id": "a888bbaa-6b10-419f-9b7a-d90d38ca8db4",
                    "status": "SUCCESS",
                    "toolCallId": "toolu_01PBWHSjF81SHbYSaBFg9bFT",
                    "commandsRequiringConfirmation": [],
                    "exitCode": 0,
                    "output": "    2068 /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\r\n",
                    "outputPath": "/var/folders/b3/__lv2qds3yv2jfb5p1rfwbjc0000gn/T/Zencoder-bbe36bb9-3646-461f-9126-11437974caa55796013136760040968.log",
                    "isBackground": false,
                    "maxWaitTimeInSeconds": 600
                }
            ],
            "context": {
                "author": "Unit Test Agent",
                "operationId": "524ff94a-4f8d-4382-993c-ca12f72bd628"
            },
            "createdAt": 1754366651405,
            "isInternal": false
        },
        {
            "id": "2cc02c07-73a2-431c-a070-3fabd9502605",
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "Let me view the rest of the file to see all the methods and identify the issues:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01Du4uGUhZcEK4qwCJtHVXNH",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me continue viewing the rest of the file:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_0197jimxp1xaTacGiGJwgBg6",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Let me see the rest of the file:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01QWzvAWe9NBLXyPAiMGx7KZ",
                    "statusText": "Viewed file",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "text",
                    "text": "Now I can see the issues in the main_window.py file. Let me identify and fix the major problems:\n\n1. **Duplicate method definitions** - There are multiple definitions of `update_connection_status`, `check_connections`, `on_status_clicked`, `closeEvent`, and `on_login_complete`\n2. **Missing method definitions** - Some methods are referenced but not defined\n3. **Incomplete method implementations** - Some methods have broken or incomplete code\n4. **Import issues** - Some imports may be missing or incorrect\n\nLet me fix these issues:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_011pqqVEhAhjyvXgRpZcKUsF",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "",
                    "refToolCallId": "toolu_011pqqVEhAhjyvXgRpZcKUsF"
                },
                {
                    "type": "text",
                    "text": "Now let me remove the duplicate methods and fix the broken code:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_018UNsdEau8RNqdgANh6MeED",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -780,92 +780,6 @@\n         \"\"\"Check the current connection status for all services.\"\"\"\n         try:\n             if not self.client:\n-                self.update_main_status_indicator()\n-                return\n-                \n-            # Check Arweave connection\n-            arweave_connected = self.client.check_arweave_connection()\n-            self.update_connection_status('arweave', arweave_connected)\n-            \n-            # Check Nano connection\n-            nano_connected = self.client.check_nano_connection()\n-            self.update_connection_status('nano', nano_connected)\n-            \n-            # Check Dogecoin connection\n-            doge_connected = self.client.check_dogecoin_connection()\n-            self.update_connection_status('doge', doge_connected)\n-            \n-            # Update the main status indicator\n-            self.update_main_status_indicator()\n-            \n-            # Update the timestamp\n-            self.update_timestamp()\n-            \n-        except Exception as e:\n-            print(f\"Error checking connections: {str(e)}\")\n-            self.add_message(f\"Error checking connections: {str(e)}\", \"error\")\n-            \n-    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):\n-        \"\"\"Update the connection status for a service.\n-        \n-        Args:\n-            return\n-            \n-        # Check Arweave connection\n-        arweave_connected = self.client.check_arweave_connection()\n-        self.update_connection_status('arweave', arweave_connected)\n-        \n-        # Check Nano connection\n-        nano_connected = self.client.check_nano_connection()\n-        self.update_connection_status('nano', nano_connected)\n-                if not self.mock_mode:  # Only log success messages in real mode\n-                    self.add_message(\"Arweave connected successfully\", \"success\", \"verified\")\n-            else:\n-                status = status_detail or \"Disconnected\"\n-                tooltip = f\"Arweave: {status}\\nIncludes tag validation, data immutability checks\"\n-                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n-                if not self.mock_mode:  # Only log error messages in real mode\n-                    self.add_message(f\"Arweave {status.lower()}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n-        elif service == 'nano':\n-            if is_connected:\n-                tooltip = \"Nano: Connected\\nChecks current balance, transaction confirmation depth\"\n-                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n-                if not self.mock_mode:  # Only log success messages in real mode\n-                    self.add_message(\"Nano RPC connected successfully\", \"success\", \"verified\")\n-            else:\n-                status = status_detail or \"RPC error\"\n-                tooltip = f\"Nano: {status}\\nChecks current balance, transaction confirmation depth\"\n-                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n-                if not self.mock_mode:  # Only log error messages in real mode\n-                    self.add_message(f\"Nano {status}: {error_msg or 'Connection failed'}\", \"error\", \"failed\")\n-        elif service == 'doge':\n-            if is_connected:\n-                tooltip = \"DOGE Wallet: Unlocked\\nWallet usability check and mnemonic verification\"\n-                dot.setStyleSheet(\"font-size: 16px; color: #2ecc71;\")\n-                if not self.mock_mode:  # Only log success messages in real mode\n-                    self.add_message(\"DOGE wallet unlocked successfully\", \"success\", \"verified\")\n-            else:\n-                status = status_detail or \"Locked\"\n-                tooltip = f\"DOGE Wallet: {status}\\nWallet usability check and mnemonic verification\"\n-                dot.setStyleSheet(\"font-size: 16px; color: #e74c3c;\")\n-                if not self.mock_mode:  # Only log error messages in real mode\n-                    self.add_message(f\"DOGE wallet {status.lower()}: {error_msg or 'Wallet locked'}\", \"error\", \"failed\")\n-        \n-        widget.setToolTip(tooltip)\n-        \n-        # Update the main status indicator\n-        self.update_main_status_indicator()\n-    \n-    def update_timestamp(self):\n-        \"\"\"Update the last updated timestamp.\"\"\"\n-        if hasattr(self, 'last_updated'):\n-            now = datetime.now().strftime(\"%H:%M:%S\")\n-            self.last_updated.setText(f\"Last updated: {now}\")\n-    \n-    def check_connections(self):\n-        \"\"\"Check the current connection status for all services.\"\"\"\n-        try:\n-            if not self.client:\n                 self.connection_status = False\n                 self.status_text.setText(\"Client not initialized\")\n                 return",
                    "refToolCallId": "toolu_018UNsdEau8RNqdgANh6MeED"
                },
                {
                    "type": "text",
                    "text": "Now let me remove the duplicate `on_status_clicked` method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_017yavtCmAsbZEyPyAHKz6LK",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -829,22 +829,6 @@\n         \n         # Schedule next check (less frequent to reduce noise)\n         QTimer.singleShot(5000, self.check_connections)\n-        \n-    def on_status_clicked(self, event):\n-        \"\"\"Handle status indicator click to toggle connection indicators.\"\"\"\n-        if not hasattr(self, 'indicators_visible'):\n-            return\n-            \n-        # Toggle visibility of connection indicators\n-        self.indicators_visible = not self.indicators_visible\n-        self.indicators_container.setVisible(self.indicators_visible)\n-        \n-        # Update tooltip to indicate current state\n-        state = \"Hide\" if self.indicators_visible else \"Show\"\n-        self.main_status_indicator.setToolTip(\n-            f\"{state} connection indicators\\n\"\n-            \"Click to toggle visibility\"\n-        )\n             \n     def create_status_indicator(self, name, color):\n         \"\"\"Create a status indicator widget.",
                    "refToolCallId": "toolu_017yavtCmAsbZEyPyAHKz6LK"
                },
                {
                    "type": "text",
                    "text": "Now let me remove the duplicate `on_login_complete` method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01RCF8sXTHhbQByYMQ5Z8d3J",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -1663,38 +1663,7 @@\n             print(error_msg)\n             raise ValueError(error_msg) from e\n     \n-    def on_login_complete(self, user):\n-        \"\"\"Handle successful login completion.\"\"\"\n-        try:\n-            print(\"Login completed successfully\")\n-            self.current_user = user\n-            \n-            # Update UI\n-            self.login_btn.setEnabled(True)\n-            self.login_btn.setText(\"Continue\")\n-            \n-            # Show user info\n-            if hasattr(self, 'user_info'):\n-                self.user_info.setVisible(True)\n-            \n-            # Show navigation buttons that require auth\n-            for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button\n-                item = self.sidebar_layout.itemAt(i)\n-                if item and item.widget():\n-                    btn = item.widget()\n-                    if hasattr(btn, 'requires_auth') and btn.requires_auth:\n-                        btn.setVisible(True)\n-            \n-            # Switch to marketplace\n-            self.show_page(1)\n-            \n-            self.add_message(\"Login successful\", \"success\", \"verified\")\n-            \n-        except Exception as e:\n-            self.login_btn.setEnabled(True)\n-            self.login_btn.setText(\"Continue\")\n-            QMessageBox.critical(self, \"Login Error\", f\"Failed to complete login: {str(e)}\")\n-            print(f\"Login completion error: {e}\")\n+\n     \n     async def load_items_async(self):\n         \"\"\"Load all items from the mock database.\"\"\"",
                    "refToolCallId": "toolu_01RCF8sXTHhbQByYMQ5Z8d3J"
                },
                {
                    "type": "text",
                    "text": "Now let me remove the duplicate `closeEvent` method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_012tnBrhmG4DNsNaBmGpyG6d",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -604,16 +604,6 @@\n             self._position_activity_overlay()\n         self.adjustSize()\n     \n-    def closeEvent(self, event):\n-        \"\"\"Handle application close event with proper cleanup.\"\"\"\n-        try:\n-            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():\n-                self.worker.stop()\n-            event.accept()\n-        except Exception as e:\n-            print(f\"Error during shutdown: {e}\")\n-            event.accept()\n-\n     def on_status_clicked(self, event):\n         \"\"\"Handle status indicator click.\"\"\"\n         # Toggle message log visibility when clicking on any status indicator",
                    "refToolCallId": "toolu_012tnBrhmG4DNsNaBmGpyG6d"
                },
                {
                    "type": "text",
                    "text": "Now let me add the missing `toggle_message_log` method and `create_activity_feed` method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01TDJrxoCvHuf6fqDZA7F1oc",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -608,6 +608,46 @@\n         \"\"\"Handle status indicator click.\"\"\"\n         # Toggle message log visibility when clicking on any status indicator\n         self.toggle_message_log()\n+    \n+    def toggle_message_log(self):\n+        \"\"\"Toggle the visibility of the message log.\"\"\"\n+        if hasattr(self, 'activity_widget'):\n+            is_visible = self.activity_widget.isVisible()\n+            self.activity_widget.setVisible(not is_visible)\n+            if hasattr(self, 'toggle_log_btn'):\n+                self.toggle_log_btn.setText(\"‚ñº Activity Log\" if is_visible else \"‚ñ≤ Activity Log\")\n+            if not is_visible:\n+                self._position_activity_overlay()\n+            self.adjustSize()\n+    \n+    def create_activity_feed(self):\n+        \"\"\"Create the activity feed widget.\"\"\"\n+        widget = QWidget()\n+        widget.setObjectName('activityFeed')\n+        layout = QVBoxLayout(widget)\n+        layout.setContentsMargins(10, 10, 10, 10)\n+        \n+        # Title\n+        title = QLabel(\"Activity Feed\")\n+        title.setStyleSheet(\"font-weight: bold; font-size: 14px; color: #2c3e50; margin-bottom: 10px;\")\n+        layout.addWidget(title)\n+        \n+        # Message log\n+        self.message_log = QTextBrowser()\n+        self.message_log.setMaximumHeight(150)\n+        self.message_log.setStyleSheet(\"\"\"\n+            QTextBrowser {\n+                background-color: #ffffff;\n+                border: 1px solid #ddd;\n+                border-radius: 4px;\n+                padding: 8px;\n+                font-family: 'Courier New', monospace;\n+                font-size: 11px;\n+            }\n+        \"\"\")\n+        layout.addWidget(self.message_log)\n+        \n+        return widget\n             \n     def add_message(self, message, level=\"info\", data_quality=\"unknown\"):\n         \"\"\"Add a message to the log with data quality indicator.",
                    "refToolCallId": "toolu_01TDJrxoCvHuf6fqDZA7F1oc"
                },
                {
                    "type": "text",
                    "text": "Now let me fix the broken `update_main_status_indicator` method call and add the missing method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01XMW9q35WxRYDQwERbMmmM2",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -892,7 +892,7 @@\n     \n     def update_main_status_indicator(self):\n         \"\"\"Update the main status indicator based on connection states.\"\"\"\n-        if not hasattr(self, 'connection_indicators'):\n+        if not hasattr(self, 'connection_indicators') or not hasattr(self, 'main_status_indicator'):\n             return\n             \n         # Count connected services\n@@ -916,22 +916,13 @@\n             status_text = \"One or more services offline or malfunctioning\"\n             \n         # Update main indicator with enhanced tooltip\n-        style = f\"QLabel#main_status_indicator {{ font-size: 16px; color: {color}; }}\"\n+        style = f\"font-size: 16px; color: {color};\"\n         self.main_status_indicator.setStyleSheet(style)\n         self.main_status_indicator.setCursor(Qt.PointingHandCursor)\n         \n         # Update tooltip to reflect current status\n         tooltip = f\"Click to expand error diagnostics\\n\\nStatus: {status_text}\\nConnected: {connected}/{total_services} services\"\n         self.main_status_indicator.setToolTip(tooltip)\n-    \n-    def toggle_message_log(self):\n-        \"\"\"Toggle the visibility of the message log.\"\"\"\n-        is_visible = self.message_log.isVisible()\n-        self.message_log.setVisible(not is_visible)\n-        self.toggle_log_btn.setText(\"‚ñº Activity Feed\" if is_visible else \"‚ñ≤ Activity Feed\")\n-        \n-        # Resize window to fit content\n-        self.adjustSize()\n         \n     def create_sidebar(self):\n         \"\"\"Create the sidebar with navigation buttons and user information.\"\"\"",
                    "refToolCallId": "toolu_01XMW9q35WxRYDQwERbMmmM2"
                },
                {
                    "type": "text",
                    "text": "Now let me fix the broken navigation button logic in the `show_page` method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_012QgukeFhFxyBLpprat3nWZ",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -1441,9 +1441,12 @@\n             self.logout_btn.setVisible(user_logged_in)\n \n         # Update navigation buttons for guest users\n-        for btn_name, btn_data in self.nav_buttons.items():\n-            btn = getattr(self, btn_name)\n-            btn.setVisible(not btn.property(\"requires_auth\"))  # Only show non-auth buttons\n+        if hasattr(self, 'nav_buttons'):\n+            for btn_name, btn_data in self.nav_buttons.items():\n+                if hasattr(self, btn_name):\n+                    btn = getattr(self, btn_name)\n+                    requires_auth = btn_data.get(\"requires_auth\", False)\n+                    btn.setVisible(user_logged_in or not requires_auth)\n     \n     def logout(self):\n         \"\"\"Handle user logout.\"\"\"",
                    "refToolCallId": "toolu_012QgukeFhFxyBLpprat3nWZ"
                },
                {
                    "type": "text",
                    "text": "Now let me fix the broken logout method:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_017mjfMrmmTAS8f3JdSiRNiT",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -1454,22 +1454,20 @@\n         self.client = None\n         \n         # Hide user info\n-        if hasattr(self, 'user_info'):\n-            self.user_info.setVisible(False)\n+        if hasattr(self, 'user_info_widget'):\n+            self.user_info_widget.setVisible(False)\n         \n         # Reset navigation buttons - only show Marketplace\n         if hasattr(self, 'nav_buttons'):\n-            for btn_name, (_, _, _) in self.nav_buttons.items():\n+            for btn_name, btn_data in self.nav_buttons.items():\n                 if hasattr(self, btn_name):\n-                    getattr(self, btn_name).setVisible(False)  # Hide all buttons first\n-            # Show only marketplace button\n-            if hasattr(self, 'marketplace_btn'):\n-                self.marketplace_btn.setVisible(True)\n-        \n-        # Hide other UI elements\n-        for btn_name in ['create_item_btn', 'my_items_btn', 'logout_btn']:\n-            if hasattr(self, btn_name):\n-                getattr(self, btn_name).setVisible(False)\n+                    btn = getattr(self, btn_name)\n+                    requires_auth = btn_data.get(\"requires_auth\", False)\n+                    btn.setVisible(not requires_auth)  # Only show non-auth buttons\n+        \n+        # Hide logout button\n+        if hasattr(self, 'logout_btn'):\n+            self.logout_btn.setVisible(False)\n         \n         # Clear any sensitive data\n         if hasattr(self, 'seed_input'):",
                    "refToolCallId": "toolu_017mjfMrmmTAS8f3JdSiRNiT"
                },
                {
                    "type": "text",
                    "text": "Now let me fix the import issue with `nano_utils_fixed`:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01JMUsjw8XyGJuLcoUMwtekr",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -1583,7 +1583,7 @@\n             import time\n             from models import User\n             from decentralized_client import EnhancedDecentralizedClient\n-            from nano_utils_fixed import NanoWallet\n+            from nano_utils import NanoWallet\n             \n             # Simulate network delay (0.5-1.5 seconds)\n             await asyncio.sleep(0.5 + random.random())",
                    "refToolCallId": "toolu_01JMUsjw8XyGJuLcoUMwtekr"
                },
                {
                    "type": "text",
                    "text": "Now let me add the missing `load_marketplace_items` method that's referenced but not properly defined:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01EckiSBHjheFRiivdgknzwz",
                    "statusText": "Change generated",
                    "status": "SUCCESS",
                    "context": {
                        "files": [
                            {
                                "path": "main_window.py",
                                "fsPath": "/Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py"
                            }
                        ]
                    },
                    "isHidden": false
                },
                {
                    "type": "codeHunk",
                    "lineBasedDiff": "--- /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n+++ /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange/main_window.py\n@@ -1858,39 +1858,42 @@\n         try:\n             print(\"Loading marketplace items...\")\n             \n-            # Show loading overlay\n-            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n-                self.loading_overlay.show()\n-            \n             # Clear existing items\n-            if hasattr(self, 'marketplace_list') and self.marketplace_list:\n-                self.marketplace_list.clear()\n+            if hasattr(self, 'items_grid') and self.items_grid:\n+                self.items_grid.clear()\n             \n             # Get items from mock server\n-            items = self.mock_server.get_marketplace_items()\n+            if hasattr(self, 'mock_server'):\n+                items = self.mock_server.get_marketplace_items()\n+            else:\n+                items = []\n             \n             if items:\n                 for item in items:\n                     # Create item widget\n-                    item_widget = self.create_marketplace_item_widget(item)\n-                    if item_widget:\n-                        list_item = QListWidgetItem()\n-                        list_item.setSizeHint(item_widget.sizeHint())\n-                        self.marketplace_list.addItem(list_item)\n-                        self.marketplace_list.setItemWidget(list_item, item_widget)\n+                    item_widget = ItemWidget(item, self)\n+                    item_widget.bid_clicked.connect(self.on_bid_clicked)\n+                    \n+                    list_item = QListWidgetItem()\n+                    list_item.setSizeHint(item_widget.sizeHint())\n+                    self.items_grid.addItem(list_item)\n+                    self.items_grid.setItemWidget(list_item, item_widget)\n+            else:\n+                # Add placeholder if no items\n+                placeholder = QLabel(\"No items available in the marketplace\")\n+                placeholder.setAlignment(Qt.AlignCenter)\n+                placeholder.setStyleSheet(\"color: #7f8c8d; font-size: 14px; padding: 20px;\")\n+                list_item = QListWidgetItem()\n+                list_item.setSizeHint(placeholder.sizeHint())\n+                self.items_grid.addItem(list_item)\n+                self.items_grid.setItemWidget(list_item, placeholder)\n             \n             print(f\"Loaded {len(items)} marketplace items\")\n-            \n-            # Hide loading overlay\n-            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n-                self.loading_overlay.hide()\n                 \n         except Exception as e:\n             print(f\"Error loading marketplace items: {e}\")\n-            if hasattr(self, 'loading_overlay') and self.loading_overlay:\n-                self.loading_overlay.hide()\n             if hasattr(self, 'add_message'):\n-                self.add_message(f\"Failed to load marketplace items: {str(e)}\", \"error\", \"‚ö†Ô∏è\")\n+                self.add_message(f\"Failed to load marketplace items: {str(e)}\", \"error\", \"failed\")\n \n     def create_marketplace_item_widget(self, item):\n         \"\"\"Create a widget for displaying a marketplace item.\"\"\"",
                    "refToolCallId": "toolu_01EckiSBHjheFRiivdgknzwz"
                },
                {
                    "type": "text",
                    "text": "Now let me check if there are any missing imports or other issues by running a syntax check:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_016ySxvd3Rvz1EG3VEBEaufk",
                    "status": "IN_PROGRESS",
                    "isHidden": true,
                    "localResult": "{\"status\":\"ERROR\",\"exitCode\":127,\"output\":\"/private/var/folders/b3/__lv2qds3yv2jfb5p1rfwbjc0000gn/T/Zencoder-52106a5f-56ac-4fa6-a23f-c97bfb97daa2.sh:1: command not found: python\\r\\n\"}"
                },
                {
                    "type": "shellCommand",
                    "command": "cd /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange && python -m py_compile main_window.py",
                    "id": "6df65212-3c97-4ddc-a8ab-af208a606279",
                    "status": "ERROR",
                    "toolCallId": "toolu_016ySxvd3Rvz1EG3VEBEaufk",
                    "commandsRequiringConfirmation": [
                        {
                            "name": "python",
                            "arguments": [
                                "-m",
                                "py_compile",
                                "main_window.py"
                            ]
                        }
                    ],
                    "exitCode": 127,
                    "output": "/private/var/folders/b3/__lv2qds3yv2jfb5p1rfwbjc0000gn/T/Zencoder-52106a5f-56ac-4fa6-a23f-c97bfb97daa2.sh:1: command not found: python\r\n",
                    "outputPath": "/var/folders/b3/__lv2qds3yv2jfb5p1rfwbjc0000gn/T/Zencoder-52106a5f-56ac-4fa6-a23f-c97bfb97daa29711359752940236701.log",
                    "isBackground": false,
                    "maxWaitTimeInSeconds": 600
                }
            ],
            "context": {
                "author": "Unit Test Agent",
                "operationId": "f446922c-fd1a-47fc-a3e6-da06a461f589"
            },
            "createdAt": 1754366691701,
            "isInternal": false
        },
        {
            "id": "8a0131d0-2f8d-41e3-bf9a-1d510c95d9c8",
            "role": "assistant",
            "content": [
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01CBRVfW67zph6oXpjRs8Fec",
                    "status": "IN_PROGRESS",
                    "isHidden": true,
                    "localResult": "{\"status\":\"SUCCESS\",\"exitCode\":0,\"output\":\"\"}"
                },
                {
                    "type": "shellCommand",
                    "command": "cd /Users/seanmorrissey/Desktop/Coding/Sapphire_Exchange && python3 -m py_compile main_window.py",
                    "id": "ea487fb0-1627-4506-9a2d-bc094242d255",
                    "status": "SUCCESS",
                    "toolCallId": "toolu_01CBRVfW67zph6oXpjRs8Fec",
                    "commandsRequiringConfirmation": [
                        {
                            "name": "python3",
                            "arguments": [
                                "-m",
                                "py_compile",
                                "main_window.py"
                            ]
                        }
                    ],
                    "exitCode": 0,
                    "output": "",
                    "outputPath": "/var/folders/b3/__lv2qds3yv2jfb5p1rfwbjc0000gn/T/Zencoder-2bde4ed3-8beb-44ae-bde9-b1ca9020651d9488535888281978834.log",
                    "isBackground": false,
                    "maxWaitTimeInSeconds": 600
                }
            ],
            "context": {
                "author": "Unit Test Agent",
                "operationId": "877ac190-0630-4f5b-84d8-9677a58fe017"
            },
            "createdAt": 1754366853090,
            "isInternal": false
        },
        {
            "id": "dcbe6ea5-65bd-43e1-8cbf-87d24e19e997",
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "Great! The syntax is now correct. Now let me create a simple test file to verify the `on_status_clicked` method works properly:"
                },
                {
                    "type": "toolCall",
                    "toolCallId": "toolu_01G1jzBsgf74Vb3c4e7b9kGV",
                    "statusText": "Analyzing file",
                    "status": "IN_PROGRESS",
                    "isHidden": false
                },
                {
                    "type": "codePatch",
                    "diffs": [
                        {
                            "path": "main_window.py",
                            "patch": "@@ -23898,34 +23898,41 @@\n    %0A    def \n-closeEvent\n+on_status_clicked\n (self, event\n@@ -23956,157 +23956,345 @@\n dle \n-application close event with proper cleanup.%22%22%22%0A        try:%0A            if hasattr(self, 'worker') and self.worker and self.worker.isRunning():%0A    \n+status indicator click.%22%22%22%0A        # Toggle message log visibility when clicking on any status indicator%0A        self.toggle_message_log()%0A    %0A    def toggle_message_log(self):%0A        %22%22%22Toggle the visibility of the message log.%22%22%22%0A        if hasattr(self, 'activity_widget'):%0A            is_visible = self.activity_widget.isVisible()%0A\n     \n@@ -24310,353 +24310,1283 @@\n elf.\n-worker.stop()%0A            event.accept()%0A        except Exception as e:%0A            print(f%22Error during shutdown: %7Be%7D%22)%0A            event.accept()%0A%0A    def on_status_clicked(self, event):%0A        %22%22%22Handle status indicator click.%22%22%22%0A        # Toggle \n+activity_widget.setVisible(not is_visible)%0A            if hasattr(self, 'toggle_log_btn'):%0A                self.toggle_log_btn.setText(%22%E2%96%BC Activity Log%22 if is_visible else %22%E2%96%B2 Activity Log%22)%0A            if not is_visible:%0A                self._position_activity_overlay()%0A            self.adjustSize()%0A    %0A    def create_activity_feed(self):%0A        %22%22%22Create the activity feed widget.%22%22%22%0A        widget = QWidget()%0A        widget.setObjectName('activityFeed')%0A        layout = QVBoxLayout(widget)%0A        layout.setContentsMargins(10, 10, 10, 10)%0A        %0A        # Title%0A        title = QLabel(%22Activity Feed%22)%0A        title.setStyleSheet(%22font-weight: bold; font-size: 14px; color: #2c3e50; margin-bottom: 10px;%22)%0A        layout.addWidget(title)%0A        %0A        # Message log%0A        self.message_log = QTextBrowser()%0A        self.\n message\n- log visibility when clicking on any status indicator%0A        self.toggle_message_log()\n+_log.setMaximumHeight(150)%0A        self.message_log.setStyleSheet(%22%22%22%0A            QTextBrowser %7B%0A                background-color: #ffffff;%0A                border: 1px solid #ddd;%0A                border-radius: 4px;%0A                padding: 8px;%0A                font-family: 'Courier New', monospace;%0A                font-size: 11px;%0A            %7D%0A        %22%22%22)%0A        layout.addWidget(self.message_log)%0A        %0A        return widget\n %0A   \n@@ -33892,4420 +33892,8 @@\n %22)%0A%0A\n-    def check_connections(self):%0A        %22%22%22Check the current connection status for all services.%22%22%22%0A        try:%0A            if not self.client:%0A                self.update_main_status_indicator()%0A                return%0A                %0A            # Check Arweave connection%0A            arweave_connected = self.client.check_arweave_connection()%0A            self.update_connection_status('arweave', arweave_connected)%0A            %0A            # Check Nano connection%0A            nano_connected = self.client.check_nano_connection()%0A            self.update_connection_status('nano', nano_connected)%0A            %0A            # Check Dogecoin connection%0A            doge_connected = self.client.check_dogecoin_connection()%0A            self.update_connection_status('doge', doge_connected)%0A            %0A            # Update the main status indicator%0A            self.update_main_status_indicator()%0A            %0A            # Update the timestamp%0A            self.update_timestamp()%0A            %0A        except Exception as e:%0A            print(f%22Error checking connections: %7Bstr(e)%7D%22)%0A            self.add_message(f%22Error checking connections: %7Bstr(e)%7D%22, %22error%22)%0A            %0A    def update_connection_status(self, service, is_connected, error_msg=None, status_detail=None):%0A        %22%22%22Update the connection status for a service.%0A        %0A        Args:%0A            return%0A            %0A        # Check Arweave connection%0A        arweave_connected = self.client.check_arweave_connection()%0A        self.update_connection_status('arweave', arweave_connected)%0A        %0A        # Check Nano connection%0A        nano_connected = self.client.check_nano_connection()%0A        self.update_connection_status('nano', nano_connected)%0A                if not self.mock_mode:  # Only log success messages in real mode%0A                    self.add_message(%22Arweave connected successfully%22, %22success%22, %22verified%22)%0A            else:%0A                status = status_detail or %22Disconnected%22%0A                tooltip = f%22Arweave: %7Bstatus%7D%5CnIncludes tag validation, data immutability checks%22%0A                dot.setStyleSheet(%22font-size: 16px; color: #e74c3c;%22)%0A                if not self.mock_mode:  # Only log error messages in real mode%0A                    self.add_message(f%22Arweave %7Bstatus.lower()%7D: %7Berror_msg or 'Connection failed'%7D%22, %22error%22, %22failed%22)%0A        elif service == 'nano':%0A            if is_connected:%0A                tooltip = %22Nano: Connected%5CnChecks current balance, transaction confirmation depth%22%0A                dot.setStyleSheet(%22font-size: 16px; color: #2ecc71;%22)%0A                if not self.mock_mode:  # Only log success messages in real mode%0A                    self.add_message(%22Nano RPC connected successfully%22, %22success%22, %22verified%22)%0A            else:%0A                status = status_detail or %22RPC error%22%0A                tooltip = f%22Nano: %7Bstatus%7D%5CnChecks current balance, transaction confirmation depth%22%0A                dot.setStyleSheet(%22font-size: 16px; color: #e74c3c;%22)%0A                if not self.mock_mode:  # Only log error messages in real mode%0A                    self.add_message(f%22Nano %7Bstatus%7D: %7Berror_msg or 'Connection failed'%7D%22, %22error%22, %22failed%22)%0A        elif service == 'doge':%0A            if is_connected:%0A                tooltip = %22DOGE Wallet: Unlocked%5CnWallet usability check and mnemonic verification%22%0A                dot.setStyleSheet(%22font-size: 16px; color: #2ecc71;%22)%0A                if not self.mock_mode:  # Only log success messages in real mode%0A                    self.add_message(%22DOGE wallet unlocked successfully%22, %22success%22, %22verified%22)%0A            else:%0A                status = status_detail or %22Locked%22%0A                tooltip = f%22DOGE Wallet: %7Bstatus%7D%5CnWallet usability check and mnemonic verification%22%0A                dot.setStyleSheet(%22font-size: 16px; color: #e74c3c;%22)%0A                if not self.mock_mode:  # Only log error messages in real mode%0A                    self.add_message(f%22DOGE wallet %7Bstatus.lower()%7D: %7Berror_msg or 'Wallet locked'%7D%22, %22error%22, %22failed%22)%0A        %0A        widget.setToolTip(tooltip)%0A        %0A        # Update the main status indicator%0A        self.update_main_status_indicator()%0A    %0A    def update_timestamp(self):%0A        %22%22%22Update the last updated timestamp.%22%22%22%0A        if hasattr(self, 'last_updated'):%0A            now = datetime.now().strftime(%22%25H:%25M:%25S%22)%0A            self.last_updated.setText(f%22Last updated: %7Bnow%7D%22)%0A    %0A\n     \n@@ -36687,670 +36687,8 @@\n ns)%0A\n-        %0A    def on_status_clicked(self, event):%0A        %22%22%22Handle status indicator click to toggle connection indicators.%22%22%22%0A        if not hasattr(self, 'indicators_visible'):%0A            return%0A            %0A        # Toggle visibility of connection indicators%0A        self.indicators_visible = not self.indicators_visible%0A        self.indicators_container.setVisible(self.indicators_visible)%0A        %0A        # Update tooltip to indicate current state%0A        state = %22Hide%22 if self.indicators_visible else %22Show%22%0A        self.main_status_indicator.setToolTip(%0A            f%22%7Bstate%7D connection indicators%5Cn%22%0A            %22Click to toggle visibility%22%0A        )%0A\n     \n@@ -37785,16 +37785,62 @@\n cators')\n+ or not hasattr(self, 'main_status_indicator')\n :%0A      \n@@ -38890,40 +38890,8 @@\n = f%22\n-QLabel#main_status_indicator %7B%7B \n font\n@@ -38922,11 +38922,8 @@\n or%7D;\n- %7D%7D\n %22%0A  \n@@ -39293,371 +39293,8 @@\n ip)%0A\n-    %0A    def toggle_message_log(self):%0A        %22%22%22Toggle the visibility of the message log.%22%22%22%0A        is_visible = self.message_log.isVisible()%0A        self.message_log.setVisible(not is_visible)%0A        self.toggle_log_btn.setText(%22%E2%96%BC Activity Feed%22 if is_visible else %22%E2%96%B2 Activity Feed%22)%0A        %0A        # Resize window to fit content%0A        self.adjustSize()%0A\n     \n@@ -61105,24 +61105,69 @@\n guest users%0A\n+        if hasattr(self, 'nav_buttons'):%0A    \n         for \n@@ -61206,32 +61206,84 @@\n uttons.items():%0A\n+                if hasattr(self, btn_name):%0A        \n             btn \n@@ -61324,39 +61324,44 @@\n     \n-btn.setVisible(not btn.property\n+        requires_auth = btn_data.get\n (%22re\n@@ -61376,40 +61376,88 @@\n uth%22\n-))  # Only show non-auth buttons\n+, False)%0A                    btn.setVisible(user_logged_in or not requires_auth)\n %0A   \n@@ -61635,32 +61635,39 @@\n self, 'user_info\n+_widget\n '):%0A            \n@@ -61672,32 +61672,39 @@\n   self.user_info\n+_widget\n .setVisible(Fals\n@@ -61845,17 +61845,16 @@\n me, \n-(_, _, _)\n+btn_data\n  in \n@@ -61934,32 +61934,38 @@\n                 \n+ btn =\n  getattr(self, b\n@@ -61976,327 +61976,212 @@\n ame)\n-.setVisible(False)  # Hide all buttons first%0A            # Show only marketplace button%0A            if hasattr(self, 'marketplace_btn'):%0A                self.marketplace_btn.setVisible(True)%0A        %0A        # Hide other UI elements%0A        for btn_name in %5B'create_item_btn', 'my_items_btn', 'logout_btn'%5D:%0A   \n+%0A                    requires_auth = btn_data.get(%22requires_auth%22, False)%0A                    btn.setVisible(not requires_auth)  # Only show non-auth buttons%0A        %0A        # Hide logout button%0A\n         \n  if \n@@ -62168,33 +62168,32 @@\n  button%0A        \n- \n if hasattr(self,\n@@ -62189,32 +62189,36 @@\n sattr(self, \n-btn_name\n+'logout_btn'\n ):%0A         \n@@ -62224,35 +62224,23 @@\n     \n-    getattr(self, btn_name)\n+self.logout_btn\n .set\n@@ -66470,14 +66470,8 @@\n tils\n-_fixed\n  imp\n@@ -71415,1320 +71415,8 @@\n    %0A\n-    def on_login_complete(self, user):%0A        %22%22%22Handle successful login completion.%22%22%22%0A        try:%0A            print(%22Login completed successfully%22)%0A            self.current_user = user%0A            %0A            # Update UI%0A            self.login_btn.setEnabled(True)%0A            self.login_btn.setText(%22Continue%22)%0A            %0A            # Show user info%0A            if hasattr(self, 'user_info'):%0A                self.user_info.setVisible(True)%0A            %0A            # Show navigation buttons that require auth%0A            for i in range(1, self.sidebar_layout.count() - 1):  # -1 to exclude logout button%0A                item = self.sidebar_layout.itemAt(i)%0A                if item and item.widget():%0A                    btn = item.widget()%0A                    if hasattr(btn, 'requires_auth') and btn.requires_auth:%0A                        btn.setVisible(True)%0A            %0A            # Switch to marketplace%0A            self.show_page(1)%0A            %0A            self.add_message(%22Login successful%22, %22success%22, %22verified%22)%0A            %0A        except Exception as e:%0A            self.login_btn.setEnabled(True)%0A            self.login_btn.setText(%22Continue%22)%0A            QMessageBox.critical(self, %22Login Error%22, f%22Failed to complete login: %7Bstr(e)%7D%22)%0A            print(f%22Login completion error: %7Be%7D%22)\n %0A   \n@@ -78836,28 +78836,28 @@\n   # \n-Show loading overlay\n+Clear existing items\n %0A   \n@@ -78887,50 +78887,40 @@\n f, '\n-loading_overlay') and self.loading_overlay\n+items_grid') and self.items_grid\n :%0A  \n@@ -78942,28 +78942,24 @@\n elf.\n-loading_overlay.show\n+items_grid.clear\n ()%0A \n@@ -78984,36 +78984,42 @@\n       # \n-Clear existing items\n+Get items from mock server\n %0A       \n@@ -79046,74 +79046,67 @@\n , 'm\n-arketplace_list') and self.marketplace_list:%0A                self.\n+ock_server'):%0A                items = self.mock_server.get_\n mark\n@@ -79113,26 +79113,21 @@\n etplace_\n-list.clear\n+items\n ()%0A     \n@@ -79125,32 +79125,37 @@\n s()%0A            \n+else:\n %0A            # G\n@@ -79155,97 +79155,22 @@\n     \n-# Get items from mock server%0A            items = self.mock_server.get_marketplace_items()\n+    items = %5B%5D\n %0A   \n@@ -79315,38 +79315,13 @@\n t = \n-self.create_marketplace_item_w\n+ItemW\n idge\n@@ -79322,24 +79322,30 @@\n mWidget(item\n+, self\n )%0A          \n@@ -79350,27 +79350,24 @@\n             \n-if \n item_widget:\n@@ -79361,30 +79361,87 @@\n  item_widget\n-:%0A    \n+.bid_clicked.connect(self.on_bid_clicked)%0A                    %0A\n             \n@@ -79478,20 +79478,16 @@\n tItem()%0A\n-    \n         \n@@ -79568,33 +79568,23 @@\n     \n-    \n self.\n-marketplace_list\n+items_grid\n .add\n@@ -79623,33 +79623,23 @@\n     \n-    \n self.\n-marketplace_list\n+items_grid\n .set\n@@ -79677,32 +79677,37 @@\n et)%0A            \n+else:\n %0A            pri\n@@ -79707,35 +79707,105 @@\n     \n-print(f%22Loaded %7Blen(items)%7D\n+    # Add placeholder if no items%0A                placeholder = QLabel(%22No items available in the\n  mar\n@@ -79812,22 +79812,16 @@\n ketplace\n- items\n %22)%0A     \n@@ -79831,209 +79831,387 @@\n     \n-%0A            # Hide loading overlay%0A            if hasattr(self, 'loading_overlay') and self.loading_overlay:%0A                self.loading_overlay.hide()%0A                %0A        except Exception as e:\n+    placeholder.setAlignment(Qt.AlignCenter)%0A                placeholder.setStyleSheet(%22color: #7f8c8d; font-size: 14px; padding: 20px;%22)%0A                list_item = QListWidgetItem()%0A                list_item.setSizeHint(placeholder.sizeHint())%0A                self.items_grid.addItem(list_item)%0A                self.items_grid.setItemWidget(list_item, placeholder)%0A            \n %0A   \n@@ -80231,21 +80231,27 @@\n t(f%22\n-Error loading\n+Loaded %7Blen(items)%7D\n  mar\n@@ -80264,24 +80264,23 @@\n ce items\n-: %7Be%7D%22)%0A\n+%22)%0A    \n         \n@@ -80287,112 +80287,97 @@\n     \n-if hasattr(self, 'loading_overlay') and self.loading_overlay:%0A                self.loading_overlay.hide(\n+%0A        except Exception as e:%0A            print(f%22Error loading marketplace items: %7Be%7D%22\n )%0A  \n@@ -80513,10 +80513,14 @@\n %22, %22\n-%E2%9A%A0%EF%B8%8F\n+failed\n %22)%0A%0A\n",
                            "isNew": false,
                            "isApplied": true,
                            "isUnread": true
                        }
                    ]
                }
            ],
            "context": {
                "author": "Unit Test Agent",
                "operationId": "fbd7997d-61f4-4b67-9e8b-b219ca105adb"
            },
            "createdAt": 1754366860914,
            "isInternal": false
        }
    ],
    "isAgent": false,
    "isNameGenerated": true,
    "isCustomAgent": false,
    "isUnitTestsAgent": true,
    "isE2EAgent": false,
    "isQnaAgent": false,
    "isRepoInfoAgent": false,
    "autoApply": true
}
}